import{r as s,u as ns,l as ls,R as Me,j as e,W as Ae,d as Le,L as Ue,I as os,H as Z,T as R,e as W,f as J,M as as,g as rs,h as is,i as cs,A as He,k as ge,m as We,n as xe,o as be,p as we,B as M,D as ds,C as Ie,F,q as je,s as hs,t as _e,v as us,w as fs,x as Fe,S as ms,V as gs,y as Ve,z as xs,E as $e,G as qe,J as Se,K as bs,N as ps,O as Cs,P as ws,Q as js,U as Ee,X as b,Y as Ss,Z as ys,_ as Bs,$ as V,a0 as Ne,a1 as se,a2 as te,a3 as ne,a4 as K,a5 as ks,a6 as Ds,a7 as de,a8 as vs,a9 as Rs,aa as Is,ab as Pe,ac as pe,ad as Fs,ae as Ce,af as le,ag as ve,ah as Re,ai as Ns,aj as Ge,ak as Ts,al as Ms,am as As,an as Ls,ao as Vs,ap as Qe,aq as Ye,ar as ue,as as Xe,at as fe,au as Te,av as Es,aw as Ps,ax as zs,ay as Os,az as Us,aA as Hs,aB as Ws,aC as _s,aD as $s,aE as qs,aF as Gs,aG as Qs,aH as Ys}from"./vendor-BL59bgv0.js";import{_ as me}from"./lodash-BR7ow8OG.js";import{A as ae}from"./ag-grid-react-COtiT-7y.js";import"./ag-grid-community-CKfuWc13.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function l(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=l(r);fetch(r.href,i)}})();const Xs="/assets/Titan-H8_3eplJ.png";function oe(t=[]){return(Array.isArray(t)?t:[t]).map(l=>(delete l["Branch Info"],l))}function ye(t,a,l){return`${t==""?"Uncategorised":t} ${a==""?"Unversioned":a} ${String(l).split("\\").at(-1)}`}function Js(t){return String(t).split("\\").at(-1)}const Ks="http://localhost:4000",Zs=40,et="40px";function he(t,a="info",l=3e3,o=!1){return{position:"top",variant:"solid",title:o?"Server Notification":"Client Notification",description:t,status:a,duration:l,isClosable:!0}}const Je=s.createContext({socket:null,toast:null,config:null,updateConfig:t=>{},isDebug:!1,setIsDebug:t=>{},configurableRowData:[],setConfigurableRowData:t=>{},branchInfos:{},setBranchInfos:t=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:t=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:t=>{},isCommitMode:!1,setIsCommitMode:t=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:t=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:t=>{},sourceBranch:null,setSourceBranch:t=>{},branchOptions:[],issueNumber:null,setIssueNumber:t=>{},commitMessage:"",setCommitMessage:t=>{},selectedLocalChanges:[],setSelectedLocalChanges:t=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:t=>{},socketPayload:null,setSocketPayload:t=>{},postCommitData:{},setPostCommitData:t=>{},logData:[],setLogData:t=>{}}),E=()=>s.useContext(Je),st=({children:t})=>{const[a,l]=s.useState(null),[o,r]=s.useState(null),i=ns(),[n,u]=s.useState(localStorage.getItem("isDebug")==="true");s.useEffect(()=>{const x=ls(Ks);return r(x),x.on("connect",()=>{x.emit("titan-config-get","fetch"),x.once("titan-config-get",H=>{l(H),i(he("Configurations Loaded","success",2e3))})}),x.on("notification",H=>{i(he(H.description,H.status,H.duration,!0))}),x.on("disconnect",()=>{i(he("Server Has Been Disconnected","warning",0,!0))}),x.on("reconnect",()=>{i(he("Server Has Been Reconnected","success",2e3,!0))}),()=>{x.disconnect()}},[]),s.useEffect(()=>{localStorage.setItem("isDebug",String(n))},[n]);const d=s.useCallback(x=>{x!=null&&(console.log("Saving config:",x),o==null||o.emit("titan-config-set",x))},[o]),h=s.useCallback(x=>{l(H=>{const X=x(H);return d(X),X})},[l,d]),[c,m]=s.useState([]),[B,I]=s.useState({}),N=s.useRef(null),[S,v]=s.useState([]),[j,g]=s.useState(!1),[f,C]=s.useState(!1),[D,A]=s.useState([]),y=s.useRef(null),T=s.useRef(null),[O,U]=s.useState(!1),[Y,$]=s.useState(null),_=s.useMemo(()=>c.filter(x=>x["Branch Folder"]&&x["Branch Version"]&&x["SVN Branch"]&&x["Branch Folder"]!==""&&x["Branch Version"]!==""&&x["SVN Branch"]!=="").map(x=>({value:x.id,label:ye(x["Branch Folder"],x["Branch Version"],x["SVN Branch"])})),[c]),[P,q]=s.useState(null),[k,z]=s.useState(""),[Q,ie]=s.useState([]),[w,p]=s.useState([]),[L,G]=s.useState(null),[ce,Be]=s.useState({}),[ke,De]=Me.useState([]);return s.useEffect(()=>{A([]),U(!1)},[c]),s.useEffect(()=>{if(!f||!O)return;const x=setTimeout(()=>{var H;(H=document.getElementById("sectionCommit"))==null||H.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(x)},[f,O]),s.useEffect(()=>{if(S.length<1||O){S.length<1&&C(!1);return}A([]),G(null),oe(S).forEach(x=>{console.debug("Emitting svn-status-single for branch:",x),o==null||o.emit("svn-status-single",{selectedBranch:x})})},[o,S,O]),s.useEffect(()=>{const x=()=>{U(!1)};return o==null||o.on("branch-refresh-unseen",x),()=>o==null?void 0:o.off("branch-refresh-unseen",x)},[o]),s.useEffect(()=>{const x=H=>{n&&console.debug("Received branch status data:",H),A(X=>[...X,H])};return o==null||o.on("branch-status-single",x),()=>o==null?void 0:o.off("branch-status-single",x)},[o]),s.useEffect(()=>{De([])},[S]),s.useEffect(()=>{ke.length===0&&o&&v(x=>(x.length>0&&o.emit("svn-log-selected",{selectedBranches:S}),x))},[ke,o]),s.useEffect(()=>{const x=H=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),De(X=>X.some(ts=>ts.id===H.id)?X:[...X,H])};return o==null||o.on("svn-log-result",x),()=>o==null?void 0:o.off("svn-log-result",x)},[o]),e.jsx(Je.Provider,{value:{socket:o,toast:i,config:a,updateConfig:h,isDebug:n,setIsDebug:u,configurableRowData:c,setConfigurableRowData:m,branchInfos:B,setBranchInfos:I,branchTableGridRef:N,selectedBranches:S,setSelectedBranches:v,showSelectedBranchesLog:j,setShowSelectedBranchesLog:g,isCommitMode:f,setIsCommitMode:C,selectedBranchStatuses:D,setSelectedBranchStatuses:A,localChangesGridRef:y,untrackedChangesGridRef:T,showCommitView:O,setShowCommitView:U,sourceBranch:Y,setSourceBranch:$,branchOptions:_,issueNumber:P,setIssueNumber:q,commitMessage:k,setCommitMessage:z,selectedLocalChanges:Q,setSelectedLocalChanges:ie,selectedUntrackedChanges:w,setSelectedUntrackedChanges:p,socketPayload:L,setSocketPayload:G,postCommitData:ce,setPostCommitData:Be,logData:ke,setLogData:De},children:t})};function re(){const{socket:t}=E(),a=s.useCallback(()=>{t==null||t.emit("titan-config-open",{})},[t]),l=s.useCallback((d,h,c,m)=>{t==null||t.emit("svn-update-single",{id:d,branch:h,version:c,folder:m})},[t]),o=s.useCallback((d,h,c,m)=>{t==null||t.emit("svn-info-single",{id:d,branch:h,version:c,folder:m})},[t]),r=s.useCallback(d=>{t==null||t.emit("svn-commit",d)},[t]),i=s.useCallback(d=>{t==null||t.emit("svn-files-revert",{filesToProcess:d})},[t]),n=s.useCallback(d=>{t==null||t.emit("svn-files-add-remove",{filesToProcess:d})},[t]),u=s.useCallback((d,h,c,m=null)=>{t==null||t.emit("trello-search-names-card",{key:d,token:h,query:c,limit:m})},[t]);return{emitOpenConfig:a,emitUpdateSingle:l,emitInfoSingle:o,emitCommitPayload:r,emitFilesRevert:i,emitFilesAddRemove:n,emitTrelloCardNamesSearch:u}}function ee(){const{toast:t}=E(),a=s.useCallback((l="",o="info",r=3e3,i=null)=>{const n=he(l,o,r);if(t)return t(n);if(i)return i(n)},[t]);return{toast:t,RaiseClientNotificaiton:a}}function tt(){const{config:t,isDebug:a,setIsDebug:l}=E(),{emitOpenConfig:o}=re(),{RaiseClientNotificaiton:r}=ee(),i=s.useCallback(()=>{window.electron.checkForUpdates().then(u=>{console.debug("Check for updates result: ",u)}),window.electron.on("update-not-available",()=>{r("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[r]),n=s.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(u=>{r(`Application Version: v${u}`,"info",2e3)})},[r]);return e.jsxs(Ae,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Le,{alignItems:"center",children:[e.jsx(Ue,{onClick:n,children:e.jsx(os,{src:Xs,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(Z,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(Z,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Le,{alignItems:"center",columnGap:2,children:[e.jsx(R,{label:`Current Debug Mode: ${a?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(W,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:a?e.jsx(J,{as:rs}):e.jsx(J,{as}),onClick:()=>l(u=>!u)})}),e.jsx(R,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(W,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(J,{as:is}),onClick:()=>o()})}),e.jsx(R,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(W,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(J,{as:cs}),onClick:i,isDisabled:!window.electron})})]})]})}function nt({isAlertOpen:t,onCloseAlert:a,cancelRef:l,removeSelectedRows:o}){return e.jsx(He,{isOpen:t,leastDestructiveRef:l,onClose:a,children:e.jsx(ge,{children:e.jsxs(We,{children:[e.jsx(xe,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(be,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(we,{children:[e.jsx(M,{ref:l,onClick:a,children:"Cancel"}),e.jsx(M,{colorScheme:"red",onClick:o,ml:3,children:"Delete"})]})]})})})}function ze(){const{innerWidth:t,innerHeight:a}=window;return{width:t,height:a}}function lt(){const[t,a]=s.useState(ze());return s.useEffect(()=>{function l(){a(ze())}return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}function ot({rowData:t,onRowValueChanged:a}){const{config:l,branchTableGridRef:o,updateConfig:r,isDebug:i,selectedBranches:n,setSelectedBranches:u,setSelectedBranchStatuses:d,setShowCommitView:h}=E(),c=lt(),[m,B]=s.useState(c.height>768),I=s.useCallback(f=>{const C={...f,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};r(D=>({...D,branches:oe([...D.branches,C])}))},[r]),N=s.useCallback(f=>{var D,A,y,T;const C=(A=(D=o==null?void 0:o.current)==null?void 0:D.api)==null?void 0:A.getSelectedNodes().map(O=>O.data);if(i&&console.log("SectionBranches.jsx: onSelectionChanged - event",f),i&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",n),(f==null?void 0:f.source)=="rowDataChanged"){const O=n.map(U=>U.id);(T=(y=o==null?void 0:o.current)==null?void 0:y.api)==null||T.forEachNode(U=>{O.includes(U.data.id)&&U.setSelected(!0)});return}else["api"].includes(f==null?void 0:f.source)||(u(C),d([]),h(!1))},[i,o,n,u,h]),S=s.useCallback(f=>{const C=[];f.api.forEachNode(D=>C.push(D.data)),i&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",C),r(D=>({...D,branches:oe(C)}))},[r,i]),v=s.useCallback(f=>{const C=l==null?void 0:l.branchFolderColours[f.data["Branch Folder"]];return{backgroundColor:C?`${C}20`:"transparent"}},[l==null?void 0:l.branchFolderColours]),j=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),g=s.useMemo(()=>{const f=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:C=>e.jsx(R,{label:"Copy Row",hasArrow:!0,children:e.jsx(W,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>I(C.data),icon:e.jsx(Ie,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:C=>C.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return m?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:ds,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...f]:f},[l,m,I]);return s.useEffect(()=>{B(c.height>768)},[c]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:m?"auto":"428px",width:"100%"},children:e.jsx(ae,{ref:o,rowData:t,defaultColDef:j,columnDefs:g,stopEditingWhenCellsLoseFocus:!0,getRowStyle:v,onRowDragEnd:S,domLayout:m?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:N,onRowValueChanged:a,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:f=>f.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!m,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function at(){const{updateConfig:t,isDebug:a,socket:l,configurableRowData:o,setConfigurableRowData:r,branchInfos:i,config:n,setBranchInfos:u,setSelectedBranches:d,setSelectedBranchStatuses:h,showCommitView:c,setShowCommitView:m}=E(),[B,I]=s.useState([]),N=s.useCallback(S=>{a&&console.log("AG Grid: onRowValueChanged - event",S),a&&console.log("AG Grid: onRowValueChanged - rowDataBranches",B),t(v=>({...v,branches:oe(B)}))},[B,t,a]);return s.useEffect(()=>{const S=me.debounce(()=>{const v=o.map(j=>({...j,"Branch Info":i[j.id]||"Hasn't been refreshed"}));I(j=>me.isEqual(v,j)?j:v)},300);return S(),()=>S.cancel()},[o,i]),s.useEffect(()=>{r(S=>n&&n.branches&&!me.isEqual(n.branches,S)?n.branches:S)},[n]),s.useEffect(()=>{const S=v=>{u(j=>{const g={...j,[v.id]:v.info};return console.debug("branch-info-single data received:",v),console.debug("branch-info-single newBranchInfos",g),d(f=>(f.find(D=>D.id===v.id)&&c&&(h([]),m(!1)),f)),g})};return l==null||l.on("branch-info-single",S),()=>l==null?void 0:l.off("branch-info-single")},[l,c]),{rowDataBranches:B,setRowDataBranches:I,onRowValueChanged:N}}function rt(){const{socket:t,updateConfig:a,isDebug:l,setShowSelectedBranchesLog:o,configurableRowData:r,branchTableGridRef:i,selectedBranches:n,setSelectedBranches:u,isCommitMode:d,setIsCommitMode:h,setSelectedBranchStatuses:c,setShowCommitView:m}=E(),{emitUpdateSingle:B,emitInfoSingle:I}=re(),{RaiseClientNotificaiton:N}=ee(),[S,v]=s.useState(!1),j=s.useRef(),g=()=>v(!1),{rowDataBranches:f,setRowDataBranches:C,onRowValueChanged:D}=at(),[A,y]=s.useState(0),[T,O]=s.useState([]),U=s.useCallback(()=>{var w,p;l&&console.log("SectionBranches.jsx: clearSelection: START"),(p=(w=i==null?void 0:i.current)==null?void 0:w.api)==null||p.deselectAll(),u([]),h(!1)},[l,i,u]),Y=s.useCallback(()=>{var p,L;const w=(L=(p=i==null?void 0:i.current)==null?void 0:p.api)==null?void 0:L.getSelectedNodes().map(G=>G.data);u(w),v(!0)},[i,u]),$=s.useCallback(()=>{const w={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};a(p=>({...p,branches:oe([...p.branches,w])}))},[a]),_=s.useCallback(()=>{n.forEach(w=>{B(w.id,w["SVN Branch"],w["Branch Version"],w["Branch Folder"])})},[n,B]),P=s.useCallback(()=>{T.forEach(w=>{B(w.id,w["SVN Branch"],w["Branch Version"],w["Branch Folder"])})},[T,B]),q=s.useCallback(()=>{const w=n.map(L=>L.id),p=f.filter(L=>!w.includes(L.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",p),a(L=>({...L,branches:oe(p)})),U(),g()},[n,f,a]),k=s.useCallback(()=>{o(!0)},[]),z=s.useCallback(()=>{C(w=>{const p=[...w];return n.forEach(L=>{const G=p.findIndex(ce=>ce.id===L.id);p[G]["Branch Info"]="Refreshing..."}),p}),n.forEach(w=>{I(w.id,w["SVN Branch"],w["Branch Version"],w["Branch Folder"])})},[n,I]),Q=s.useCallback(()=>{if(d){N("Unable to refresh branches while in commit mode","warning",0);return}N("Refreshing all branches. Please wait until this is done!","info",3e3);const w=Date.now();r.forEach(p=>{I(p.id,p["SVN Branch"],p["Branch Version"],p["Branch Folder"])}),y(w)},[r,I,N,d]),ie=s.useCallback(()=>{h(w=>!w),m(!1)},[h]);return s.useEffect(()=>{const w=f.filter(p=>String(p["Branch Info"]).toLowerCase().includes("behind"));O(w)},[f]),s.useEffect(()=>{const p=Date.now();if(r.length>0){p-A>3e5&&Q();const L=setInterval(()=>{Q()},3e5);return()=>clearInterval(L)}},[r,A,Q]),s.useEffect(()=>{const w=p=>{l&&console.debug("branch-success-single data received:",p),I(p.id,p.branch,p.version,p.folder)};return t==null||t.on("branch-success-single",w),()=>t==null?void 0:t.off("branch-success-single",w)},[l,t,I]),e.jsxs("div",{children:[e.jsxs(Ae,{mb:4,justify:"space-between",children:[e.jsxs(F,{columnGap:2,children:[e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:z,leftIcon:e.jsx(je,{}),colorScheme:"yellow",isDisabled:n.length<1,children:["Refresh ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:_,leftIcon:e.jsx(J,{as:hs}),colorScheme:"yellow",isDisabled:n.length<1,children:["Update ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(M,{onClick:ie,leftIcon:e.jsx(J,{as:_e}),colorScheme:"yellow",isDisabled:n.length<1,children:d?"Undo Commit":"Commit"})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(M,{onClick:k,leftIcon:e.jsx(us,{}),colorScheme:"yellow",isDisabled:n.length<1,children:"View Logs"})})]}),e.jsx(F,{columnGap:2,children:e.jsx(R,{label:"No outdated branches to update",isDisabled:T.length>0,hasArrow:!0,children:e.jsx(M,{onClick:P,leftIcon:e.jsx(fs,{}),colorScheme:"yellow",isDisabled:T.length<1,children:"Update Outdated"})})})]}),e.jsx(ot,{rowData:f,onRowValueChanged:D}),e.jsxs(F,{columnGap:2,mt:4,children:[e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:U,leftIcon:e.jsx(Fe,{}),colorScheme:"red",isDisabled:n.length<1,children:["Deselect ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:Y,leftIcon:e.jsx(Fe,{}),colorScheme:"red",isDisabled:n.length<1,children:["Delete ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(M,{onClick:$,leftIcon:e.jsx(ms,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(nt,{isAlertOpen:S,onCloseAlert:g,cancelRef:j,removeSelectedRows:q})]})}function Ke(t){const{data:a,onDiffResult:l}=t,o=async()=>{try{const r=await window.electron.openTortoiseSVNDiff({fullPath:a["Full Path"],branchFolder:a["Branch Folder"],branchVersion:a["Branch Version"]});l(r)}catch(r){l({success:!1,error:r.message})}};return e.jsx(W,{"aria-label":"Diff",size:"sm",icon:e.jsx(gs,{}),onClick:o,colorScheme:"yellow"})}function it({isModalOpen:t,closeModal:a}){const{socket:l,setIsCommitMode:o,setSelectedBranchStatuses:r,setShowCommitView:i,socketPayload:n,postCommitData:u}=E(),{emitUpdateSingle:d,emitCommitPayload:h}=re(),{RaiseClientNotificaiton:c}=ee(),[m,B]=s.useState([]),{onCopy:I,value:N,setValue:S,hasCopied:v}=Ve(""),{onCopy:j,value:g,setValue:f,hasCopied:C}=Ve(""),D=s.useCallback(k=>{k.success?c("TortoiseSVN diff opened successfully","success",3e3):c(`Error opening TortoiseSVN diff: ${JSON.stringify(k.error,null,4)}`,"error",0)},[c]),A=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:y,setActiveStep:T}=xs({index:1,count:A.length}),O=s.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),U=s.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:Ke,cellRendererParams:{onDiffResult:D},width:90}],[]),Y=s.useCallback(()=>{T(k=>k-1)},[T]),$=s.useCallback(()=>{if(u.type!=="trello"){c("Trello Autofill is not enabled for this commit","error",5e3);return}},[u,c]),_=s.useCallback(()=>{T(k=>k+1)},[T]),P=s.useCallback((k,z)=>{const Q="â€‹".repeat(7),ie=z.includes("MarkupSupport")?`\r
${Q}`:`\r
`;return k.sort((p,L)=>p["Branch Version"].localeCompare(L["Branch Version"])).map(p=>{const L=[];z.includes("BranchFolder")&&L.push(p["Branch Folder"]),z.includes("BranchVersion")&&L.push(p["Branch Version"]),z.includes("SVNBranch")&&L.push(p.branchPathFolder);let G=L.join(" ").trim();if(z.includes("IssueNumber")){const Be=p["Branch Folder"]===n.sourceBranch["Branch Folder"]?n.issueNumber:"XXXXXX";G+=` Issue [${Be}]`}const ce=p.revision?p.revision:p.errorMessage||"Error";return G+=` Revision [${ce}]`,G}).join(ie)},[n]),q=s.useCallback(k=>{const z=P(m,k);S(z)},[m,P,S]);return s.useEffect(()=>{T(3),B([]),S(""),f("")},[t,B]),s.useEffect(()=>{!t||y!=0||(a(),T(1),B([]),S(""),f(""))},[y,t]),s.useEffect(()=>{!t||y!=2||h(n)},[y,t,h,n]),s.useEffect(()=>{!t||y!=3||(c("The commit process has been completed successfully","success",5e3),q(["BranchFolder","BranchVersion","SVNBranch"]),f(n.commitMessage||""))},[c,y,t,q]),s.useEffect(()=>{!t||y<=3||(I(),c("Updating selected branches! Please wait","info",1500),m.forEach(k=>{d(k.branchId,k["SVN Branch"],k["Branch Version"],k["Branch Folder"])}),o(!1),r([]),i(!1),a(),T(1))},[c,y,t,m,d]),s.useEffect(()=>{const k=z=>{B(Q=>[...Q,z])};return l==null||l.on("svn-commit-status-live",k),()=>l==null?void 0:l.off("svn-commit-status-live",k)},[l]),s.useEffect(()=>{if(y!=2)return;const k=setTimeout(()=>{m.length>0&&m[0].bulkCommitLength==m.length&&T(3)},3e3);return()=>clearTimeout(k)},[y,m]),s.useEffect(()=>{(v||C)&&c("Copied to Clipboard","success",1500)},[v,C,c]),!t||!n?e.jsx(e.Fragment,{}):e.jsxs($e,{isOpen:t,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:y==1,children:[e.jsx(ge,{}),e.jsxs(qe,{maxH:"85%",maxW:"95%",children:[e.jsx(xe,{children:e.jsx(Z,{as:"h2",size:"lg",children:"Commit Selected Files"})}),y==1?e.jsx(Se,{size:"lg"}):e.jsx(e.Fragment,{}),e.jsxs(be,{children:[e.jsx(bs,{index:y,mb:6,size:"lg",colorScheme:"yellow",children:A.map((k,z)=>e.jsxs(ps,{children:[e.jsx(Cs,{children:e.jsx(ws,{complete:e.jsx(js,{}),incomplete:e.jsx(Ee,{}),active:e.jsx(Ee,{})})}),e.jsxs(b,{flexShrink:"0",children:[e.jsx(Ss,{children:k.title}),e.jsx(ys,{children:k.description})]}),e.jsx(Bs,{})]},z))}),e.jsxs(b,{children:[y!=1?e.jsx(e.Fragment,{}):e.jsxs(b,{children:[e.jsxs(b,{mb:4,children:[e.jsx(V,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Ne,{spacing:3,children:[e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Source Branch: ",e.jsx(K,{children:ye(n.sourceBranch["Branch Folder"],n.sourceBranch["Branch Version"],n.sourceBranch["SVN Branch"])})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Issue Number: ",e.jsx(K,{children:n.issueNumber})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Commit Message: ",e.jsx(K,{children:n.commitMessage})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Example:"," ",e.jsxs(K,{children:["Issue ",n.issueNumber," (",n.sourceBranch["Branch Folder"]," ",n.sourceBranch["Branch Version"],"): ",n.commitMessage]})]})]})]}),e.jsx(b,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(ae,{rowData:n.filesToProcess,defaultColDef:O,columnDefs:U,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),y!=2?e.jsx(e.Fragment,{}):e.jsxs(b,{children:[e.jsxs(V,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(b,{children:e.jsx(Ne,{spacing:3,children:m.map((k,z)=>e.jsxs(se,{children:[e.jsx(te,{as:k.errorMessage?ks:ne,color:k.errorMessage?"red.500":"yellow.500"}),k.branchString,":Â ",e.jsx(K,{children:k.errorMessage||k.revision})]},z))})})]}),y!=3?e.jsx(e.Fragment,{}):e.jsxs(b,{children:[e.jsx(b,{mb:4,children:e.jsxs(V,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(F,{columnGap:10,alignItems:"center",children:[e.jsxs(b,{children:[e.jsx(Z,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(b,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:N})})]}),e.jsx(b,{children:e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(W,{"aria-label":"Copy To Clipboard",onClick:I,icon:e.jsx(Ie,{}),colorScheme:"yellow"})})})]}),e.jsxs(b,{my:4,children:[e.jsx(V,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Ds,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:q,children:e.jsxs(Ae,{children:[e.jsx(de,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(de,{value:"BranchVersion",children:"Branch Version"}),e.jsx(de,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(de,{value:"IssueNumber",children:"Issue Number"}),e.jsx(de,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(F,{columnGap:10,alignItems:"center",children:[e.jsxs(b,{children:[e.jsx(V,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),n.sourceBranch&&n.sourceBranch["Branch Folder"]&&n.sourceBranch["Branch Version"]?e.jsx(K,{children:`Issue ${n.issueNumber} (${n.sourceBranch["Branch Folder"]} ${n.sourceBranch["Branch Version"]}): ${g}`}):e.jsx(K,{children:"Source information is undefined. Please check that you have entered the correct details otherwise contact the developer!"})]}),e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(W,{"aria-label":"Copy To Clipboard",onClick:j,icon:e.jsx(Ie,{}),colorScheme:"yellow"})})]})]})]})]}),e.jsx(we,{children:e.jsxs(F,{flex:1,justifyContent:"space-between",children:[e.jsx(F,{columnGap:2,children:e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:y<2,children:e.jsx(M,{onClick:Y,mr:3,isDisabled:y>=2,children:y==1?"Cancel":"Previous"})})}),e.jsxs(F,{columnGap:2,children:[e.jsx(R,{hasArrow:!0,label:"Requires Trello Autofill",isDisabled:u.type==="trello",children:e.jsx(M,{colorScheme:"yellow",leftIcon:e.jsx(J,{as:vs}),onClick:$,isDisabled:u.type!="trello",children:"Update Card"})}),e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:y!=2,children:e.jsx(M,{colorScheme:"yellow",onClick:_,isDisabled:y==2,children:y==A.length?"Complete":"Next"})})]})]})})]})]})}function ct({fileUpdates:t}){return e.jsx(b,{children:Object.keys(t).length>0?e.jsxs(b,{children:[e.jsx(V,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(b,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(Rs,{children:[e.jsx(Is,{children:e.jsxs(Pe,{children:[e.jsx(pe,{children:"Branch"}),e.jsx(pe,{children:"Path"}),e.jsx(pe,{children:e.jsx(R,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(pe,{children:e.jsx(R,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(Fs,{children:Object.keys(t).map(a=>e.jsx(Me.Fragment,{children:t[a].map((l,o)=>e.jsxs(Pe,{children:[e.jsx(Ce,{children:a}),e.jsx(Ce,{children:l.pathDisplay}),e.jsx(Ce,{children:l.wcStatus}),e.jsx(Ce,{children:l.reposStatus})]},o))},a))})]})}),e.jsx(V,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(b,{children:e.jsx(V,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function dt({rowDataLocalChanges:t,setRowDataLocalChanges:a,defaultColDefsCommit:l}){const{localChangesGridRef:o,isDebug:r,selectedBranches:i,showCommitView:n,setSelectedLocalChanges:u,selectedLocalChanges:d}=E(),{emitFilesRevert:h}=re(),{RaiseClientNotificaiton:c}=ee(),[m,B]=s.useState(""),I=s.useCallback(()=>{h(d)},[h,d]),N=s.useCallback(g=>{B(g.target.value)},[B]),S=s.useCallback(()=>{var f,C;const g=(C=(f=o==null?void 0:o.current)==null?void 0:f.api)==null?void 0:C.getSelectedNodes().map(D=>D.data);r&&console.log("CommitRegion.jsx: onFileViewSelectionChanged - selectedBranches",g),u(g)},[o,r]),v=s.useCallback(g=>{g.success?c("TortoiseSVN diff opened successfully","success",3e3):c(`Error opening TortoiseSVN diff: ${JSON.stringify(g.error,null,4)}`,"error",0)},[c]),j=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:Ke,cellRendererParams:{onDiffResult:v},width:90}],[]);return s.useEffect(()=>{i.length<1||n||(B(""),a([]),u([]))},[i,n]),e.jsx(b,{children:t.length>0?e.jsxs(b,{children:[e.jsxs(F,{mb:4,alignItems:"center",children:[e.jsx(V,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:N,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(ae,{ref:o,rowData:t,defaultColDef:l,columnDefs:j,onSelectionChanged:S,quickFilterText:m,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(F,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:d.length>0,children:e.jsx(M,{onClick:I,colorScheme:"red",isDisabled:d.length<1,children:"Revert Selected"})})})]}):e.jsx(b,{children:e.jsx(V,{children:"Your selected branches do not contain any files to commit."})})})}function ht({rowDataUntrackedChanges:t,setRowDataUntrackedChanges:a,defaultColDefsCommit:l}){const{untrackedChangesGridRef:o,selectedUntrackedChanges:r,setSelectedUntrackedChanges:i,isDebug:n,selectedBranches:u,showCommitView:d}=E(),{emitFilesAddRemove:h,emitFilesRevert:c}=re(),[m,B]=s.useState(""),I=s.useCallback(g=>{B(g.target.value)},[B]),N=s.useCallback(()=>{var f,C;const g=(C=(f=o==null?void 0:o.current)==null?void 0:f.api)==null?void 0:C.getSelectedNodes().map(D=>D.data);n&&console.log("CommitRegion.jsx: onUnseenFilesSelectionChanged - selectedBranches",g),i(g)},[o,n]),S=s.useCallback(()=>{h(r)},[h,r]),v=s.useCallback(()=>{c(r)},[c,r]),j=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return s.useEffect(()=>{u.length<1||d||(B(""),a([]),i([]))},[u,d]),e.jsx(b,{children:t.length>0?e.jsxs(b,{children:[e.jsx(V,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(F,{mb:4,alignItems:"center",children:[e.jsx(V,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:I,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(ae,{ref:o,rowData:t,defaultColDef:l,columnDefs:j,onSelectionChanged:N,quickFilterText:m,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(F,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(M,{onClick:S,colorScheme:"green",isDisabled:r.length<1,children:["Add/Remove ",r.length," File",r.length>1?"s":""]})}),e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(M,{onClick:v,colorScheme:"red",isDisabled:r.length<1,children:["Revert ",r.length," File",r.length>1?"s":""]})})]})]}):e.jsx(b,{children:e.jsx(V,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function ut(){const{issueNumber:t,setIssueNumber:a}=E(),l=o=>{const r=String(o.target.value);/^\d*$/.test(r)&&a(r.trim())};return e.jsx(le,{value:t,onChange:l,placeholder:"Enter number"})}function ft({openMessageAutoFillModal:t}){const{sourceBranch:a,setSourceBranch:l,branchOptions:o,setIssueNumber:r,commitMessage:i,setCommitMessage:n,isCommitMode:u}=E(),d=s.useCallback(c=>{l(c)},[l]),h=s.useCallback(c=>{n(String(c.target.value).replace(/["`]/g,"'"))},[n]);return s.useEffect(()=>{u&&(l(null),r(""),n(""))},[u]),e.jsxs(b,{children:[e.jsxs(F,{columnGap:2,mb:2,children:[e.jsx(b,{width:"50%",children:e.jsxs(ve,{isRequired:!0,children:[e.jsx(Re,{children:"Source Branch"}),e.jsx(Ns,{value:a,onChange:d,options:o,placeholder:"Select branch you would like to commit from",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsxs(F,{width:"50%",alignItems:"flex-end",columnGap:2,children:[e.jsxs(ve,{isRequired:!0,children:[e.jsx(Re,{children:"Issue Number"}),e.jsx(ut,{})]}),e.jsx(R,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(W,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>t(),icon:e.jsx(Ge,{})})})]})]}),e.jsx(F,{children:e.jsxs(ve,{width:"100%",isRequired:!0,children:[e.jsx(Re,{children:"Commit Message"}),e.jsx(Ts,{placeholder:"Enter Commit Message",resize:"vertical",onInput:h,value:i})]})})]})}function mt({openCommitModal:t}){const{setShowCommitView:a,selectedLocalChanges:l,sourceBranch:o,issueNumber:r,commitMessage:i,setSocketPayload:n,selectedBranches:u}=E(),{RaiseClientNotificaiton:d}=ee(),h=s.useCallback(()=>{a(!1)},[a]),c=s.useCallback(()=>{if(!o||o.value===""){d("Please select the source branch to proceed!","error");return}if(!r||!i||r===""||i===""){d("Please provide the issue number and the commit message to proceed!","error");return}n({sourceBranch:u.find(m=>m.id==o.value),issueNumber:r,commitMessage:i,filesToProcess:l}),t()},[o,r,i,d,l,u]);return e.jsx(b,{children:e.jsxs(F,{columnGap:2,justifyContent:"center",children:[e.jsx(M,{onClick:h,leftIcon:e.jsx(je,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(R,{label:"Select at least 1 file",hasArrow:!0,isDisabled:l.length>0,children:e.jsxs(M,{onClick:c,leftIcon:e.jsx(J,{as:_e}),colorScheme:"yellow",isDisabled:l.length<1,children:["Commit ",l.length>0?`${l.length} File`:"",l.length>1?"s":""]})})]})})}function gt(){const{selectedBranches:t,logData:a,setLogData:l}=E(),[o,r]=s.useState([]),[i,n]=s.useState(""),u=s.useCallback(c=>{n(c.target.value)},[n]),d=s.useCallback(()=>{l([])},[l]),h=a.length===t.length;return s.useEffect(()=>{if(a.length===0)return;const c=a.map(m=>m.logs).flat();r(m=>me.isEqual(m,c)?m:c)},[a]),{rowDataLogs:o,quickFilterLogsText:i,setQuickFilterLogsText:n,onQuickFilterLogsInputChanged:u,refreshLogs:d,areLogsFetched:h}}function xt({rowDataLogs:t,quickFilterLogsText:a,setAutoFillSelection:l=null,isAutofill:o=!1}){const r=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=s.useMemo(()=>{const d=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return o?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...d]:d},[o]),n=s.useRef(null),u=s.useCallback(()=>{var d,h;if(l){const c=(h=(d=n==null?void 0:n.current)==null?void 0:d.api)==null?void 0:h.getSelectedNodes().map(m=>m.data);l(c[0]||null)}},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:o?"90%":"85%",width:"100%"},children:e.jsx(ae,{ref:n,rowData:t,defaultColDef:r,columnDefs:i,onSelectionChanged:u,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!o,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function Ze({setAutoFillSelection:t=!1,isAutofill:a=!1}){const{selectedBranches:l,logData:o}=E(),{rowDataLogs:r,quickFilterLogsText:i,onQuickFilterLogsInputChanged:n,refreshLogs:u,areLogsFetched:d}=gt();return d?e.jsxs(b,{h:"100%",children:[e.jsxs(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(V,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:n,width:"100%"})]}),e.jsx(b,{children:e.jsx(R,{label:"Refresh",hasArrow:!0,children:e.jsx(W,{onClick:u,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(xt,{rowDataLogs:r,quickFilterLogsText:i,setAutoFillSelection:t,isAutofill:a})]}):e.jsxs(b,{children:[e.jsxs(b,{mb:4,children:[e.jsx(V,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Ne,{spacing:3,children:l.map(h=>{const c=o.find(m=>m.id===h.id);return e.jsxs(se,{display:"flex",alignItems:"center",children:[e.jsx(te,{w:30,h:30,as:c?ne:Ms,color:"yellow.500"}),ye(h["Branch Folder"],h["Branch Version"],h["SVN Branch"])]},h.branchId)})})]}),e.jsx(F,{justifyContent:"center",children:e.jsx(As,{value:o.length/l.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Ls,{children:[o.length," / ",l.length]})})})]})}function bt(t){const{data:a}=t,l=async()=>{window.open(a.url,"_blank")};return e.jsx(W,{"aria-label":"Diff",size:"sm",icon:e.jsx(Vs,{}),onClick:l,colorScheme:"yellow"})}function pt({rowDataTrello:t,quickFilterTrelloText:a,setAutoFillSelection:l}){const o=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=s.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:bt,width:120}],[]),i=s.useRef(null),n=s.useCallback(()=>{var d,h;const u=(h=(d=i==null?void 0:i.current)==null?void 0:d.api)==null?void 0:h.getSelectedNodes().map(c=>c.data);l(u[0]||null)},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(ae,{ref:i,rowData:t,defaultColDef:o,columnDefs:r,onSelectionChanged:n,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function Ct({setAutoFillSelection:t}){const{config:a,socket:l}=E(),{emitTrelloCardNamesSearch:o}=re(),r=a==null?void 0:a.trelloIntegration,i=(r==null?void 0:r.key)||null,n=(r==null?void 0:r.token)||null,u=i&&n&&i.trim()!==""&&n.trim()!==""&&i.toUpperCase()!=="TRELLO_API_KEY"&&n.toUpperCase!=="TRELLO_TOKEN",[d,h]=s.useState(""),[c,m]=s.useState(""),[B,I]=s.useState([]),N=s.useCallback(me.debounce(g=>{g.trim()!==""&&o(i,n,g)},250),[i,n,o]),S=s.useCallback(g=>{h(String(g.target.value).trim())},[h]),v=s.useCallback(()=>{d.trim()!==""&&o(i,n,d)},[d,i,n,o]),j=s.useCallback(g=>{m(g.target.value)},[]);return s.useEffect(()=>(N(d),()=>N.cancel()),[d,N]),s.useEffect(()=>{const g=f=>{I(f&&f.length>0?f:[])};return l==null||l.on("trello-result-search-names-card",g),()=>l==null?void 0:l.off("trello-result-search-names-card",g)},[l]),u?e.jsxs(b,{h:"100%",children:[e.jsxs(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(V,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(le,{placeholder:"Type to search...",onInput:S,width:"100%"})]}),e.jsx(b,{children:e.jsx(R,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(W,{onClick:v,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(V,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:j,width:"100%"})]})}),e.jsx(pt,{rowDataTrello:B,quickFilterTrelloText:c,setAutoFillSelection:t})]}):e.jsx(b,{h:"100%",p:4,children:e.jsxs(V,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(Ue,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx(Ge,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function wt({isModalOpen:t,closeModal:a}){const{setSourceBranch:l,branchOptions:o,setIssueNumber:r,setCommitMessage:i,setPostCommitData:n}=E(),[u,d]=s.useState(0),[h,c]=s.useState([null,null]),[m,B]=s.useState(!0),I=s.useCallback(j=>{d(j),c(j===0?g=>[g[0],null]:g=>[null,g[1]])},[d]),N=s.useCallback(j=>{c(g=>[j,...g.slice(1)])},[c]),S=s.useCallback(j=>{c(g=>[g[0],j])},[c]),v=s.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",u),console.debug("Selected autofill selection:",JSON.stringify(h,null,4));let j=h[u];if(u===0){const g=j.message,f=j.branchId,C=g.match(/\s*(Issue)*\s*(\d+)\s*/),D=C?C[2]:null,A=g.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");f&&l(o.find(y=>y.value===f)),D&&r(D),A.trim()!==""&&i(A)}else{const g=j.name,f=g.match(/\s*(Issue)*\s*(\d+)\s*/),C=f?f[2]:null,D=g.replace(/\s*(Issue)*\s*(\d+)/,"");C&&r(C),D.trim()!==""&&i(D),n({type:"trello",data:j})}a()},[u,h,a]);return s.useEffect(()=>{B(!(h.length==2&&(h[0]||h[1])))},[h]),s.useEffect(()=>{c([null,null])},[t]),e.jsxs($e,{isOpen:t,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(ge,{}),e.jsxs(qe,{maxH:"95%",maxW:"95%",children:[e.jsx(xe,{children:e.jsx(Z,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(Se,{size:"lg"}),e.jsx(be,{children:e.jsx(b,{height:"70vh",children:e.jsxs(Qe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:j=>I(j),children:[e.jsxs(Ye,{children:[e.jsx(ue,{children:"SVN Logs"}),e.jsx(ue,{children:"Trello"})]}),e.jsxs(Xe,{h:"90%",children:[e.jsx(fe,{px:0,pb:0,h:"100%",children:e.jsx(Ze,{setAutoFillSelection:N,isAutofill:!0})}),e.jsx(fe,{px:0,pb:0,h:"100%",children:e.jsx(Ct,{setAutoFillSelection:S})})]})]})})}),e.jsxs(we,{children:[e.jsx(M,{mr:3,onClick:()=>a(),children:"Cancel"}),e.jsx(R,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!m,children:e.jsx(M,{colorScheme:"yellow",onClick:v,isDisabled:m,children:"Select"})})]})]})]})}function jt(){const{isDebug:t,setIsCommitMode:a,selectedBranchStatuses:l,showCommitView:o,setShowCommitView:r,selectedBranches:i,configurableRowData:n}=E(),[u,d]=s.useState({}),[h,c]=s.useState([]),[m,B]=s.useState([]),{isOpen:I,onOpen:N,onClose:S}=Te(),{isOpen:v,onOpen:j,onClose:g}=Te(),f=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);s.useEffect(()=>{if(i.length<1||o){i.length<1&&a(!1);return}d({})},[i,o]),s.useEffect(()=>{t&&(console.debug("Branch Status Rows:",l),console.debug("Selected Rows:",i))},[t,l,i]),s.useEffect(()=>{l.length===i.length&&(l.forEach(T=>{let O=T.id,U=T.status.filesToCommit,Y=T.status.filesToUpdate;const $=n.find(_=>_.id===O);if(Y.length>0){const _=ye($["Branch Folder"],$["Branch Version"],$["SVN Branch"]);d(P=>({...P,[_]:[...P[_]||[],...Y]}))}if(U.length>0){const _=U.map(P=>({branchId:O,"Branch Folder":$["Branch Folder"],"Branch Version":$["Branch Version"],"SVN Branch":$["SVN Branch"],"Full Path":P.path,"File Path":`${Js(T.status.branch)}\\${P.pathDisplay}`,"Local Status":P.wcStatus}));c(P=>[...P,..._.filter(q=>!["unversioned","missing"].includes(q["Local Status"]))]),B(P=>[...P,..._.filter(q=>["unversioned","missing"].includes(q["Local Status"]))])}}),r(!0))},[l,i,n]);const C=Object.keys(u).length>0,D=h.length>0,A=m.length>0,y=C||D||A;return e.jsxs(b,{children:[e.jsx(b,{mb:6,children:e.jsx(ft,{openMessageAutoFillModal:j})}),e.jsx(Es,{isLoaded:o&&y,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(Qe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:C?0:D?1:2,isLazy:!1,children:[e.jsxs(Ye,{children:[e.jsx(ue,{isDisabled:!C,children:e.jsx(R,{label:"No files to update!",hasArrow:!0,isDisabled:C,children:"Files to Update"})}),e.jsx(ue,{isDisabled:!D,children:e.jsx(R,{label:"No files to commit!",hasArrow:!0,isDisabled:D,children:"Local Changes"})}),e.jsx(ue,{isDisabled:!A,children:e.jsx(R,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:A,children:"Untracked Changes"})})]}),e.jsxs(Xe,{children:[e.jsx(fe,{px:0,children:e.jsx(ct,{fileUpdates:u})}),e.jsx(fe,{px:0,children:e.jsx(dt,{rowDataLocalChanges:h,setRowDataLocalChanges:c,defaultColDefsCommit:f})}),e.jsx(fe,{px:0,children:e.jsx(ht,{rowDataUntrackedChanges:m,setRowDataUntrackedChanges:B,defaultColDefsCommit:f})})]})]})}),o&&!y?e.jsx(V,{mt:4,className:"animation-pulse",fontWeight:600,children:"No changes have been spotted! Please use the refresh button ðŸ‘‡ if you have recently made a change"}):e.jsx(e.Fragment,{}),e.jsx(b,{mt:6,children:e.jsx(mt,{openCommitModal:N})}),e.jsx(it,{isModalOpen:I,closeModal:S}),e.jsx(wt,{isModalOpen:v,closeModal:g})]})}function St(){const{showSelectedBranchesLog:t,setShowSelectedBranchesLog:a}=E();return e.jsxs(Ps,{isOpen:t,onClose:()=>a(!1),placement:"left",size:"full",children:[e.jsx(ge,{}),e.jsxs(zs,{children:[e.jsx(Se,{size:"lg"}),e.jsx(xe,{children:"Selected Branches: SVN Log"}),e.jsx(be,{children:e.jsx(b,{height:"100%",children:e.jsx(Ze,{})})})]})]})}function yt(){const{toast:t,RaiseClientNotificaiton:a}=ee(),{isOpen:l,onOpen:o,onClose:r}=Te(),i=s.useRef(),[n,u]=s.useState(!1);s.useEffect(()=>{if(!window.electron){a("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{t.closeAll(),o()}),window.electron.on("update-error",c=>{a(`An error occurred while checking for updates: ${c}`,"error",5e3)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[t,o]);const d=s.useCallback(()=>{r(),a("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[r,a]),h=s.useCallback(()=>{if(n){a("Update is already in progress. Please wait.","info",5e3);return}window.electron?(u(!0),window.electron.downloadUpdate().catch(c=>{u(!1),a(`An error occurred while downloading the update: ${c}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{a("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),r()}),window.electron.on("update-not-available",()=>{a("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),r()})):a("Cannot update Titan in a non-desktop application environment","error",5e3)},[n,a,r]);return e.jsx(He,{isOpen:l,leastDestructiveRef:i,onClose:r,motionPreset:"slideInBottom",closeOnOverlayClick:!n,children:e.jsx(ge,{children:e.jsxs(We,{children:[e.jsx(xe,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),n?e.jsx(e.Fragment,{}):e.jsx(Se,{}),e.jsx(be,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(we,{children:[e.jsx(M,{colorScheme:"red",ref:i,onClick:d,children:"Cancel"}),e.jsx(M,{colorScheme:"yellow",onClick:h,ml:3,isDisabled:n,children:"Confirm"})]})]})})})}function Bt(){if(!window.electron)return e.jsx(e.Fragment,{});const t=s.useCallback(()=>{window.electron.minimizeWindow()},[]),a=s.useCallback(()=>{window.electron.maximizeWindow()},[]),l=s.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Os.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(F,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(Z,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(F,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(W,{"aria-label":"Minimize",size:"xs",icon:e.jsx(Us,{}),onClick:t,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(W,{"aria-label":"Maximize",size:"xs",icon:e.jsx(Hs,{}),onClick:a,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(W,{"aria-label":"Close",size:"xs",icon:e.jsx(Fe,{}),onClick:l,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function kt(){const{isCommitMode:t,selectedBranches:a,configurableRowData:l}=E(),{RaiseClientNotificaiton:o}=ee();return s.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{o("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(b,{className:"titanBody",children:[e.jsx(Bt,{}),e.jsxs(b,{p:10,children:[e.jsx(tt,{}),e.jsx(yt,{}),e.jsxs(F,{rowGap:4,flexDirection:"column",children:[e.jsx(b,{children:e.jsx(rt,{})}),e.jsx(Ws,{in:t,animateOpacity:!0,children:e.jsxs(b,{id:"sectionCommit",children:[e.jsxs(Z,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",a.length==l.length?"All":`${a.length}/${l.length}`," Branch",a.length==1?"":"es"]}),e.jsx(jt,{})]})})]}),e.jsx(St,{})]})]})}const{definePartsStyle:es,defineMultiStyleConfig:ss}=Qs(Ys.keys),Dt=es({dialog:{mt:`${Zs+20}px`,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),vt=ss({baseStyle:Dt}),Rt=es({dialog:{mt:et,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),It=ss({baseStyle:Rt}),Ft={initialColorMode:"dark",useSystemColorMode:!1},Oe=_s({config:Ft,components:{Modal:vt,Drawer:It}});$s.createRoot(document.getElementById("root")).render(e.jsx(Me.StrictMode,{children:e.jsxs(qs,{theme:Oe,children:[e.jsx(Gs,{initialColorMode:Oe.config.initialColorMode}),e.jsx(st,{children:e.jsx(kt,{})})]})}));
