import{r as s,u as ss,l as ts,R as Ne,j as e,W as Te,d as Me,L as Pe,I as ns,H as J,T as R,e as H,f as X,M as ls,g as as,h as os,i as rs,A as Oe,k as ge,m as Ue,n as xe,o as be,p as we,B as M,D as is,C as ve,F as N,q as je,s as cs,t as We,v as ds,w as hs,x as Re,S as us,V as fs,y as Le,z as ms,E as He,G as _e,J as Se,K as gs,N as xs,O as bs,P as ps,Q as Cs,U as Ae,X as C,Y as ws,Z as js,_ as Ss,$ as L,a0 as Ie,a1 as se,a2 as te,a3 as ne,a4 as ee,a5 as ys,a6 as Bs,a7 as de,a8 as ks,a9 as Ds,aa as Ve,ab as pe,ac as vs,ad as Ce,ae as le,af as ke,ag as De,ah as Rs,ai as $e,aj as Is,ak as Fs,al as Ns,am as Ts,an as Ms,ao as qe,ap as Ge,aq as ue,ar as Qe,as as fe,at as Fe,au as Ls,av as As,aw as Vs,ax as Es,ay as zs,az as Ps,aA as Os,aB as Us,aC as Ws,aD as Hs,aE as _s,aF as $s,aG as qs}from"./vendor-9KnvF5I5.js";import{_ as me}from"./lodash-BR7ow8OG.js";import{A as oe}from"./ag-grid-react-CnvW5BIp.js";import"./ag-grid-community-CKfuWc13.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function l(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=l(r);fetch(r.href,i)}})();const Gs="/assets/Titan-H8_3eplJ.png";function ae(t=[]){return(Array.isArray(t)?t:[t]).map(l=>(delete l["Branch Info"],l))}function ye(t,o,l){return`${t==""?"Uncategorised":t} ${o==""?"Unversioned":o} ${String(l).split("\\").at(-1)}`}function Qs(t){return String(t).split("\\").at(-1)}const Ys="http://localhost:4000",Xs=40,Js="40px";function he(t,o="info",l=3e3,a=!1){return{position:"top",variant:"solid",title:a?"Server Notification":"Client Notification",description:t,status:o,duration:l,isClosable:!0}}const Ye=s.createContext({socket:null,toast:null,config:null,updateConfig:t=>{},isDebug:!1,setIsDebug:t=>{},configurableRowData:[],setConfigurableRowData:t=>{},branchInfos:{},setBranchInfos:t=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:t=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:t=>{},isCommitMode:!1,setIsCommitMode:t=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:t=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:t=>{},sourceBranch:null,setSourceBranch:t=>{},branchOptions:[],issueNumber:null,setIssueNumber:t=>{},commitMessage:"",setCommitMessage:t=>{},selectedLocalChanges:[],setSelectedLocalChanges:t=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:t=>{},socketPayload:null,setSocketPayload:t=>{},logData:[],setLogData:t=>{}}),A=()=>s.useContext(Ye),Ks=({children:t})=>{const[o,l]=s.useState(null),[a,r]=s.useState(null),i=ss(),[n,u]=s.useState(localStorage.getItem("isDebug")==="true");s.useEffect(()=>{const p=ts(Ys);return r(p),p.on("connect",()=>{p.emit("titan-config-get","fetch"),p.once("titan-config-get",U=>{l(U),i(he("Configurations Loaded","success",2e3))})}),p.on("notification",U=>{i(he(U.description,U.status,U.duration,!0))}),p.on("disconnect",()=>{i(he("Server Has Been Disconnected","warning",0,!0))}),p.on("reconnect",()=>{i(he("Server Has Been Reconnected","success",2e3,!0))}),()=>{p.disconnect()}},[]),s.useEffect(()=>{localStorage.setItem("isDebug",String(n))},[n]);const c=s.useCallback(p=>{p!=null&&(console.log("Saving config:",p),a==null||a.emit("titan-config-set",p))},[a]),d=s.useCallback(p=>{l(U=>{const Q=p(U);return c(Q),Q})},[l,c]),[h,m]=s.useState([]),[D,I]=s.useState({}),F=s.useRef(null),[k,w]=s.useState([]),[y,g]=s.useState(!1),[f,j]=s.useState(!1),[v,S]=s.useState([]),V=s.useRef(null),E=s.useRef(null),[z,P]=s.useState(!1),[q,_]=s.useState(null),W=s.useMemo(()=>h.filter(p=>p["Branch Folder"]&&p["Branch Version"]&&p["SVN Branch"]&&p["Branch Folder"]!==""&&p["Branch Version"]!==""&&p["SVN Branch"]!=="").map(p=>({value:p.id,label:ye(p["Branch Folder"],p["Branch Version"],p["SVN Branch"])})),[h]),[x,T]=s.useState(null),[Y,ie]=s.useState(""),[Z,$]=s.useState([]),[b,B]=s.useState([]),[O,G]=s.useState(null),[ce,Be]=Ne.useState([]);return s.useEffect(()=>{S([]),P(!1)},[h]),s.useEffect(()=>{if(!f||!z)return;const p=setTimeout(()=>{var U;(U=document.getElementById("sectionCommit"))==null||U.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(p)},[f,z]),s.useEffect(()=>{if(k.length<1||z){k.length<1&&j(!1);return}S([]),G(null),ae(k).forEach(p=>{console.debug("Emitting svn-status-single for branch:",p),a==null||a.emit("svn-status-single",{selectedBranch:p})})},[a,k,z]),s.useEffect(()=>{const p=()=>{P(!1)};return a==null||a.on("branch-refresh-unseen",p),()=>a==null?void 0:a.off("branch-refresh-unseen",p)},[a]),s.useEffect(()=>{const p=U=>{n&&console.debug("Received branch status data:",U),S(Q=>[...Q,U])};return a==null||a.on("branch-status-single",p),()=>a==null?void 0:a.off("branch-status-single",p)},[a]),s.useEffect(()=>{Be([])},[k]),s.useEffect(()=>{ce.length===0&&a&&w(p=>(p.length>0&&a.emit("svn-log-selected",{selectedBranches:k}),p))},[ce,a]),s.useEffect(()=>{const p=U=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),Be(Q=>Q.some(es=>es.id===U.id)?Q:[...Q,U])};return a==null||a.on("svn-log-result",p),()=>a==null?void 0:a.off("svn-log-result",p)},[a]),e.jsx(Ye.Provider,{value:{socket:a,toast:i,config:o,updateConfig:d,isDebug:n,setIsDebug:u,configurableRowData:h,setConfigurableRowData:m,branchInfos:D,setBranchInfos:I,branchTableGridRef:F,selectedBranches:k,setSelectedBranches:w,showSelectedBranchesLog:y,setShowSelectedBranchesLog:g,isCommitMode:f,setIsCommitMode:j,selectedBranchStatuses:v,setSelectedBranchStatuses:S,localChangesGridRef:V,untrackedChangesGridRef:E,showCommitView:z,setShowCommitView:P,sourceBranch:q,setSourceBranch:_,branchOptions:W,issueNumber:x,setIssueNumber:T,commitMessage:Y,setCommitMessage:ie,selectedLocalChanges:Z,setSelectedLocalChanges:$,selectedUntrackedChanges:b,setSelectedUntrackedChanges:B,socketPayload:O,setSocketPayload:G,logData:ce,setLogData:Be},children:t})};function re(){const{socket:t}=A(),o=s.useCallback(()=>{t==null||t.emit("titan-config-open",{})},[t]),l=s.useCallback((c,d,h,m)=>{t==null||t.emit("svn-update-single",{id:c,branch:d,version:h,folder:m})},[t]),a=s.useCallback((c,d,h,m)=>{t==null||t.emit("svn-info-single",{id:c,branch:d,version:h,folder:m})},[t]),r=s.useCallback(c=>{t==null||t.emit("svn-commit",c)},[t]),i=s.useCallback(c=>{t==null||t.emit("svn-files-revert",{filesToProcess:c})},[t]),n=s.useCallback(c=>{t==null||t.emit("svn-files-add-remove",{filesToProcess:c})},[t]),u=s.useCallback((c,d,h,m=null)=>{t==null||t.emit("trello-search-names-card",{key:c,token:d,query:h,limit:m})},[t]);return{emitOpenConfig:o,emitUpdateSingle:l,emitInfoSingle:a,emitCommitPayload:r,emitFilesRevert:i,emitFilesAddRemove:n,emitTrelloCardNamesSearch:u}}function K(){const{toast:t}=A(),o=s.useCallback((l="",a="info",r=3e3,i=null)=>{const n=he(l,a,r);if(t)return t(n);if(i)return i(n)},[t]);return{toast:t,RaiseClientNotificaiton:o}}function Zs(){const{config:t,isDebug:o,setIsDebug:l}=A(),{emitOpenConfig:a}=re(),{RaiseClientNotificaiton:r}=K(),i=s.useCallback(()=>{window.electron.checkForUpdates().then(u=>{console.debug("Check for updates result: ",u)}),window.electron.on("update-not-available",()=>{r("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[r]),n=s.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(u=>{r(`Application Version: v${u}`,"info",2e3)})},[r]);return e.jsxs(Te,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Me,{alignItems:"center",children:[e.jsx(Pe,{onClick:n,children:e.jsx(ns,{src:Gs,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(J,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(J,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Me,{alignItems:"center",columnGap:2,children:[e.jsx(R,{label:`Current Debug Mode: ${o?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(H,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:o?e.jsx(X,{as}):e.jsx(X,{as:ls}),onClick:()=>l(u=>!u)})}),e.jsx(R,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(H,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(X,{as:os}),onClick:()=>a()})}),e.jsx(R,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(H,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(X,{as:rs}),onClick:i,isDisabled:!window.electron})})]})]})}function et({isAlertOpen:t,onCloseAlert:o,cancelRef:l,removeSelectedRows:a}){return e.jsx(Oe,{isOpen:t,leastDestructiveRef:l,onClose:o,children:e.jsx(ge,{children:e.jsxs(Ue,{children:[e.jsx(xe,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(be,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(we,{children:[e.jsx(M,{ref:l,onClick:o,children:"Cancel"}),e.jsx(M,{colorScheme:"red",onClick:a,ml:3,children:"Delete"})]})]})})})}function Ee(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}function st(){const[t,o]=s.useState(Ee());return s.useEffect(()=>{function l(){o(Ee())}return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}function tt({rowData:t,onRowValueChanged:o}){const{config:l,branchTableGridRef:a,updateConfig:r,isDebug:i,selectedBranches:n,setSelectedBranches:u,setSelectedBranchStatuses:c,setShowCommitView:d}=A(),h=st(),[m,D]=s.useState(h.height>768),I=s.useCallback(f=>{const j={...f,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};r(v=>({...v,branches:ae([...v.branches,j])}))},[r]),F=s.useCallback(f=>{var v,S,V,E;const j=(S=(v=a==null?void 0:a.current)==null?void 0:v.api)==null?void 0:S.getSelectedNodes().map(z=>z.data);if(i&&console.log("SectionBranches.jsx: onSelectionChanged - event",f),i&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",n),(f==null?void 0:f.source)=="rowDataChanged"){const z=n.map(P=>P.id);(E=(V=a==null?void 0:a.current)==null?void 0:V.api)==null||E.forEachNode(P=>{z.includes(P.data.id)&&P.setSelected(!0)});return}else["api"].includes(f==null?void 0:f.source)||(u(j),c([]),d(!1))},[i,a,n,u,d]),k=s.useCallback(f=>{const j=[];f.api.forEachNode(v=>j.push(v.data)),i&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",j),r(v=>({...v,branches:ae(j)}))},[r,i]),w=s.useCallback(f=>{const j=l==null?void 0:l.branchFolderColours[f.data["Branch Folder"]];return{backgroundColor:j?`${j}20`:"transparent"}},[l==null?void 0:l.branchFolderColours]),y=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),g=s.useMemo(()=>{const f=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:j=>e.jsx(R,{label:"Copy Row",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>I(j.data),icon:e.jsx(ve,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:j=>j.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return m?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:is,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...f]:f},[l,m,I]);return s.useEffect(()=>{D(h.height>768)},[h]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:m?"auto":"428px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:y,columnDefs:g,stopEditingWhenCellsLoseFocus:!0,getRowStyle:w,onRowDragEnd:k,domLayout:m?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:F,onRowValueChanged:o,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:f=>f.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!m,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function nt(){const{updateConfig:t,isDebug:o,socket:l,configurableRowData:a,setConfigurableRowData:r,branchInfos:i,config:n,setBranchInfos:u,setSelectedBranches:c,setSelectedBranchStatuses:d,showCommitView:h,setShowCommitView:m}=A(),[D,I]=s.useState([]),F=s.useCallback(k=>{o&&console.log("AG Grid: onRowValueChanged - event",k),o&&console.log("AG Grid: onRowValueChanged - rowDataBranches",D),t(w=>({...w,branches:ae(D)}))},[D,t,o]);return s.useEffect(()=>{const k=me.debounce(()=>{const w=a.map(y=>({...y,"Branch Info":i[y.id]||"Hasn't been refreshed"}));I(y=>me.isEqual(w,y)?y:w)},300);return k(),()=>k.cancel()},[a,i]),s.useEffect(()=>{r(k=>n&&n.branches&&!me.isEqual(n.branches,k)?n.branches:k)},[n]),s.useEffect(()=>{const k=w=>{u(y=>{const g={...y,[w.id]:w.info};return console.debug("branch-info-single data received:",w),console.debug("branch-info-single newBranchInfos",g),c(f=>(f.find(v=>v.id===w.id)&&h&&(d([]),m(!1)),f)),g})};return l==null||l.on("branch-info-single",k),()=>l==null?void 0:l.off("branch-info-single")},[l,h]),{rowDataBranches:D,setRowDataBranches:I,onRowValueChanged:F}}function lt(){const{socket:t,updateConfig:o,isDebug:l,setShowSelectedBranchesLog:a,configurableRowData:r,branchTableGridRef:i,selectedBranches:n,setSelectedBranches:u,isCommitMode:c,setIsCommitMode:d,setSelectedBranchStatuses:h,setShowCommitView:m}=A(),{emitUpdateSingle:D,emitInfoSingle:I}=re(),{RaiseClientNotificaiton:F}=K(),[k,w]=s.useState(!1),y=s.useRef(),g=()=>w(!1),{rowDataBranches:f,setRowDataBranches:j,onRowValueChanged:v}=nt(),[S,V]=s.useState(0),[E,z]=s.useState([]),P=s.useCallback(()=>{var b,B;l&&console.log("SectionBranches.jsx: clearSelection: START"),(B=(b=i==null?void 0:i.current)==null?void 0:b.api)==null||B.deselectAll(),u([]),d(!1)},[l,i,u]),q=s.useCallback(()=>{var B,O;const b=(O=(B=i==null?void 0:i.current)==null?void 0:B.api)==null?void 0:O.getSelectedNodes().map(G=>G.data);u(b),w(!0)},[i,u]),_=s.useCallback(()=>{const b={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};o(B=>({...B,branches:ae([...B.branches,b])}))},[o]),W=s.useCallback(()=>{n.forEach(b=>{D(b.id,b["SVN Branch"],b["Branch Version"],b["Branch Folder"])})},[n,D]),x=s.useCallback(()=>{E.forEach(b=>{D(b.id,b["SVN Branch"],b["Branch Version"],b["Branch Folder"])})},[E,D]),T=s.useCallback(()=>{const b=n.map(O=>O.id),B=f.filter(O=>!b.includes(O.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",B),o(O=>({...O,branches:ae(B)})),P(),g()},[n,f,o]),Y=s.useCallback(()=>{a(!0)},[]),ie=s.useCallback(()=>{j(b=>{const B=[...b];return n.forEach(O=>{const G=B.findIndex(ce=>ce.id===O.id);B[G]["Branch Info"]="Refreshing..."}),B}),n.forEach(b=>{I(b.id,b["SVN Branch"],b["Branch Version"],b["Branch Folder"])})},[n,I]),Z=s.useCallback(()=>{if(c){F("Unable to refresh branches while in commit mode","warning",0);return}F("Refreshing all branches. Please wait until this is done!","info",3e3);const b=Date.now();r.forEach(B=>{I(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])}),V(b)},[r,I,F,c]),$=s.useCallback(()=>{d(b=>!b),m(!1)},[d]);return s.useEffect(()=>{const b=f.filter(B=>String(B["Branch Info"]).toLowerCase().includes("behind"));z(b)},[f]),s.useEffect(()=>{const B=Date.now();if(r.length>0){B-S>3e5&&Z();const O=setInterval(()=>{Z()},3e5);return()=>clearInterval(O)}},[r,S,Z]),s.useEffect(()=>{const b=B=>{l&&console.debug("branch-success-single data received:",B),I(B.id,B.branch,B.version,B.folder)};return t==null||t.on("branch-success-single",b),()=>t==null?void 0:t.off("branch-success-single",b)},[l,t,I]),e.jsxs("div",{children:[e.jsxs(Te,{mb:4,justify:"space-between",children:[e.jsxs(N,{columnGap:2,children:[e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:ie,leftIcon:e.jsx(je,{}),colorScheme:"yellow",isDisabled:n.length<1,children:["Refresh ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:W,leftIcon:e.jsx(X,{as:cs}),colorScheme:"yellow",isDisabled:n.length<1,children:["Update ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(M,{onClick:$,leftIcon:e.jsx(X,{as:We}),colorScheme:"yellow",isDisabled:n.length<1,children:c?"Undo Commit":"Commit"})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(M,{onClick:Y,leftIcon:e.jsx(ds,{}),colorScheme:"yellow",isDisabled:n.length<1,children:"View Logs"})})]}),e.jsx(N,{columnGap:2,children:e.jsx(R,{label:"No outdated branches to update",isDisabled:E.length>0,hasArrow:!0,children:e.jsx(M,{onClick:x,leftIcon:e.jsx(hs,{}),colorScheme:"yellow",isDisabled:E.length<1,children:"Update Outdated"})})})]}),e.jsx(tt,{rowData:f,onRowValueChanged:v}),e.jsxs(N,{columnGap:2,mt:4,children:[e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:P,leftIcon:e.jsx(Re,{}),colorScheme:"red",isDisabled:n.length<1,children:["Deselect ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(M,{onClick:q,leftIcon:e.jsx(Re,{}),colorScheme:"red",isDisabled:n.length<1,children:["Delete ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(M,{onClick:_,leftIcon:e.jsx(us,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(et,{isAlertOpen:k,onCloseAlert:g,cancelRef:y,removeSelectedRows:T})]})}function Xe(t){const{data:o,onDiffResult:l}=t,a=async()=>{try{const r=await window.electron.openTortoiseSVNDiff({fullPath:o["Full Path"],branchFolder:o["Branch Folder"],branchVersion:o["Branch Version"]});l(r)}catch(r){l({success:!1,error:r.message})}};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(fs,{}),onClick:a,colorScheme:"yellow"})}function at({isModalOpen:t,closeModal:o}){const{socket:l,setIsCommitMode:a,setSelectedBranchStatuses:r,setShowCommitView:i,socketPayload:n}=A(),{emitUpdateSingle:u,emitCommitPayload:c}=re(),{RaiseClientNotificaiton:d}=K(),[h,m]=s.useState([]),{onCopy:D,value:I,setValue:F,hasCopied:k}=Le(""),{onCopy:w,value:y,setValue:g,hasCopied:f}=Le(""),j=s.useCallback(x=>{x.success?d("TortoiseSVN diff opened successfully","success",3e3):d(`Error opening TortoiseSVN diff: ${JSON.stringify(x.error,null,4)}`,"error",0)},[d]),v=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:S,setActiveStep:V}=ms({index:1,count:v.length}),E=s.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),z=s.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:Xe,cellRendererParams:{onDiffResult:j},width:90}],[]),P=s.useCallback(()=>{V(x=>x-1)},[V]),q=s.useCallback(()=>{V(x=>x+1)},[V]),_=s.useCallback((x,T)=>{const Y="â€‹".repeat(7),ie=T.includes("MarkupSupport")?`\r
${Y}`:`\r
`;return x.sort(($,b)=>$["Branch Version"].localeCompare(b["Branch Version"])).map($=>{const b=[];T.includes("BranchFolder")&&b.push($["Branch Folder"]),T.includes("BranchVersion")&&b.push($["Branch Version"]),T.includes("SVNBranch")&&b.push($.branchPathFolder);let B=b.join(" ").trim();if(T.includes("IssueNumber")){const G=$["Branch Folder"]===n.sourceBranch["Branch Folder"]?n.issueNumber:"XXXXXX";B+=` Issue [${G}]`}const O=$.revision?$.revision:$.errorMessage||"Error";return B+=` Revision [${O}]`,B}).join(ie)},[n]),W=s.useCallback(x=>{const T=_(h,x);F(T)},[h,_,F]);return s.useEffect(()=>{V(1),m([]),F(""),g("")},[t,m]),s.useEffect(()=>{!t||S!=0||(o(),V(1),m([]),F(""),g(""))},[S,t]),s.useEffect(()=>{!t||S!=2||c(n)},[S,t,c,n]),s.useEffect(()=>{!t||S!=3||(d("The commit process has been completed successfully","success",5e3),W(["BranchFolder","BranchVersion","SVNBranch"]),g(n.commitMessage||""))},[d,S,t,W]),s.useEffect(()=>{!t||S<=3||(D(),d("Updating selected branches! Please wait","info",1500),h.forEach(x=>{u(x.branchId,x["SVN Branch"],x["Branch Version"],x["Branch Folder"])}),a(!1),r([]),i(!1),o(),V(1))},[d,S,t,h,u]),s.useEffect(()=>{const x=T=>{m(Y=>[...Y,T])};return l==null||l.on("svn-commit-status-live",x),()=>l==null?void 0:l.off("svn-commit-status-live",x)},[l]),s.useEffect(()=>{if(S!=2)return;const x=setTimeout(()=>{h.length>0&&h[0].bulkCommitLength==h.length&&V(3)},3e3);return()=>clearTimeout(x)},[S,h]),s.useEffect(()=>{(k||f)&&d("Copied to Clipboard","success",1500)},[k,f,d]),!t||!n?e.jsx(e.Fragment,{}):e.jsxs(He,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:S==1,children:[e.jsx(ge,{}),e.jsxs(_e,{maxH:"85%",maxW:"95%",children:[e.jsx(xe,{children:e.jsx(J,{as:"h2",size:"lg",children:"Commit Selected Files"})}),S==1?e.jsx(Se,{size:"lg"}):e.jsx(e.Fragment,{}),e.jsxs(be,{children:[e.jsx(gs,{index:S,mb:6,size:"lg",colorScheme:"yellow",children:v.map((x,T)=>e.jsxs(xs,{children:[e.jsx(bs,{children:e.jsx(ps,{complete:e.jsx(Cs,{}),incomplete:e.jsx(Ae,{}),active:e.jsx(Ae,{})})}),e.jsxs(C,{flexShrink:"0",children:[e.jsx(ws,{children:x.title}),e.jsx(js,{children:x.description})]}),e.jsx(Ss,{})]},T))}),e.jsxs(C,{children:[S!=1?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(L,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Ie,{spacing:3,children:[e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Source Branch: ",e.jsx(ee,{children:ye(n.sourceBranch["Branch Folder"],n.sourceBranch["Branch Version"],n.sourceBranch["SVN Branch"])})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Issue Number: ",e.jsx(ee,{children:n.issueNumber})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Commit Message: ",e.jsx(ee,{children:n.commitMessage})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Example:"," ",e.jsxs(ee,{children:["Issue ",n.issueNumber," (",n.sourceBranch["Branch Folder"]," ",n.sourceBranch["Branch Version"],"): ",n.commitMessage]})]})]})]}),e.jsx(C,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(oe,{rowData:n.filesToProcess,defaultColDef:E,columnDefs:z,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),S!=2?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(L,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(C,{children:e.jsx(Ie,{spacing:3,children:h.map((x,T)=>e.jsxs(se,{children:[e.jsx(te,{as:x.errorMessage?ys:ne,color:x.errorMessage?"red.500":"yellow.500"}),x.branchString,":Â ",e.jsx(ee,{children:x.errorMessage||x.revision})]},T))})})]}),S!=3?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsx(C,{mb:4,children:e.jsxs(L,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(N,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(J,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(C,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:I})})]}),e.jsx(C,{children:e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:D,icon:e.jsx(ve,{}),colorScheme:"yellow"})})})]}),e.jsxs(C,{my:4,children:[e.jsx(L,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Bs,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:W,children:e.jsxs(Te,{children:[e.jsx(de,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(de,{value:"BranchVersion",children:"Branch Version"}),e.jsx(de,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(de,{value:"IssueNumber",children:"Issue Number"}),e.jsx(de,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(N,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(L,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),e.jsx(ee,{children:`Issue ${n.issueNumber} (${n.sourceBranch["Branch Folder"]} ${n.sourceBranch["Branch Version"]}): ${y}`})]}),e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:w,icon:e.jsx(ve,{}),colorScheme:"yellow"})})]})]})]})]}),e.jsxs(we,{children:[e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:S<2,children:e.jsx(M,{onClick:P,mr:3,isDisabled:S>=2,children:S==1?"Cancel":"Previous"})}),e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:S!=2,children:e.jsx(M,{colorScheme:"yellow",onClick:q,isDisabled:S==2,children:S==v.length?"Complete":"Next"})})]})]})]})}function ot({fileUpdates:t}){return e.jsx(C,{children:Object.keys(t).length>0?e.jsxs(C,{children:[e.jsx(L,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(C,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(ks,{children:[e.jsx(Ds,{children:e.jsxs(Ve,{children:[e.jsx(pe,{children:"Branch"}),e.jsx(pe,{children:"Path"}),e.jsx(pe,{children:e.jsx(R,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(pe,{children:e.jsx(R,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(vs,{children:Object.keys(t).map(o=>e.jsx(Ne.Fragment,{children:t[o].map((l,a)=>e.jsxs(Ve,{children:[e.jsx(Ce,{children:o}),e.jsx(Ce,{children:l.pathDisplay}),e.jsx(Ce,{children:l.wcStatus}),e.jsx(Ce,{children:l.reposStatus})]},a))},o))})]})}),e.jsx(L,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(C,{children:e.jsx(L,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function rt({rowDataLocalChanges:t,setRowDataLocalChanges:o,defaultColDefsCommit:l}){const{localChangesGridRef:a,isDebug:r,selectedBranches:i,showCommitView:n,setSelectedLocalChanges:u,selectedLocalChanges:c}=A(),{emitFilesRevert:d}=re(),{RaiseClientNotificaiton:h}=K(),[m,D]=s.useState(""),I=s.useCallback(()=>{d(c)},[d,c]),F=s.useCallback(g=>{D(g.target.value)},[D]),k=s.useCallback(()=>{var f,j;const g=(j=(f=a==null?void 0:a.current)==null?void 0:f.api)==null?void 0:j.getSelectedNodes().map(v=>v.data);r&&console.log("CommitRegion.jsx: onFileViewSelectionChanged - selectedBranches",g),u(g)},[a,r]),w=s.useCallback(g=>{g.success?h("TortoiseSVN diff opened successfully","success",3e3):h(`Error opening TortoiseSVN diff: ${JSON.stringify(g.error,null,4)}`,"error",0)},[h]),y=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:Xe,cellRendererParams:{onDiffResult:w},width:90}],[]);return s.useEffect(()=>{i.length<1||n||(D(""),o([]),u([]))},[i,n]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsxs(N,{mb:4,alignItems:"center",children:[e.jsx(L,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:F,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:l,columnDefs:y,onSelectionChanged:k,quickFilterText:m,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(N,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:c.length>0,children:e.jsx(M,{onClick:I,colorScheme:"red",isDisabled:c.length<1,children:"Revert Selected"})})})]}):e.jsx(C,{children:e.jsx(L,{children:"Your selected branches do not contain any files to commit."})})})}function it({rowDataUntrackedChanges:t,setRowDataUntrackedChanges:o,defaultColDefsCommit:l}){const{untrackedChangesGridRef:a,selectedUntrackedChanges:r,setSelectedUntrackedChanges:i,isDebug:n,selectedBranches:u,showCommitView:c}=A(),{emitFilesAddRemove:d,emitFilesRevert:h}=re(),[m,D]=s.useState(""),I=s.useCallback(g=>{D(g.target.value)},[D]),F=s.useCallback(()=>{var f,j;const g=(j=(f=a==null?void 0:a.current)==null?void 0:f.api)==null?void 0:j.getSelectedNodes().map(v=>v.data);n&&console.log("CommitRegion.jsx: onUnseenFilesSelectionChanged - selectedBranches",g),i(g)},[a,n]),k=s.useCallback(()=>{d(r)},[d,r]),w=s.useCallback(()=>{h(r)},[h,r]),y=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return s.useEffect(()=>{u.length<1||c||(D(""),o([]),i([]))},[u,c]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsx(L,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(N,{mb:4,alignItems:"center",children:[e.jsx(L,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:I,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:l,columnDefs:y,onSelectionChanged:F,quickFilterText:m,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(N,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(M,{onClick:k,colorScheme:"green",isDisabled:r.length<1,children:["Add/Remove ",r.length," File",r.length>1?"s":""]})}),e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(M,{onClick:w,colorScheme:"red",isDisabled:r.length<1,children:["Revert ",r.length," File",r.length>1?"s":""]})})]})]}):e.jsx(C,{children:e.jsx(L,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function ct(){const{issueNumber:t,setIssueNumber:o}=A(),l=a=>{const r=String(a.target.value);/^\d*$/.test(r)&&o(r.trim())};return e.jsx(le,{value:t,onChange:l,placeholder:"Enter number"})}function dt({openMessageAutoFillModal:t}){const{sourceBranch:o,setSourceBranch:l,branchOptions:a,setIssueNumber:r,commitMessage:i,setCommitMessage:n,isCommitMode:u}=A(),c=s.useCallback(h=>{l(h)},[l]),d=s.useCallback(h=>{n(String(h.target.value).replace(/["`]/g,"'"))},[n]);return s.useEffect(()=>{u&&(l(null),r(""),n(""))},[u]),e.jsxs(C,{children:[e.jsxs(N,{columnGap:2,mb:2,children:[e.jsx(C,{width:"50%",children:e.jsxs(ke,{isRequired:!0,children:[e.jsx(De,{children:"Source Branch"}),e.jsx(Rs,{value:o,onChange:c,options:a,placeholder:"Select branch you would like to commit from",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsxs(N,{width:"50%",alignItems:"flex-end",columnGap:2,children:[e.jsxs(ke,{isRequired:!0,children:[e.jsx(De,{children:"Issue Number"}),e.jsx(ct,{})]}),e.jsx(R,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>t(),icon:e.jsx($e,{})})})]})]}),e.jsx(N,{children:e.jsxs(ke,{width:"100%",isRequired:!0,children:[e.jsx(De,{children:"Commit Message"}),e.jsx(Is,{placeholder:"Enter Commit Message",resize:"vertical",onInput:d,value:i})]})})]})}function ht({openCommitModal:t}){const{setShowCommitView:o,selectedLocalChanges:l,sourceBranch:a,issueNumber:r,commitMessage:i,setSocketPayload:n,selectedBranches:u}=A(),{RaiseClientNotificaiton:c}=K(),d=s.useCallback(()=>{o(!1)},[o]),h=s.useCallback(()=>{if(!a){c("Please select the source branch to proceed!","error");return}if(!r||i===""){c("Please provide the issue number and the commit message to proceed!","error");return}n({sourceBranch:u.find(m=>m.id==a.value),issueNumber:r,commitMessage:i,filesToProcess:l}),t()},[a,r,i,c,l,u]);return e.jsx(C,{children:e.jsxs(N,{columnGap:2,justifyContent:"center",children:[e.jsx(M,{onClick:d,leftIcon:e.jsx(je,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(R,{label:"Select at least 1 file",hasArrow:!0,isDisabled:l.length>0,children:e.jsxs(M,{onClick:h,leftIcon:e.jsx(X,{as:We}),colorScheme:"yellow",isDisabled:l.length<1,children:["Commit ",l.length>0?`${l.length} File`:"",l.length>1?"s":""]})})]})})}function ut(){const{selectedBranches:t,logData:o,setLogData:l}=A(),[a,r]=s.useState([]),[i,n]=s.useState(""),u=s.useCallback(h=>{n(h.target.value)},[n]),c=s.useCallback(()=>{l([])},[l]),d=o.length===t.length;return s.useEffect(()=>{if(o.length===0)return;const h=o.map(m=>m.logs).flat();r(m=>me.isEqual(m,h)?m:h)},[o]),{rowDataLogs:a,quickFilterLogsText:i,setQuickFilterLogsText:n,onQuickFilterLogsInputChanged:u,refreshLogs:c,areLogsFetched:d}}function ft({rowDataLogs:t,quickFilterLogsText:o,setAutoFillSelection:l=null,isAutofill:a=!1}){const r=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=s.useMemo(()=>{const c=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return a?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...c]:c},[a]),n=s.useRef(null),u=s.useCallback(()=>{var c,d;if(l){const h=(d=(c=n==null?void 0:n.current)==null?void 0:c.api)==null?void 0:d.getSelectedNodes().map(m=>m.data);l(h[0]||null)}},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:a?"90%":"85%",width:"100%"},children:e.jsx(oe,{ref:n,rowData:t,defaultColDef:r,columnDefs:i,onSelectionChanged:u,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!a,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function Je({setAutoFillSelection:t=!1,isAutofill:o=!1}){const{selectedBranches:l,logData:a}=A(),{rowDataLogs:r,quickFilterLogsText:i,onQuickFilterLogsInputChanged:n,refreshLogs:u,areLogsFetched:c}=ut();return c?e.jsxs(C,{h:"100%",children:[e.jsxs(N,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(N,{alignItems:"center",width:"100%",children:[e.jsx(L,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:n,width:"100%"})]}),e.jsx(C,{children:e.jsx(R,{label:"Refresh",hasArrow:!0,children:e.jsx(H,{onClick:u,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(ft,{rowDataLogs:r,quickFilterLogsText:i,setAutoFillSelection:t,isAutofill:o})]}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(L,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Ie,{spacing:3,children:l.map(d=>{const h=a.find(m=>m.id===d.id);return e.jsxs(se,{display:"flex",alignItems:"center",children:[e.jsx(te,{w:30,h:30,as:h?ne:Fs,color:"yellow.500"}),ye(d["Branch Folder"],d["Branch Version"],d["SVN Branch"])]},d.branchId)})})]}),e.jsx(N,{justifyContent:"center",children:e.jsx(Ns,{value:a.length/l.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Ts,{children:[a.length," / ",l.length]})})})]})}function mt(t){const{data:o}=t,l=async()=>{window.open(o.url,"_blank")};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(Ms,{}),onClick:l,colorScheme:"yellow"})}function gt({rowDataTrello:t,quickFilterTrelloText:o,setAutoFillSelection:l}){const a=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=s.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:mt,width:120}],[]),i=s.useRef(null),n=s.useCallback(()=>{var c,d;const u=(d=(c=i==null?void 0:i.current)==null?void 0:c.api)==null?void 0:d.getSelectedNodes().map(h=>h.data);l(u[0]||null)},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(oe,{ref:i,rowData:t,defaultColDef:a,columnDefs:r,onSelectionChanged:n,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function xt({setAutoFillSelection:t}){const{config:o,socket:l}=A(),{emitTrelloCardNamesSearch:a}=re(),r=o==null?void 0:o.trelloIntegration,i=(r==null?void 0:r.key)||null,n=(r==null?void 0:r.token)||null,u=i&&n&&i.trim()!==""&&n.trim()!==""&&i.toUpperCase()!=="TRELLO_API_KEY"&&n.toUpperCase!=="TRELLO_TOKEN",[c,d]=s.useState(""),[h,m]=s.useState(""),[D,I]=s.useState([]),F=s.useCallback(me.debounce(g=>{g.trim()!==""&&a(i,n,g)},250),[i,n,a]),k=s.useCallback(g=>{d(String(g.target.value).trim())},[d]),w=s.useCallback(()=>{c.trim()!==""&&a(i,n,c)},[c,i,n,a]),y=s.useCallback(g=>{m(g.target.value)},[]);return s.useEffect(()=>(F(c),()=>F.cancel()),[c,F]),s.useEffect(()=>{const g=f=>{I(f&&f.length>0?f:[])};return l==null||l.on("trello-result-search-names-card",g),()=>l==null?void 0:l.off("trello-result-search-names-card",g)},[l]),u?e.jsxs(C,{h:"100%",children:[e.jsxs(N,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(N,{alignItems:"center",width:"100%",children:[e.jsx(L,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(le,{placeholder:"Type to search...",onInput:k,width:"100%"})]}),e.jsx(C,{children:e.jsx(R,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(H,{onClick:w,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(N,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(N,{alignItems:"center",width:"100%",children:[e.jsx(L,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:y,width:"100%"})]})}),e.jsx(gt,{rowDataTrello:D,quickFilterTrelloText:h,setAutoFillSelection:t})]}):e.jsx(C,{h:"100%",p:4,children:e.jsxs(L,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(Pe,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx($e,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function bt({isModalOpen:t,closeModal:o}){const{setSourceBranch:l,branchOptions:a,setIssueNumber:r,setCommitMessage:i}=A(),[n,u]=s.useState(0),[c,d]=s.useState([null,null]),[h,m]=s.useState(!0),D=s.useCallback(w=>{u(w),d(w===0?y=>[y[0],null]:y=>[null,y[1]])},[u]),I=s.useCallback(w=>{d(y=>[w,...y.slice(1)])},[d]),F=s.useCallback(w=>{d(y=>[y[0],w])},[d]),k=s.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",n),console.debug("Selected autofill selection:",JSON.stringify(c,null,4));let w=c[n];if(n===0){const y=w.message,g=w.branchId,f=y.match(/\s*(Issue)*\s*(\d+)\s*/),j=f?f[2]:null,v=y.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");g&&l(a.find(S=>S.value===g)),j&&r(j),v.trim()!==""&&i(v)}else{const y=w.name,g=y.match(/\s*(Issue)*\s*(\d+)\s*/),f=g?g[2]:null,j=y.replace(/\s*(Issue)*\s*(\d+)/,"");f&&r(f),j.trim()!==""&&i(j)}o()},[n,c,o]);return s.useEffect(()=>{m(!(c.length==2&&(c[0]||c[1])))},[c]),s.useEffect(()=>{d([null,null])},[t]),e.jsxs(He,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(ge,{}),e.jsxs(_e,{maxH:"95%",maxW:"95%",children:[e.jsx(xe,{children:e.jsx(J,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(Se,{size:"lg"}),e.jsx(be,{children:e.jsx(C,{height:"70vh",children:e.jsxs(qe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:w=>D(w),children:[e.jsxs(Ge,{children:[e.jsx(ue,{children:"SVN Logs"}),e.jsx(ue,{children:"Trello"})]}),e.jsxs(Qe,{h:"90%",children:[e.jsx(fe,{px:0,pb:0,h:"100%",children:e.jsx(Je,{setAutoFillSelection:I,isAutofill:!0})}),e.jsx(fe,{px:0,pb:0,h:"100%",children:e.jsx(xt,{setAutoFillSelection:F})})]})]})})}),e.jsxs(we,{children:[e.jsx(M,{mr:3,onClick:()=>o(),children:"Cancel"}),e.jsx(R,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!h,children:e.jsx(M,{colorScheme:"yellow",onClick:k,isDisabled:h,children:"Select"})})]})]})]})}function pt(){const{isDebug:t,setIsCommitMode:o,selectedBranchStatuses:l,showCommitView:a,setShowCommitView:r,selectedBranches:i,configurableRowData:n}=A(),[u,c]=s.useState({}),[d,h]=s.useState([]),[m,D]=s.useState([]),{isOpen:I,onOpen:F,onClose:k}=Fe(),{isOpen:w,onOpen:y,onClose:g}=Fe(),f=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);s.useEffect(()=>{if(i.length<1||a){i.length<1&&o(!1);return}c({})},[i,a]),s.useEffect(()=>{t&&(console.debug("Branch Status Rows:",l),console.debug("Selected Rows:",i))},[t,l,i]),s.useEffect(()=>{l.length===i.length&&(l.forEach(E=>{let z=E.id,P=E.status.filesToCommit,q=E.status.filesToUpdate;const _=n.find(W=>W.id===z);if(q.length>0){const W=ye(_["Branch Folder"],_["Branch Version"],_["SVN Branch"]);c(x=>({...x,[W]:[...x[W]||[],...q]}))}if(P.length>0){const W=P.map(x=>({branchId:z,"Branch Folder":_["Branch Folder"],"Branch Version":_["Branch Version"],"SVN Branch":_["SVN Branch"],"Full Path":x.path,"File Path":`${Qs(E.status.branch)}\\${x.pathDisplay}`,"Local Status":x.wcStatus}));h(x=>[...x,...W.filter(T=>!["unversioned","missing"].includes(T["Local Status"]))]),D(x=>[...x,...W.filter(T=>["unversioned","missing"].includes(T["Local Status"]))])}}),r(!0))},[l,i,n]);const j=Object.keys(u).length>0,v=d.length>0,S=m.length>0,V=j||v||S;return e.jsxs(C,{children:[e.jsx(C,{mb:6,children:e.jsx(dt,{openMessageAutoFillModal:y})}),e.jsx(Ls,{isLoaded:a&&V,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(qe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:j?0:v?1:2,isLazy:!1,children:[e.jsxs(Ge,{children:[e.jsx(ue,{isDisabled:!j,children:e.jsx(R,{label:"No files to update!",hasArrow:!0,isDisabled:j,children:"Files to Update"})}),e.jsx(ue,{isDisabled:!v,children:e.jsx(R,{label:"No files to commit!",hasArrow:!0,isDisabled:v,children:"Local Changes"})}),e.jsx(ue,{isDisabled:!S,children:e.jsx(R,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:S,children:"Untracked Changes"})})]}),e.jsxs(Qe,{children:[e.jsx(fe,{px:0,children:e.jsx(ot,{fileUpdates:u})}),e.jsx(fe,{px:0,children:e.jsx(rt,{rowDataLocalChanges:d,setRowDataLocalChanges:h,defaultColDefsCommit:f})}),e.jsx(fe,{px:0,children:e.jsx(it,{rowDataUntrackedChanges:m,setRowDataUntrackedChanges:D,defaultColDefsCommit:f})})]})]})}),a&&!V?e.jsx(L,{mt:4,className:"animation-pulse",fontWeight:600,children:"No changes have been spotted! Please use the refresh button ðŸ‘‡ if you have recently made a change"}):e.jsx(e.Fragment,{}),e.jsx(C,{mt:6,children:e.jsx(ht,{openCommitModal:F})}),e.jsx(at,{isModalOpen:I,closeModal:k}),e.jsx(bt,{isModalOpen:w,closeModal:g})]})}function Ct(){const{showSelectedBranchesLog:t,setShowSelectedBranchesLog:o}=A();return e.jsxs(As,{isOpen:t,onClose:()=>o(!1),placement:"left",size:"full",children:[e.jsx(ge,{}),e.jsxs(Vs,{children:[e.jsx(Se,{size:"lg"}),e.jsx(xe,{children:"Selected Branches: SVN Log"}),e.jsx(be,{children:e.jsx(C,{height:"100%",children:e.jsx(Je,{})})})]})]})}function wt(){const{toast:t,RaiseClientNotificaiton:o}=K(),{isOpen:l,onOpen:a,onClose:r}=Fe(),i=s.useRef(),[n,u]=s.useState(!1);s.useEffect(()=>{if(!window.electron){o("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{t.closeAll(),a()}),window.electron.on("update-error",h=>{o(`An error occurred while checking for updates: ${h}`,"error",5e3)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[t,a]);const c=s.useCallback(()=>{r(),o("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[r,o]),d=s.useCallback(()=>{if(n){o("Update is already in progress. Please wait.","info",5e3);return}window.electron?(u(!0),window.electron.downloadUpdate().catch(h=>{u(!1),o(`An error occurred while downloading the update: ${h}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{o("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),r()}),window.electron.on("update-not-available",()=>{o("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),r()})):o("Cannot update Titan in a non-desktop application environment","error",5e3)},[n,o,r]);return e.jsx(Oe,{isOpen:l,leastDestructiveRef:i,onClose:r,motionPreset:"slideInBottom",closeOnOverlayClick:!n,children:e.jsx(ge,{children:e.jsxs(Ue,{children:[e.jsx(xe,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),n?e.jsx(e.Fragment,{}):e.jsx(Se,{}),e.jsx(be,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(we,{children:[e.jsx(M,{colorScheme:"red",ref:i,onClick:c,children:"Cancel"}),e.jsx(M,{colorScheme:"yellow",onClick:d,ml:3,isDisabled:n,children:"Confirm"})]})]})})})}function jt(){if(!window.electron)return e.jsx(e.Fragment,{});const t=s.useCallback(()=>{window.electron.minimizeWindow()},[]),o=s.useCallback(()=>{window.electron.maximizeWindow()},[]),l=s.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Es.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(N,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(J,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(N,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(H,{"aria-label":"Minimize",size:"xs",icon:e.jsx(zs,{}),onClick:t,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Maximize",size:"xs",icon:e.jsx(Ps,{}),onClick:o,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Close",size:"xs",icon:e.jsx(Re,{}),onClick:l,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function St(){const{isCommitMode:t,selectedBranches:o,configurableRowData:l}=A(),{RaiseClientNotificaiton:a}=K();return s.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{a("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(C,{className:"titanBody",children:[e.jsx(jt,{}),e.jsxs(C,{p:10,children:[e.jsx(Zs,{}),e.jsx(wt,{}),e.jsxs(N,{rowGap:4,flexDirection:"column",children:[e.jsx(C,{children:e.jsx(lt,{})}),e.jsx(Os,{in:t,animateOpacity:!0,children:e.jsxs(C,{id:"sectionCommit",children:[e.jsxs(J,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",o.length==l.length?"All":`${o.length}/${l.length}`," Branch",o.length==1?"":"es"]}),e.jsx(pt,{})]})})]}),e.jsx(Ct,{})]})]})}const{definePartsStyle:Ke,defineMultiStyleConfig:Ze}=$s(qs.keys),yt=Ke({dialog:{mt:`${Xs+20}px`,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),Bt=Ze({baseStyle:yt}),kt=Ke({dialog:{mt:Js,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),Dt=Ze({baseStyle:kt}),vt={initialColorMode:"dark",useSystemColorMode:!1},ze=Us({config:vt,components:{Modal:Bt,Drawer:Dt}});Ws.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsxs(Hs,{theme:ze,children:[e.jsx(_s,{initialColorMode:ze.config.initialColorMode}),e.jsx(Ks,{children:e.jsx(St,{})})]})}));
