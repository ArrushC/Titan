import{r as s,u as ns,l as ls,R as Ne,j as e,W as Me,d as Ae,L as Oe,I as as,H as Z,T as R,e as _,f as Y,M as os,g as rs,h as is,i as cs,A as Ue,k as me,m as He,n as ge,o as xe,p as we,B as N,D as ds,C as Re,F as T,q as je,s as hs,t as We,v as us,w as fs,x as Ie,S as ms,V as gs,y as Le,z as xs,E as _e,G as $e,J as Se,K as bs,N as ps,O as Cs,P as ws,Q as js,U as Ve,X as p,Y as Ss,Z as ys,_ as Bs,$ as A,a0 as Fe,a1 as se,a2 as te,a3 as ne,a4 as K,a5 as ks,a6 as Ds,a7 as ce,a8 as vs,a9 as Rs,aa as Is,ab as Ee,ac as pe,ad as Fs,ae as Ce,af as le,ag as De,ah as ve,ai as Ts,aj as qe,ak as Ns,al as Ms,am as As,an as Ls,ao as Vs,ap as Ge,aq as Qe,ar as he,as as Ye,at as ue,au as Te,av as Es,aw as Ps,ax as zs,ay as Os,az as Us,aA as Hs,aB as Ws,aC as _s,aD as $s,aE as qs,aF as Gs,aG as Qs,aH as Ys}from"./vendor-BL59bgv0.js";import{_ as fe}from"./lodash-BR7ow8OG.js";import{A as oe}from"./ag-grid-react-COtiT-7y.js";import"./ag-grid-community-CKfuWc13.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function l(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=l(r);fetch(r.href,i)}})();const Xs="/assets/Titan-H8_3eplJ.png";function ae(t=[]){return(Array.isArray(t)?t:[t]).map(l=>(delete l["Branch Info"],l))}function ye(t,o,l){return`${t==""?"Uncategorised":t} ${o==""?"Unversioned":o} ${String(l).split("\\").at(-1)}`}function Js(t){return String(t).split("\\").at(-1)}const Ks="http://localhost:4000",Zs=40,et="40px";function de(t,o="info",l=3e3,a=!1){return{position:"top",variant:"solid",title:a?"Server Notification":"Client Notification",description:t,status:o,duration:l,isClosable:!0}}const Xe=s.createContext({socket:null,toast:null,config:null,updateConfig:t=>{},isDebug:!1,setIsDebug:t=>{},configurableRowData:[],setConfigurableRowData:t=>{},branchInfos:{},setBranchInfos:t=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:t=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:t=>{},isCommitMode:!1,setIsCommitMode:t=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:t=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:t=>{},sourceBranch:null,setSourceBranch:t=>{},branchOptions:[],issueNumber:null,setIssueNumber:t=>{},commitMessage:"",setCommitMessage:t=>{},selectedLocalChanges:[],setSelectedLocalChanges:t=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:t=>{},socketPayload:null,setSocketPayload:t=>{},postCommitData:{},setPostCommitData:t=>{},logData:[],setLogData:t=>{}}),L=()=>s.useContext(Xe),st=({children:t})=>{const[o,l]=s.useState(null),[a,r]=s.useState(null),i=ns(),[n,u]=s.useState(localStorage.getItem("isDebug")==="true");s.useEffect(()=>{const b=ls(Ks);return r(b),b.on("connect",()=>{b.emit("titan-config-get","fetch"),b.once("titan-config-get",H=>{l(H),i(de("Configurations Loaded","success",2e3))})}),b.on("notification",H=>{i(de(H.description,H.status,H.duration,!0))}),b.on("disconnect",()=>{i(de("Server Has Been Disconnected","warning",0,!0))}),b.on("reconnect",()=>{i(de("Server Has Been Reconnected","success",2e3,!0))}),()=>{b.disconnect()}},[]),s.useEffect(()=>{localStorage.setItem("isDebug",String(n))},[n]);const d=s.useCallback(b=>{b!=null&&(console.log("Saving config:",b),a==null||a.emit("titan-config-set",b))},[a]),h=s.useCallback(b=>{l(H=>{const Q=b(H);return d(Q),Q})},[l,d]),[c,x]=s.useState([]),[D,I]=s.useState({}),F=s.useRef(null),[B,v]=s.useState([]),[S,m]=s.useState(!1),[f,w]=s.useState(!1),[k,C]=s.useState([]),M=s.useRef(null),z=s.useRef(null),[O,U]=s.useState(!1),[q,$]=s.useState(null),W=s.useMemo(()=>c.filter(b=>b["Branch Folder"]&&b["Branch Version"]&&b["SVN Branch"]&&b["Branch Folder"]!==""&&b["Branch Version"]!==""&&b["SVN Branch"]!=="").map(b=>({value:b.id,label:ye(b["Branch Folder"],b["Branch Version"],b["SVN Branch"])})),[c]),[V,y]=s.useState(null),[P,X]=s.useState(""),[J,be]=s.useState([]),[g,j]=s.useState([]),[E,G]=s.useState(null),[ie,ss]=s.useState({}),[Be,ke]=Ne.useState([]);return s.useEffect(()=>{C([]),U(!1)},[c]),s.useEffect(()=>{if(!f||!O)return;const b=setTimeout(()=>{var H;(H=document.getElementById("sectionCommit"))==null||H.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(b)},[f,O]),s.useEffect(()=>{if(B.length<1||O){B.length<1&&w(!1);return}C([]),G(null),ae(B).forEach(b=>{console.debug("Emitting svn-status-single for branch:",b),a==null||a.emit("svn-status-single",{selectedBranch:b})})},[a,B,O]),s.useEffect(()=>{const b=()=>{U(!1)};return a==null||a.on("branch-refresh-unseen",b),()=>a==null?void 0:a.off("branch-refresh-unseen",b)},[a]),s.useEffect(()=>{const b=H=>{n&&console.debug("Received branch status data:",H),C(Q=>[...Q,H])};return a==null||a.on("branch-status-single",b),()=>a==null?void 0:a.off("branch-status-single",b)},[a]),s.useEffect(()=>{ke([])},[B]),s.useEffect(()=>{Be.length===0&&a&&v(b=>(b.length>0&&a.emit("svn-log-selected",{selectedBranches:B}),b))},[Be,a]),s.useEffect(()=>{const b=H=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),ke(Q=>Q.some(ts=>ts.id===H.id)?Q:[...Q,H])};return a==null||a.on("svn-log-result",b),()=>a==null?void 0:a.off("svn-log-result",b)},[a]),e.jsx(Xe.Provider,{value:{socket:a,toast:i,config:o,updateConfig:h,isDebug:n,setIsDebug:u,configurableRowData:c,setConfigurableRowData:x,branchInfos:D,setBranchInfos:I,branchTableGridRef:F,selectedBranches:B,setSelectedBranches:v,showSelectedBranchesLog:S,setShowSelectedBranchesLog:m,isCommitMode:f,setIsCommitMode:w,selectedBranchStatuses:k,setSelectedBranchStatuses:C,localChangesGridRef:M,untrackedChangesGridRef:z,showCommitView:O,setShowCommitView:U,sourceBranch:q,setSourceBranch:$,branchOptions:W,issueNumber:V,setIssueNumber:y,commitMessage:P,setCommitMessage:X,selectedLocalChanges:J,setSelectedLocalChanges:be,selectedUntrackedChanges:g,setSelectedUntrackedChanges:j,socketPayload:E,setSocketPayload:G,postCommitData:ie,setPostCommitData:ss,logData:Be,setLogData:ke},children:t})};function re(){const{socket:t}=L(),o=s.useCallback(()=>{t==null||t.emit("titan-config-open",{})},[t]),l=s.useCallback((d,h,c,x)=>{t==null||t.emit("svn-update-single",{id:d,branch:h,version:c,folder:x})},[t]),a=s.useCallback((d,h,c,x)=>{t==null||t.emit("svn-info-single",{id:d,branch:h,version:c,folder:x})},[t]),r=s.useCallback(d=>{t==null||t.emit("svn-commit",d)},[t]),i=s.useCallback(d=>{t==null||t.emit("svn-files-revert",{filesToProcess:d})},[t]),n=s.useCallback(d=>{t==null||t.emit("svn-files-add-remove",{filesToProcess:d})},[t]),u=s.useCallback((d,h,c,x=null)=>{t==null||t.emit("trello-search-names-card",{key:d,token:h,query:c,limit:x})},[t]);return{emitOpenConfig:o,emitUpdateSingle:l,emitInfoSingle:a,emitCommitPayload:r,emitFilesRevert:i,emitFilesAddRemove:n,emitTrelloCardNamesSearch:u}}function ee(){const{toast:t}=L(),o=s.useCallback((l="",a="info",r=3e3,i=null)=>{const n=de(l,a,r);if(t)return t(n);if(i)return i(n)},[t]);return{toast:t,RaiseClientNotificaiton:o}}function tt(){const{config:t,isDebug:o,setIsDebug:l}=L(),{emitOpenConfig:a}=re(),{RaiseClientNotificaiton:r}=ee(),i=s.useCallback(()=>{window.electron.checkForUpdates().then(u=>{console.debug("Check for updates result: ",u)}),window.electron.on("update-not-available",()=>{r("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[r]),n=s.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(u=>{r(`Application Version: v${u}`,"info",2e3)})},[r]);return e.jsxs(Me,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Ae,{alignItems:"center",children:[e.jsx(Oe,{onClick:n,children:e.jsx(as,{src:Xs,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(Z,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(Z,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Ae,{alignItems:"center",columnGap:2,children:[e.jsx(R,{label:`Current Debug Mode: ${o?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(_,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:o?e.jsx(Y,{as:rs}):e.jsx(Y,{as:os}),onClick:()=>l(u=>!u)})}),e.jsx(R,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(_,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(Y,{as:is}),onClick:()=>a()})}),e.jsx(R,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(_,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(Y,{as:cs}),onClick:i,isDisabled:!window.electron})})]})]})}function nt({isAlertOpen:t,onCloseAlert:o,cancelRef:l,removeSelectedRows:a}){return e.jsx(Ue,{isOpen:t,leastDestructiveRef:l,onClose:o,children:e.jsx(me,{children:e.jsxs(He,{children:[e.jsx(ge,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(xe,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(we,{children:[e.jsx(N,{ref:l,onClick:o,children:"Cancel"}),e.jsx(N,{colorScheme:"red",onClick:a,ml:3,children:"Delete"})]})]})})})}function Pe(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}function lt(){const[t,o]=s.useState(Pe());return s.useEffect(()=>{function l(){o(Pe())}return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}function at({rowData:t,onRowValueChanged:o}){const{config:l,branchTableGridRef:a,updateConfig:r,isDebug:i,selectedBranches:n,setSelectedBranches:u,setSelectedBranchStatuses:d,setShowCommitView:h}=L(),c=lt(),[x,D]=s.useState(c.height>768),I=s.useCallback(f=>{const w={...f,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};r(k=>({...k,branches:ae([...k.branches,w])}))},[r]),F=s.useCallback(f=>{var k,C,M,z;const w=(C=(k=a==null?void 0:a.current)==null?void 0:k.api)==null?void 0:C.getSelectedNodes().map(O=>O.data);if(i&&console.log("SectionBranches.jsx: onSelectionChanged - event",f),i&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",n),(f==null?void 0:f.source)=="rowDataChanged"){const O=n.map(U=>U.id);(z=(M=a==null?void 0:a.current)==null?void 0:M.api)==null||z.forEachNode(U=>{O.includes(U.data.id)&&U.setSelected(!0)});return}else["api"].includes(f==null?void 0:f.source)||(u(w),d([]),h(!1))},[i,a,n,u,h]),B=s.useCallback(f=>{const w=[];f.api.forEachNode(k=>w.push(k.data)),i&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",w),r(k=>({...k,branches:ae(w)}))},[r,i]),v=s.useCallback(f=>{const w=l==null?void 0:l.branchFolderColours[f.data["Branch Folder"]];return{backgroundColor:w?`${w}20`:"transparent"}},[l==null?void 0:l.branchFolderColours]),S=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),m=s.useMemo(()=>{const f=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:w=>e.jsx(R,{label:"Copy Row",hasArrow:!0,children:e.jsx(_,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>I(w.data),icon:e.jsx(Re,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:w=>w.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return x?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:ds,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...f]:f},[l,x,I]);return s.useEffect(()=>{D(c.height>768)},[c]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:x?"auto":"428px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:S,columnDefs:m,stopEditingWhenCellsLoseFocus:!0,getRowStyle:v,onRowDragEnd:B,domLayout:x?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:F,onRowValueChanged:o,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:f=>f.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!x,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function ot(){const{updateConfig:t,isDebug:o,socket:l,configurableRowData:a,setConfigurableRowData:r,branchInfos:i,config:n,setBranchInfos:u,setSelectedBranches:d,setSelectedBranchStatuses:h,showCommitView:c,setShowCommitView:x}=L(),[D,I]=s.useState([]),F=s.useCallback(B=>{o&&console.log("AG Grid: onRowValueChanged - event",B),o&&console.log("AG Grid: onRowValueChanged - rowDataBranches",D),t(v=>({...v,branches:ae(D)}))},[D,t,o]);return s.useEffect(()=>{const B=fe.debounce(()=>{const v=a.map(S=>({...S,"Branch Info":i[S.id]||"Hasn't been refreshed"}));I(S=>fe.isEqual(v,S)?S:v)},300);return B(),()=>B.cancel()},[a,i]),s.useEffect(()=>{r(B=>n&&n.branches&&!fe.isEqual(n.branches,B)?n.branches:B)},[n]),s.useEffect(()=>{const B=v=>{u(S=>{const m={...S,[v.id]:v.info};return console.debug("branch-info-single data received:",v),console.debug("branch-info-single newBranchInfos",m),d(f=>(f.find(k=>k.id===v.id)&&c&&(h([]),x(!1)),f)),m})};return l==null||l.on("branch-info-single",B),()=>l==null?void 0:l.off("branch-info-single")},[l,c]),{rowDataBranches:D,setRowDataBranches:I,onRowValueChanged:F}}function rt(){const{socket:t,updateConfig:o,isDebug:l,setShowSelectedBranchesLog:a,configurableRowData:r,branchTableGridRef:i,selectedBranches:n,setSelectedBranches:u,isCommitMode:d,setIsCommitMode:h,setSelectedBranchStatuses:c,setShowCommitView:x}=L(),{emitUpdateSingle:D,emitInfoSingle:I}=re(),{RaiseClientNotificaiton:F}=ee(),[B,v]=s.useState(!1),S=s.useRef(),m=()=>v(!1),{rowDataBranches:f,setRowDataBranches:w,onRowValueChanged:k}=ot(),[C,M]=s.useState(0),[z,O]=s.useState([]),U=s.useCallback(()=>{var g,j;l&&console.log("SectionBranches.jsx: clearSelection: START"),(j=(g=i==null?void 0:i.current)==null?void 0:g.api)==null||j.deselectAll(),u([]),h(!1)},[l,i,u]),q=s.useCallback(()=>{var j,E;const g=(E=(j=i==null?void 0:i.current)==null?void 0:j.api)==null?void 0:E.getSelectedNodes().map(G=>G.data);u(g),v(!0)},[i,u]),$=s.useCallback(()=>{const g={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};o(j=>({...j,branches:ae([...j.branches,g])}))},[o]),W=s.useCallback(()=>{n.forEach(g=>{D(g.id,g["SVN Branch"],g["Branch Version"],g["Branch Folder"])})},[n,D]),V=s.useCallback(()=>{z.forEach(g=>{D(g.id,g["SVN Branch"],g["Branch Version"],g["Branch Folder"])})},[z,D]),y=s.useCallback(()=>{const g=n.map(E=>E.id),j=f.filter(E=>!g.includes(E.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",j),o(E=>({...E,branches:ae(j)})),U(),m()},[n,f,o]),P=s.useCallback(()=>{a(!0)},[]),X=s.useCallback(()=>{w(g=>{const j=[...g];return n.forEach(E=>{const G=j.findIndex(ie=>ie.id===E.id);j[G]["Branch Info"]="Refreshing..."}),j}),n.forEach(g=>{I(g.id,g["SVN Branch"],g["Branch Version"],g["Branch Folder"])})},[n,I]),J=s.useCallback(()=>{if(d){F("Unable to refresh branches while in commit mode","warning",0);return}F("Refreshing all branches. Please wait until this is done!","info",3e3);const g=Date.now();r.forEach(j=>{I(j.id,j["SVN Branch"],j["Branch Version"],j["Branch Folder"])}),M(g)},[r,I,F,d]),be=s.useCallback(()=>{h(g=>!g),x(!1)},[h]);return s.useEffect(()=>{const g=f.filter(j=>String(j["Branch Info"]).toLowerCase().includes("behind"));O(g)},[f]),s.useEffect(()=>{const j=Date.now();if(r.length>0){j-C>3e5&&J();const E=setInterval(()=>{J()},3e5);return()=>clearInterval(E)}},[r,C,J]),s.useEffect(()=>{const g=j=>{l&&console.debug("branch-success-single data received:",j),I(j.id,j.branch,j.version,j.folder)};return t==null||t.on("branch-success-single",g),()=>t==null?void 0:t.off("branch-success-single",g)},[l,t,I]),e.jsxs("div",{children:[e.jsxs(Me,{mb:4,justify:"space-between",children:[e.jsxs(T,{columnGap:2,children:[e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(N,{onClick:X,leftIcon:e.jsx(je,{}),colorScheme:"yellow",isDisabled:n.length<1,children:["Refresh ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(N,{onClick:W,leftIcon:e.jsx(Y,{as:hs}),colorScheme:"yellow",isDisabled:n.length<1,children:["Update ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(N,{onClick:be,leftIcon:e.jsx(Y,{as:We}),colorScheme:"yellow",isDisabled:n.length<1,children:d?"Undo Commit":"Commit"})}),e.jsx(R,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(N,{onClick:P,leftIcon:e.jsx(us,{}),colorScheme:"yellow",isDisabled:n.length<1,children:"View Logs"})})]}),e.jsx(T,{columnGap:2,children:e.jsx(R,{label:"No outdated branches to update",isDisabled:z.length>0,hasArrow:!0,children:e.jsx(N,{onClick:V,leftIcon:e.jsx(fs,{}),colorScheme:"yellow",isDisabled:z.length<1,children:"Update Outdated"})})})]}),e.jsx(at,{rowData:f,onRowValueChanged:k}),e.jsxs(T,{columnGap:2,mt:4,children:[e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(N,{onClick:U,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:n.length<1,children:["Deselect ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(R,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(N,{onClick:q,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:n.length<1,children:["Delete ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(N,{onClick:$,leftIcon:e.jsx(ms,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(nt,{isAlertOpen:B,onCloseAlert:m,cancelRef:S,removeSelectedRows:y})]})}function Je(t){const{data:o,onDiffResult:l}=t,a=async()=>{try{const r=await window.electron.openTortoiseSVNDiff({fullPath:o["Full Path"],branchFolder:o["Branch Folder"],branchVersion:o["Branch Version"]});l(r)}catch(r){l({success:!1,error:r.message})}};return e.jsx(_,{"aria-label":"Diff",size:"sm",icon:e.jsx(gs,{}),onClick:a,colorScheme:"yellow"})}function it({isModalOpen:t,closeModal:o}){const{socket:l,setIsCommitMode:a,setSelectedBranchStatuses:r,setShowCommitView:i,socketPayload:n}=L(),{emitUpdateSingle:u,emitCommitPayload:d}=re(),{RaiseClientNotificaiton:h}=ee(),[c,x]=s.useState([]),{onCopy:D,value:I,setValue:F,hasCopied:B}=Le(""),{onCopy:v,value:S,setValue:m,hasCopied:f}=Le(""),w=s.useCallback(y=>{y.success?h("TortoiseSVN diff opened successfully","success",3e3):h(`Error opening TortoiseSVN diff: ${JSON.stringify(y.error,null,4)}`,"error",0)},[h]),k=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:C,setActiveStep:M}=xs({index:1,count:k.length}),z=s.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),O=s.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:Je,cellRendererParams:{onDiffResult:w},width:90}],[]),U=s.useCallback(()=>{M(y=>y-1)},[M]),q=s.useCallback(()=>{},[]),$=s.useCallback(()=>{M(y=>y+1)},[M]),W=s.useCallback((y,P)=>{const X="â€‹".repeat(7),J=P.includes("MarkupSupport")?`\r
${X}`:`\r
`;return y.sort((g,j)=>g["Branch Version"].localeCompare(j["Branch Version"])).map(g=>{const j=[];P.includes("BranchFolder")&&j.push(g["Branch Folder"]),P.includes("BranchVersion")&&j.push(g["Branch Version"]),P.includes("SVNBranch")&&j.push(g.branchPathFolder);let E=j.join(" ").trim();if(P.includes("IssueNumber")){const ie=g["Branch Folder"]===n.sourceBranch["Branch Folder"]?n.issueNumber:"XXXXXX";E+=` Issue [${ie}]`}const G=g.revision?g.revision:g.errorMessage||"Error";return E+=` Revision [${G}]`,E}).join(J)},[n]),V=s.useCallback(y=>{const P=W(c,y);F(P)},[c,W,F]);return s.useEffect(()=>{M(3),x([]),F(""),m("")},[t,x]),s.useEffect(()=>{!t||C!=0||(o(),M(1),x([]),F(""),m(""))},[C,t]),s.useEffect(()=>{!t||C!=2||d(n)},[C,t,d,n]),s.useEffect(()=>{!t||C!=3||(h("The commit process has been completed successfully","success",5e3),V(["BranchFolder","BranchVersion","SVNBranch"]),m(n.commitMessage||""))},[h,C,t,V]),s.useEffect(()=>{!t||C<=3||(D(),h("Updating selected branches! Please wait","info",1500),c.forEach(y=>{u(y.branchId,y["SVN Branch"],y["Branch Version"],y["Branch Folder"])}),a(!1),r([]),i(!1),o(),M(1))},[h,C,t,c,u]),s.useEffect(()=>{const y=P=>{x(X=>[...X,P])};return l==null||l.on("svn-commit-status-live",y),()=>l==null?void 0:l.off("svn-commit-status-live",y)},[l]),s.useEffect(()=>{if(C!=2)return;const y=setTimeout(()=>{c.length>0&&c[0].bulkCommitLength==c.length&&M(3)},3e3);return()=>clearTimeout(y)},[C,c]),s.useEffect(()=>{(B||f)&&h("Copied to Clipboard","success",1500)},[B,f,h]),!t||!n?e.jsx(e.Fragment,{}):e.jsxs(_e,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:C==1,children:[e.jsx(me,{}),e.jsxs($e,{maxH:"85%",maxW:"95%",children:[e.jsx(ge,{children:e.jsx(Z,{as:"h2",size:"lg",children:"Commit Selected Files"})}),C==1?e.jsx(Se,{size:"lg"}):e.jsx(e.Fragment,{}),e.jsxs(xe,{children:[e.jsx(bs,{index:C,mb:6,size:"lg",colorScheme:"yellow",children:k.map((y,P)=>e.jsxs(ps,{children:[e.jsx(Cs,{children:e.jsx(ws,{complete:e.jsx(js,{}),incomplete:e.jsx(Ve,{}),active:e.jsx(Ve,{})})}),e.jsxs(p,{flexShrink:"0",children:[e.jsx(Ss,{children:y.title}),e.jsx(ys,{children:y.description})]}),e.jsx(Bs,{})]},P))}),e.jsxs(p,{children:[C!=1?e.jsx(e.Fragment,{}):e.jsxs(p,{children:[e.jsxs(p,{mb:4,children:[e.jsx(A,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Fe,{spacing:3,children:[e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Source Branch: ",e.jsx(K,{children:ye(n.sourceBranch["Branch Folder"],n.sourceBranch["Branch Version"],n.sourceBranch["SVN Branch"])})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Issue Number: ",e.jsx(K,{children:n.issueNumber})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Commit Message: ",e.jsx(K,{children:n.commitMessage})]}),e.jsxs(se,{children:[e.jsx(te,{as:ne,color:"yellow.500"}),"Example:"," ",e.jsxs(K,{children:["Issue ",n.issueNumber," (",n.sourceBranch["Branch Folder"]," ",n.sourceBranch["Branch Version"],"): ",n.commitMessage]})]})]})]}),e.jsx(p,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(oe,{rowData:n.filesToProcess,defaultColDef:z,columnDefs:O,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),C!=2?e.jsx(e.Fragment,{}):e.jsxs(p,{children:[e.jsxs(A,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(p,{children:e.jsx(Fe,{spacing:3,children:c.map((y,P)=>e.jsxs(se,{children:[e.jsx(te,{as:y.errorMessage?ks:ne,color:y.errorMessage?"red.500":"yellow.500"}),y.branchString,":Â ",e.jsx(K,{children:y.errorMessage||y.revision})]},P))})})]}),C!=3?e.jsx(e.Fragment,{}):e.jsxs(p,{children:[e.jsx(p,{mb:4,children:e.jsxs(A,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(T,{columnGap:10,alignItems:"center",children:[e.jsxs(p,{children:[e.jsx(Z,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(p,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:I})})]}),e.jsx(p,{children:e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(_,{"aria-label":"Copy To Clipboard",onClick:D,icon:e.jsx(Re,{}),colorScheme:"yellow"})})})]}),e.jsxs(p,{my:4,children:[e.jsx(A,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Ds,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:V,children:e.jsxs(Me,{children:[e.jsx(ce,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(ce,{value:"BranchVersion",children:"Branch Version"}),e.jsx(ce,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(ce,{value:"IssueNumber",children:"Issue Number"}),e.jsx(ce,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(T,{columnGap:10,alignItems:"center",children:[e.jsxs(p,{children:[e.jsx(A,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),n.sourceBranch&&n.sourceBranch["Branch Folder"]&&n.sourceBranch["Branch Version"]?e.jsx(K,{children:`Issue ${n.issueNumber} (${n.sourceBranch["Branch Folder"]} ${n.sourceBranch["Branch Version"]}): ${S}`}):e.jsx(K,{children:"Source information is undefined. Please check that you have entered the correct details otherwise contact the developer!"})]}),e.jsx(R,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(_,{"aria-label":"Copy To Clipboard",onClick:v,icon:e.jsx(Re,{}),colorScheme:"yellow"})})]})]})]})]}),e.jsx(we,{children:e.jsxs(T,{flex:1,justifyContent:"space-between",children:[e.jsx(T,{columnGap:2,children:e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:C<2,children:e.jsx(N,{onClick:U,mr:3,isDisabled:C>=2,children:C==1?"Cancel":"Previous"})})}),e.jsxs(T,{columnGap:2,children:[e.jsx(R,{hasArrow:!0,label:"Requires Trello Autofill",isDisabled:C>=3,children:e.jsx(N,{colorScheme:"yellow",leftIcon:e.jsx(Y,{as:vs}),onClick:q,isDisabled:C<3,children:"Update Trello"})}),e.jsx(R,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:C!=2,children:e.jsx(N,{colorScheme:"yellow",onClick:$,isDisabled:C==2,children:C==k.length?"Complete":"Next"})})]})]})})]})]})}function ct({fileUpdates:t}){return e.jsx(p,{children:Object.keys(t).length>0?e.jsxs(p,{children:[e.jsx(A,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(p,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(Rs,{children:[e.jsx(Is,{children:e.jsxs(Ee,{children:[e.jsx(pe,{children:"Branch"}),e.jsx(pe,{children:"Path"}),e.jsx(pe,{children:e.jsx(R,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(pe,{children:e.jsx(R,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(Fs,{children:Object.keys(t).map(o=>e.jsx(Ne.Fragment,{children:t[o].map((l,a)=>e.jsxs(Ee,{children:[e.jsx(Ce,{children:o}),e.jsx(Ce,{children:l.pathDisplay}),e.jsx(Ce,{children:l.wcStatus}),e.jsx(Ce,{children:l.reposStatus})]},a))},o))})]})}),e.jsx(A,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(p,{children:e.jsx(A,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function dt({rowDataLocalChanges:t,setRowDataLocalChanges:o,defaultColDefsCommit:l}){const{localChangesGridRef:a,isDebug:r,selectedBranches:i,showCommitView:n,setSelectedLocalChanges:u,selectedLocalChanges:d}=L(),{emitFilesRevert:h}=re(),{RaiseClientNotificaiton:c}=ee(),[x,D]=s.useState(""),I=s.useCallback(()=>{h(d)},[h,d]),F=s.useCallback(m=>{D(m.target.value)},[D]),B=s.useCallback(()=>{var f,w;const m=(w=(f=a==null?void 0:a.current)==null?void 0:f.api)==null?void 0:w.getSelectedNodes().map(k=>k.data);r&&console.log("CommitRegion.jsx: onFileViewSelectionChanged - selectedBranches",m),u(m)},[a,r]),v=s.useCallback(m=>{m.success?c("TortoiseSVN diff opened successfully","success",3e3):c(`Error opening TortoiseSVN diff: ${JSON.stringify(m.error,null,4)}`,"error",0)},[c]),S=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:Je,cellRendererParams:{onDiffResult:v},width:90}],[]);return s.useEffect(()=>{i.length<1||n||(D(""),o([]),u([]))},[i,n]),e.jsx(p,{children:t.length>0?e.jsxs(p,{children:[e.jsxs(T,{mb:4,alignItems:"center",children:[e.jsx(A,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:F,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:l,columnDefs:S,onSelectionChanged:B,quickFilterText:x,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(T,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:d.length>0,children:e.jsx(N,{onClick:I,colorScheme:"red",isDisabled:d.length<1,children:"Revert Selected"})})})]}):e.jsx(p,{children:e.jsx(A,{children:"Your selected branches do not contain any files to commit."})})})}function ht({rowDataUntrackedChanges:t,setRowDataUntrackedChanges:o,defaultColDefsCommit:l}){const{untrackedChangesGridRef:a,selectedUntrackedChanges:r,setSelectedUntrackedChanges:i,isDebug:n,selectedBranches:u,showCommitView:d}=L(),{emitFilesAddRemove:h,emitFilesRevert:c}=re(),[x,D]=s.useState(""),I=s.useCallback(m=>{D(m.target.value)},[D]),F=s.useCallback(()=>{var f,w;const m=(w=(f=a==null?void 0:a.current)==null?void 0:f.api)==null?void 0:w.getSelectedNodes().map(k=>k.data);n&&console.log("CommitRegion.jsx: onUnseenFilesSelectionChanged - selectedBranches",m),i(m)},[a,n]),B=s.useCallback(()=>{h(r)},[h,r]),v=s.useCallback(()=>{c(r)},[c,r]),S=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return s.useEffect(()=>{u.length<1||d||(D(""),o([]),i([]))},[u,d]),e.jsx(p,{children:t.length>0?e.jsxs(p,{children:[e.jsx(A,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(T,{mb:4,alignItems:"center",children:[e.jsx(A,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:I,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(oe,{ref:a,rowData:t,defaultColDef:l,columnDefs:S,onSelectionChanged:F,quickFilterText:x,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(T,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(N,{onClick:B,colorScheme:"green",isDisabled:r.length<1,children:["Add/Remove ",r.length," File",r.length>1?"s":""]})}),e.jsx(R,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(N,{onClick:v,colorScheme:"red",isDisabled:r.length<1,children:["Revert ",r.length," File",r.length>1?"s":""]})})]})]}):e.jsx(p,{children:e.jsx(A,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function ut(){const{issueNumber:t,setIssueNumber:o}=L(),l=a=>{const r=String(a.target.value);/^\d*$/.test(r)&&o(r.trim())};return e.jsx(le,{value:t,onChange:l,placeholder:"Enter number"})}function ft({openMessageAutoFillModal:t}){const{sourceBranch:o,setSourceBranch:l,branchOptions:a,setIssueNumber:r,commitMessage:i,setCommitMessage:n,isCommitMode:u}=L(),d=s.useCallback(c=>{l(c)},[l]),h=s.useCallback(c=>{n(String(c.target.value).replace(/["`]/g,"'"))},[n]);return s.useEffect(()=>{u&&(l(null),r(""),n(""))},[u]),e.jsxs(p,{children:[e.jsxs(T,{columnGap:2,mb:2,children:[e.jsx(p,{width:"50%",children:e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Source Branch"}),e.jsx(Ts,{value:o,onChange:d,options:a,placeholder:"Select branch you would like to commit from",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsxs(T,{width:"50%",alignItems:"flex-end",columnGap:2,children:[e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Issue Number"}),e.jsx(ut,{})]}),e.jsx(R,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(_,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>t(),icon:e.jsx(qe,{})})})]})]}),e.jsx(T,{children:e.jsxs(De,{width:"100%",isRequired:!0,children:[e.jsx(ve,{children:"Commit Message"}),e.jsx(Ns,{placeholder:"Enter Commit Message",resize:"vertical",onInput:h,value:i})]})})]})}function mt({openCommitModal:t}){const{setShowCommitView:o,selectedLocalChanges:l,sourceBranch:a,issueNumber:r,commitMessage:i,setSocketPayload:n,selectedBranches:u}=L(),{RaiseClientNotificaiton:d}=ee(),h=s.useCallback(()=>{o(!1)},[o]),c=s.useCallback(()=>{if(!a||a.value===""){d("Please select the source branch to proceed!","error");return}if(!r||!i||r===""||i===""){d("Please provide the issue number and the commit message to proceed!","error");return}n({sourceBranch:u.find(x=>x.id==a.value),issueNumber:r,commitMessage:i,filesToProcess:l}),t()},[a,r,i,d,l,u]);return e.jsx(p,{children:e.jsxs(T,{columnGap:2,justifyContent:"center",children:[e.jsx(N,{onClick:h,leftIcon:e.jsx(je,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(R,{label:"Select at least 1 file",hasArrow:!0,isDisabled:l.length>0,children:e.jsxs(N,{onClick:c,leftIcon:e.jsx(Y,{as:We}),colorScheme:"yellow",isDisabled:l.length<1,children:["Commit ",l.length>0?`${l.length} File`:"",l.length>1?"s":""]})})]})})}function gt(){const{selectedBranches:t,logData:o,setLogData:l}=L(),[a,r]=s.useState([]),[i,n]=s.useState(""),u=s.useCallback(c=>{n(c.target.value)},[n]),d=s.useCallback(()=>{l([])},[l]),h=o.length===t.length;return s.useEffect(()=>{if(o.length===0)return;const c=o.map(x=>x.logs).flat();r(x=>fe.isEqual(x,c)?x:c)},[o]),{rowDataLogs:a,quickFilterLogsText:i,setQuickFilterLogsText:n,onQuickFilterLogsInputChanged:u,refreshLogs:d,areLogsFetched:h}}function xt({rowDataLogs:t,quickFilterLogsText:o,setAutoFillSelection:l=null,isAutofill:a=!1}){const r=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=s.useMemo(()=>{const d=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return a?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...d]:d},[a]),n=s.useRef(null),u=s.useCallback(()=>{var d,h;if(l){const c=(h=(d=n==null?void 0:n.current)==null?void 0:d.api)==null?void 0:h.getSelectedNodes().map(x=>x.data);l(c[0]||null)}},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:a?"90%":"85%",width:"100%"},children:e.jsx(oe,{ref:n,rowData:t,defaultColDef:r,columnDefs:i,onSelectionChanged:u,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!a,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function Ke({setAutoFillSelection:t=!1,isAutofill:o=!1}){const{selectedBranches:l,logData:a}=L(),{rowDataLogs:r,quickFilterLogsText:i,onQuickFilterLogsInputChanged:n,refreshLogs:u,areLogsFetched:d}=gt();return d?e.jsxs(p,{h:"100%",children:[e.jsxs(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(A,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:n,width:"100%"})]}),e.jsx(p,{children:e.jsx(R,{label:"Refresh",hasArrow:!0,children:e.jsx(_,{onClick:u,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(xt,{rowDataLogs:r,quickFilterLogsText:i,setAutoFillSelection:t,isAutofill:o})]}):e.jsxs(p,{children:[e.jsxs(p,{mb:4,children:[e.jsx(A,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Fe,{spacing:3,children:l.map(h=>{const c=a.find(x=>x.id===h.id);return e.jsxs(se,{display:"flex",alignItems:"center",children:[e.jsx(te,{w:30,h:30,as:c?ne:Ms,color:"yellow.500"}),ye(h["Branch Folder"],h["Branch Version"],h["SVN Branch"])]},h.branchId)})})]}),e.jsx(T,{justifyContent:"center",children:e.jsx(As,{value:a.length/l.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Ls,{children:[a.length," / ",l.length]})})})]})}function bt(t){const{data:o}=t,l=async()=>{window.open(o.url,"_blank")};return e.jsx(_,{"aria-label":"Diff",size:"sm",icon:e.jsx(Vs,{}),onClick:l,colorScheme:"yellow"})}function pt({rowDataTrello:t,quickFilterTrelloText:o,setAutoFillSelection:l}){const a=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=s.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:bt,width:120}],[]),i=s.useRef(null),n=s.useCallback(()=>{var d,h;const u=(h=(d=i==null?void 0:i.current)==null?void 0:d.api)==null?void 0:h.getSelectedNodes().map(c=>c.data);l(u[0]||null)},[l]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(oe,{ref:i,rowData:t,defaultColDef:a,columnDefs:r,onSelectionChanged:n,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function Ct({setAutoFillSelection:t}){const{config:o,socket:l}=L(),{emitTrelloCardNamesSearch:a}=re(),r=o==null?void 0:o.trelloIntegration,i=(r==null?void 0:r.key)||null,n=(r==null?void 0:r.token)||null,u=i&&n&&i.trim()!==""&&n.trim()!==""&&i.toUpperCase()!=="TRELLO_API_KEY"&&n.toUpperCase!=="TRELLO_TOKEN",[d,h]=s.useState(""),[c,x]=s.useState(""),[D,I]=s.useState([]),F=s.useCallback(fe.debounce(m=>{m.trim()!==""&&a(i,n,m)},250),[i,n,a]),B=s.useCallback(m=>{h(String(m.target.value).trim())},[h]),v=s.useCallback(()=>{d.trim()!==""&&a(i,n,d)},[d,i,n,a]),S=s.useCallback(m=>{x(m.target.value)},[]);return s.useEffect(()=>(F(d),()=>F.cancel()),[d,F]),s.useEffect(()=>{const m=f=>{I(f&&f.length>0?f:[])};return l==null||l.on("trello-result-search-names-card",m),()=>l==null?void 0:l.off("trello-result-search-names-card",m)},[l]),u?e.jsxs(p,{h:"100%",children:[e.jsxs(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(A,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(le,{placeholder:"Type to search...",onInput:B,width:"100%"})]}),e.jsx(p,{children:e.jsx(R,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(_,{onClick:v,icon:e.jsx(je,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(A,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(le,{placeholder:"Type to search...",onInput:S,width:"100%"})]})}),e.jsx(pt,{rowDataTrello:D,quickFilterTrelloText:c,setAutoFillSelection:t})]}):e.jsx(p,{h:"100%",p:4,children:e.jsxs(A,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(Oe,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx(qe,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function wt({isModalOpen:t,closeModal:o}){const{setSourceBranch:l,branchOptions:a,setIssueNumber:r,setCommitMessage:i,setPostCommitData:n}=L(),[u,d]=s.useState(0),[h,c]=s.useState([null,null]),[x,D]=s.useState(!0),I=s.useCallback(S=>{d(S),c(S===0?m=>[m[0],null]:m=>[null,m[1]])},[d]),F=s.useCallback(S=>{c(m=>[S,...m.slice(1)])},[c]),B=s.useCallback(S=>{c(m=>[m[0],S])},[c]),v=s.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",u),console.debug("Selected autofill selection:",JSON.stringify(h,null,4));let S=h[u];if(u===0){const m=S.message,f=S.branchId,w=m.match(/\s*(Issue)*\s*(\d+)\s*/),k=w?w[2]:null,C=m.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");f&&l(a.find(M=>M.value===f)),k&&r(k),C.trim()!==""&&i(C)}else{const m=S.name,f=m.match(/\s*(Issue)*\s*(\d+)\s*/),w=f?f[2]:null,k=m.replace(/\s*(Issue)*\s*(\d+)/,"");w&&r(w),k.trim()!==""&&i(k),n({type:"Trello",data:S})}o()},[u,h,o]);return s.useEffect(()=>{D(!(h.length==2&&(h[0]||h[1])))},[h]),s.useEffect(()=>{c([null,null])},[t]),e.jsxs(_e,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(me,{}),e.jsxs($e,{maxH:"95%",maxW:"95%",children:[e.jsx(ge,{children:e.jsx(Z,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(Se,{size:"lg"}),e.jsx(xe,{children:e.jsx(p,{height:"70vh",children:e.jsxs(Ge,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:S=>I(S),children:[e.jsxs(Qe,{children:[e.jsx(he,{children:"SVN Logs"}),e.jsx(he,{children:"Trello"})]}),e.jsxs(Ye,{h:"90%",children:[e.jsx(ue,{px:0,pb:0,h:"100%",children:e.jsx(Ke,{setAutoFillSelection:F,isAutofill:!0})}),e.jsx(ue,{px:0,pb:0,h:"100%",children:e.jsx(Ct,{setAutoFillSelection:B})})]})]})})}),e.jsxs(we,{children:[e.jsx(N,{mr:3,onClick:()=>o(),children:"Cancel"}),e.jsx(R,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!x,children:e.jsx(N,{colorScheme:"yellow",onClick:v,isDisabled:x,children:"Select"})})]})]})]})}function jt(){const{isDebug:t,setIsCommitMode:o,selectedBranchStatuses:l,showCommitView:a,setShowCommitView:r,selectedBranches:i,configurableRowData:n}=L(),[u,d]=s.useState({}),[h,c]=s.useState([]),[x,D]=s.useState([]),{isOpen:I,onOpen:F,onClose:B}=Te(),{isOpen:v,onOpen:S,onClose:m}=Te(),f=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);s.useEffect(()=>{if(i.length<1||a){i.length<1&&o(!1);return}d({})},[i,a]),s.useEffect(()=>{t&&(console.debug("Branch Status Rows:",l),console.debug("Selected Rows:",i))},[t,l,i]),s.useEffect(()=>{l.length===i.length&&(l.forEach(z=>{let O=z.id,U=z.status.filesToCommit,q=z.status.filesToUpdate;const $=n.find(W=>W.id===O);if(q.length>0){const W=ye($["Branch Folder"],$["Branch Version"],$["SVN Branch"]);d(V=>({...V,[W]:[...V[W]||[],...q]}))}if(U.length>0){const W=U.map(V=>({branchId:O,"Branch Folder":$["Branch Folder"],"Branch Version":$["Branch Version"],"SVN Branch":$["SVN Branch"],"Full Path":V.path,"File Path":`${Js(z.status.branch)}\\${V.pathDisplay}`,"Local Status":V.wcStatus}));c(V=>[...V,...W.filter(y=>!["unversioned","missing"].includes(y["Local Status"]))]),D(V=>[...V,...W.filter(y=>["unversioned","missing"].includes(y["Local Status"]))])}}),r(!0))},[l,i,n]);const w=Object.keys(u).length>0,k=h.length>0,C=x.length>0,M=w||k||C;return e.jsxs(p,{children:[e.jsx(p,{mb:6,children:e.jsx(ft,{openMessageAutoFillModal:S})}),e.jsx(Es,{isLoaded:a&&M,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(Ge,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:w?0:k?1:2,isLazy:!1,children:[e.jsxs(Qe,{children:[e.jsx(he,{isDisabled:!w,children:e.jsx(R,{label:"No files to update!",hasArrow:!0,isDisabled:w,children:"Files to Update"})}),e.jsx(he,{isDisabled:!k,children:e.jsx(R,{label:"No files to commit!",hasArrow:!0,isDisabled:k,children:"Local Changes"})}),e.jsx(he,{isDisabled:!C,children:e.jsx(R,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:C,children:"Untracked Changes"})})]}),e.jsxs(Ye,{children:[e.jsx(ue,{px:0,children:e.jsx(ct,{fileUpdates:u})}),e.jsx(ue,{px:0,children:e.jsx(dt,{rowDataLocalChanges:h,setRowDataLocalChanges:c,defaultColDefsCommit:f})}),e.jsx(ue,{px:0,children:e.jsx(ht,{rowDataUntrackedChanges:x,setRowDataUntrackedChanges:D,defaultColDefsCommit:f})})]})]})}),a&&!M?e.jsx(A,{mt:4,className:"animation-pulse",fontWeight:600,children:"No changes have been spotted! Please use the refresh button ðŸ‘‡ if you have recently made a change"}):e.jsx(e.Fragment,{}),e.jsx(p,{mt:6,children:e.jsx(mt,{openCommitModal:F})}),e.jsx(it,{isModalOpen:I,closeModal:B}),e.jsx(wt,{isModalOpen:v,closeModal:m})]})}function St(){const{showSelectedBranchesLog:t,setShowSelectedBranchesLog:o}=L();return e.jsxs(Ps,{isOpen:t,onClose:()=>o(!1),placement:"left",size:"full",children:[e.jsx(me,{}),e.jsxs(zs,{children:[e.jsx(Se,{size:"lg"}),e.jsx(ge,{children:"Selected Branches: SVN Log"}),e.jsx(xe,{children:e.jsx(p,{height:"100%",children:e.jsx(Ke,{})})})]})]})}function yt(){const{toast:t,RaiseClientNotificaiton:o}=ee(),{isOpen:l,onOpen:a,onClose:r}=Te(),i=s.useRef(),[n,u]=s.useState(!1);s.useEffect(()=>{if(!window.electron){o("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{t.closeAll(),a()}),window.electron.on("update-error",c=>{o(`An error occurred while checking for updates: ${c}`,"error",5e3)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[t,a]);const d=s.useCallback(()=>{r(),o("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[r,o]),h=s.useCallback(()=>{if(n){o("Update is already in progress. Please wait.","info",5e3);return}window.electron?(u(!0),window.electron.downloadUpdate().catch(c=>{u(!1),o(`An error occurred while downloading the update: ${c}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{o("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),r()}),window.electron.on("update-not-available",()=>{o("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),r()})):o("Cannot update Titan in a non-desktop application environment","error",5e3)},[n,o,r]);return e.jsx(Ue,{isOpen:l,leastDestructiveRef:i,onClose:r,motionPreset:"slideInBottom",closeOnOverlayClick:!n,children:e.jsx(me,{children:e.jsxs(He,{children:[e.jsx(ge,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),n?e.jsx(e.Fragment,{}):e.jsx(Se,{}),e.jsx(xe,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(we,{children:[e.jsx(N,{colorScheme:"red",ref:i,onClick:d,children:"Cancel"}),e.jsx(N,{colorScheme:"yellow",onClick:h,ml:3,isDisabled:n,children:"Confirm"})]})]})})})}function Bt(){if(!window.electron)return e.jsx(e.Fragment,{});const t=s.useCallback(()=>{window.electron.minimizeWindow()},[]),o=s.useCallback(()=>{window.electron.maximizeWindow()},[]),l=s.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Os.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(T,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(Z,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(T,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(_,{"aria-label":"Minimize",size:"xs",icon:e.jsx(Us,{}),onClick:t,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(_,{"aria-label":"Maximize",size:"xs",icon:e.jsx(Hs,{}),onClick:o,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(_,{"aria-label":"Close",size:"xs",icon:e.jsx(Ie,{}),onClick:l,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function kt(){const{isCommitMode:t,selectedBranches:o,configurableRowData:l}=L(),{RaiseClientNotificaiton:a}=ee();return s.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{a("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(p,{className:"titanBody",children:[e.jsx(Bt,{}),e.jsxs(p,{p:10,children:[e.jsx(tt,{}),e.jsx(yt,{}),e.jsxs(T,{rowGap:4,flexDirection:"column",children:[e.jsx(p,{children:e.jsx(rt,{})}),e.jsx(Ws,{in:t,animateOpacity:!0,children:e.jsxs(p,{id:"sectionCommit",children:[e.jsxs(Z,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",o.length==l.length?"All":`${o.length}/${l.length}`," Branch",o.length==1?"":"es"]}),e.jsx(jt,{})]})})]}),e.jsx(St,{})]})]})}const{definePartsStyle:Ze,defineMultiStyleConfig:es}=Qs(Ys.keys),Dt=Ze({dialog:{mt:`${Zs+20}px`,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),vt=es({baseStyle:Dt}),Rt=Ze({dialog:{mt:et,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),It=es({baseStyle:Rt}),Ft={initialColorMode:"dark",useSystemColorMode:!1},ze=_s({config:Ft,components:{Modal:vt,Drawer:It}});$s.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsxs(qs,{theme:ze,children:[e.jsx(Gs,{initialColorMode:ze.config.initialColorMode}),e.jsx(st,{children:e.jsx(kt,{})})]})}));
