import{r as s,u as os,l as rs,R as Ne,j as e,W as Le,d as Ve,L as We,I as is,H as K,T as F,e as H,f as X,M as cs,g as ds,h as hs,i as us,A as He,k as be,m as $e,n as pe,o as Ce,p as Se,B as L,D as fs,C as Fe,F as T,q as ye,s as ms,t as _e,v as gs,w as xs,x as Ie,S as bs,V as ps,y as Ee,z as Cs,E as qe,G as Ge,J as ws,K as js,N as Ss,O as ys,P as Bs,Q as Pe,U as C,X as ks,Y as Ds,Z as Be,_ as z,$ as Re,a0 as le,a1 as ae,a2 as oe,a3 as ee,a4 as vs,a5 as Qe,a6 as se,a7 as Fs,a8 as Is,a9 as Rs,aa as ze,ab as we,ac as Ts,ad as je,ae as re,af as De,ag as ve,ah as Ns,ai as Ye,aj as Ls,ak as Ms,al as As,am as Vs,an as Es,ao as Xe,ap as Ke,aq as me,ar as Je,as as ge,at as Ps,au as Te,av as zs,aw as Os,ax as Us,ay as Ws,az as Hs,aA as $s,aB as _s,aC as qs,aD as Gs,aE as Qs,aF as Ys,aG as Xs,aH as Ks}from"./vendor.js";import{_ as xe}from"./lodash.js";import{A as ce}from"./ag-grid-react.js";import"./ag-grid-community.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const Js="/assets/Titan.png";function ie(t=[]){return(Array.isArray(t)?t:[t]).map(a=>(delete a["Branch Info"],a))}function ke(t,o,a){return`${t==""?"Uncategorised":t} ${o==""?"Unversioned":o} ${String(a).split("\\").at(-1)}`}function Zs(t){return String(t).split("\\").at(-1)}const et="http://localhost:4000",st="40px";function fe(t,o="info",a=3e3,n=!1){return{position:"top",variant:"solid",title:n?"Server Notification":"Client Notification",description:t,status:o,duration:a,isClosable:!0}}const Ze=s.createContext({socket:null,toast:null,config:null,updateConfig:t=>{},isDebug:!1,setIsDebug:t=>{},configurableRowData:[],setConfigurableRowData:t=>{},branchInfos:{},setBranchInfos:t=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:t=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:t=>{},isCommitMode:!1,setIsCommitMode:t=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:t=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:t=>{},sourceBranch:null,setSourceBranch:t=>{},branchOptions:[],issueNumber:null,setIssueNumber:t=>{},commitMessage:"",setCommitMessage:t=>{},selectedLocalChanges:[],setSelectedLocalChanges:t=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:t=>{},socketPayload:null,setSocketPayload:t=>{},postCommitData:{},setPostCommitData:t=>{},logData:[],setLogData:t=>{}}),P=()=>s.useContext(Ze),tt=({children:t})=>{const[o,a]=s.useState(null),[n,r]=s.useState(null),i=os(),[l,c]=s.useState(localStorage.getItem("isDebug")==="true");s.useEffect(()=>{const m=rs(et);return r(m),m.on("connect",()=>{m.emit("titan-config-get","fetch"),m.once("titan-config-get",E=>{a(E),i(fe("Configurations Loaded","success",2e3))})}),m.on("notification",E=>{i(fe(E.description,E.status,E.duration,!0))}),m.on("disconnect",()=>{i(fe("Server Has Been Disconnected","warning",0,!0))}),m.on("reconnect",()=>{i(fe("Server Has Been Reconnected","success",2e3,!0))}),()=>{m.disconnect()}},[]),s.useEffect(()=>{localStorage.setItem("isDebug",String(l))},[l]);const f=s.useCallback(m=>{m!=null&&(console.log("Saving config:",m),n==null||n.emit("titan-config-set",m))},[n]),h=s.useCallback(m=>{a(E=>{const G=m(E);return f(G),G})},[a,f]),[u,b]=s.useState([]),[y,I]=s.useState({}),M=s.useRef(null),[p,x]=s.useState([]),[j,w]=s.useState(!1),[g,S]=s.useState(!1),[D,N]=s.useState([]),U=s.useRef(null),A=s.useRef(null),[v,O]=s.useState(!1),[$,k]=s.useState(null),V=s.useMemo(()=>u.filter(m=>m["Branch Folder"]&&m["Branch Version"]&&m["SVN Branch"]&&m["Branch Folder"]!==""&&m["Branch Version"]!==""&&m["SVN Branch"]!=="").map(m=>({value:m.id,label:ke(m["Branch Folder"],m["Branch Version"],m["SVN Branch"])})),[u]),[W,Q]=s.useState(null),[Y,J]=s.useState(""),[Z,he]=s.useState([]),[B,d]=s.useState([]),[R,q]=s.useState(null),[ue,Me]=s.useState({}),[ne,_]=Ne.useState([]);return s.useEffect(()=>{N([]),O(!1)},[u]),s.useEffect(()=>{if(!g||!v)return;const m=setTimeout(()=>{var E;(E=document.getElementById("sectionCommit"))==null||E.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(m)},[g,v]),s.useEffect(()=>{if(p.length<1||v){p.length<1&&S(!1);return}N([]),q(null),ie(p).forEach(m=>{console.debug("Emitting svn-status-single for branch:",m),n==null||n.emit("svn-status-single",{selectedBranch:m})})},[n,p,v]),s.useEffect(()=>{const m=()=>{O(!1)};return n==null||n.on("branch-refresh-unseen",m),()=>n==null?void 0:n.off("branch-refresh-unseen",m)},[n]),s.useEffect(()=>{const m=E=>{l&&console.debug("Received branch status data:",E),N(G=>[...G,E])};return n==null||n.on("branch-status-single",m),()=>n==null?void 0:n.off("branch-status-single",m)},[n]),s.useEffect(()=>{_([])},[p]),s.useEffect(()=>{ne.length===0&&n&&x(m=>(m.length>0&&n.emit("svn-log-selected",{selectedBranches:p}),m))},[ne,n]),s.useEffect(()=>{const m=E=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),_(G=>G.some(as=>as.id===E.id)?G:[...G,E])};return n==null||n.on("svn-log-result",m),()=>n==null?void 0:n.off("svn-log-result",m)},[n]),e.jsx(Ze.Provider,{value:{socket:n,toast:i,config:o,updateConfig:h,isDebug:l,setIsDebug:c,configurableRowData:u,setConfigurableRowData:b,branchInfos:y,setBranchInfos:I,branchTableGridRef:M,selectedBranches:p,setSelectedBranches:x,showSelectedBranchesLog:j,setShowSelectedBranchesLog:w,isCommitMode:g,setIsCommitMode:S,selectedBranchStatuses:D,setSelectedBranchStatuses:N,localChangesGridRef:U,untrackedChangesGridRef:A,showCommitView:v,setShowCommitView:O,sourceBranch:$,setSourceBranch:k,branchOptions:V,issueNumber:W,setIssueNumber:Q,commitMessage:Y,setCommitMessage:J,selectedLocalChanges:Z,setSelectedLocalChanges:he,selectedUntrackedChanges:B,setSelectedUntrackedChanges:d,socketPayload:R,setSocketPayload:q,postCommitData:ue,setPostCommitData:Me,logData:ne,setLogData:_},children:t})};function de(){const{socket:t}=P(),o=s.useCallback(()=>{t==null||t.emit("titan-config-open",{})},[t]),a=s.useCallback((h,u,b,y)=>{t==null||t.emit("svn-update-single",{id:h,branch:u,version:b,folder:y})},[t]),n=s.useCallback((h,u,b,y)=>{t==null||t.emit("svn-info-single",{id:h,branch:u,version:b,folder:y})},[t]),r=s.useCallback(h=>{t==null||t.emit("svn-commit",h)},[t]),i=s.useCallback(h=>{t==null||t.emit("svn-files-revert",{filesToProcess:h})},[t]),l=s.useCallback(h=>{t==null||t.emit("svn-files-add-remove",{filesToProcess:h})},[t]),c=s.useCallback((h,u,b,y=null)=>{t==null||t.emit("trello-search-names-card",{key:h,token:u,query:b,limit:y})},[t]),f=s.useCallback((h,u,b,y)=>{t==null||t.emit("trello-update-card",{key:h,token:u,trelloData:b,commitResponses:y})},[t]);return{emitOpenConfig:o,emitUpdateSingle:a,emitInfoSingle:n,emitCommitPayload:r,emitFilesRevert:i,emitFilesAddRemove:l,emitTrelloCardNamesSearch:c,emitTrelloCardUpdate:f}}function te(){const{toast:t}=P(),o=s.useCallback((a="",n="info",r=3e3,i=null)=>{const l=fe(a,n,r);if(t)return t(l);if(i)return i(l)},[t]);return{toast:t,RaiseClientNotificaiton:o}}function nt(){const{config:t,isDebug:o,setIsDebug:a}=P(),{emitOpenConfig:n}=de(),{RaiseClientNotificaiton:r}=te(),i=s.useCallback(()=>{window.electron.checkForUpdates().then(c=>{console.debug("Check for updates result: ",c)}),window.electron.on("update-not-available",()=>{r("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[r]),l=s.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(c=>{r(`Application Version: v${c}`,"info",2e3)})},[r]);return e.jsxs(Le,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Ve,{alignItems:"center",children:[e.jsx(We,{onClick:l,children:e.jsx(is,{src:Js,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(K,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(K,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Ve,{alignItems:"center",columnGap:2,children:[e.jsx(F,{label:`Current Debug Mode: ${o?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(H,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:o?e.jsx(X,{as:ds}):e.jsx(X,{as:cs}),onClick:()=>a(c=>!c)})}),e.jsx(F,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(H,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(X,{as:hs}),onClick:()=>n()})}),e.jsx(F,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(H,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(X,{as:us}),onClick:i,isDisabled:!window.electron})})]})]})}function lt({isAlertOpen:t,onCloseAlert:o,cancelRef:a,removeSelectedRows:n}){return e.jsx(He,{isOpen:t,leastDestructiveRef:a,onClose:o,children:e.jsx(be,{children:e.jsxs($e,{children:[e.jsx(pe,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(Ce,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(Se,{children:[e.jsx(L,{ref:a,onClick:o,children:"Cancel"}),e.jsx(L,{colorScheme:"red",onClick:n,ml:3,children:"Delete"})]})]})})})}function Oe(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}function at(){const[t,o]=s.useState(Oe());return s.useEffect(()=>{function a(){o(Oe())}return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),t}function ot({rowData:t,onRowValueChanged:o}){const{config:a,branchTableGridRef:n,updateConfig:r,isDebug:i,selectedBranches:l,setSelectedBranches:c,setSelectedBranchStatuses:f,setShowCommitView:h}=P(),u=at(),[b,y]=s.useState(u.height>768),I=s.useCallback(g=>{const S={...g,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};r(D=>({...D,branches:ie([...D.branches,S])}))},[r]),M=s.useCallback(g=>{var D,N,U,A;const S=(N=(D=n==null?void 0:n.current)==null?void 0:D.api)==null?void 0:N.getSelectedNodes().map(v=>v.data);if(i&&console.log("SectionBranches.jsx: onSelectionChanged - event",g),i&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",l),(g==null?void 0:g.source)=="rowDataChanged"){const v=l.map(O=>O.id);(A=(U=n==null?void 0:n.current)==null?void 0:U.api)==null||A.forEachNode(O=>{v.includes(O.data.id)&&O.setSelected(!0)});return}else["api"].includes(g==null?void 0:g.source)||(c(S),f([]),h(!1))},[i,n,l,c,h]),p=s.useCallback(g=>{const S=[];g.api.forEachNode(D=>S.push(D.data)),i&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",S),r(D=>({...D,branches:ie(S)}))},[r,i]),x=s.useCallback(g=>{const S=a==null?void 0:a.branchFolderColours[g.data["Branch Folder"]];return{backgroundColor:S?`${S}20`:"transparent"}},[a==null?void 0:a.branchFolderColours]),j=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),w=s.useMemo(()=>{const g=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:S=>e.jsx(F,{label:"Copy Row",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>I(S.data),icon:e.jsx(Fe,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:S=>S.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return b?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:fs,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...g]:g},[a,b,I]);return s.useEffect(()=>{y(u.height>768)},[u]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:b?"auto":"428px",width:"100%"},children:e.jsx(ce,{ref:n,rowData:t,defaultColDef:j,columnDefs:w,stopEditingWhenCellsLoseFocus:!0,getRowStyle:x,onRowDragEnd:p,domLayout:b?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:M,onRowValueChanged:o,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:g=>g.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!b,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function rt(){const{updateConfig:t,isDebug:o,socket:a,configurableRowData:n,setConfigurableRowData:r,branchInfos:i,config:l,setBranchInfos:c,setSelectedBranches:f,setSelectedBranchStatuses:h,showCommitView:u,setShowCommitView:b}=P(),[y,I]=s.useState([]),M=s.useCallback(p=>{o&&console.log("AG Grid: onRowValueChanged - event",p),o&&console.log("AG Grid: onRowValueChanged - rowDataBranches",y),t(x=>({...x,branches:ie(y)}))},[y,t,o]);return s.useEffect(()=>{const p=xe.debounce(()=>{const x=n.map(j=>({...j,"Branch Info":i[j.id]||"Hasn't been refreshed"}));I(j=>xe.isEqual(x,j)?j:x)},300);return p(),()=>p.cancel()},[n,i]),s.useEffect(()=>{r(p=>l&&l.branches&&!xe.isEqual(l.branches,p)?l.branches:p)},[l]),s.useEffect(()=>{const p=x=>{c(j=>{const w={...j,[x.id]:x.info};return console.debug("branch-info-single data received:",x),console.debug("branch-info-single newBranchInfos",w),f(g=>(g.find(D=>D.id===x.id)&&u&&(h([]),b(!1)),g)),w})};return a==null||a.on("branch-info-single",p),()=>a==null?void 0:a.off("branch-info-single")},[a,u]),{rowDataBranches:y,setRowDataBranches:I,onRowValueChanged:M}}function it(){const{socket:t,updateConfig:o,isDebug:a,setShowSelectedBranchesLog:n,configurableRowData:r,branchTableGridRef:i,selectedBranches:l,setSelectedBranches:c,isCommitMode:f,setIsCommitMode:h,setSelectedBranchStatuses:u,setShowCommitView:b}=P(),{emitUpdateSingle:y,emitInfoSingle:I}=de(),{RaiseClientNotificaiton:M}=te(),[p,x]=s.useState(!1),j=s.useRef(),w=()=>x(!1),{rowDataBranches:g,setRowDataBranches:S,onRowValueChanged:D}=rt(),[N,U]=s.useState(0),[A,v]=s.useState([]),O=s.useCallback(()=>{var B,d;a&&console.log("SectionBranches.jsx: clearSelection: START"),(d=(B=i==null?void 0:i.current)==null?void 0:B.api)==null||d.deselectAll(),c([]),h(!1)},[a,i,c]),$=s.useCallback(()=>{var d,R;const B=(R=(d=i==null?void 0:i.current)==null?void 0:d.api)==null?void 0:R.getSelectedNodes().map(q=>q.data);c(B),x(!0)},[i,c]),k=s.useCallback(()=>{const B={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};o(d=>({...d,branches:ie([...d.branches,B])}))},[o]),V=s.useCallback(()=>{l.forEach(B=>{y(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[l,y]),W=s.useCallback(()=>{A.forEach(B=>{y(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[A,y]),Q=s.useCallback(()=>{const B=l.map(R=>R.id),d=g.filter(R=>!B.includes(R.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",d),o(R=>({...R,branches:ie(d)})),O(),w()},[l,g,o]),Y=s.useCallback(()=>{n(!0)},[]),J=s.useCallback(()=>{S(B=>{const d=[...B];return l.forEach(R=>{const q=d.findIndex(ue=>ue.id===R.id);d[q]["Branch Info"]="Refreshing..."}),d}),l.forEach(B=>{I(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[l,I]),Z=s.useCallback(()=>{if(f){M("Unable to refresh branches while in commit mode","warning",0);return}M("Refreshing all branches. Please wait until this is done!","info",3e3);const B=Date.now();r.forEach(d=>{I(d.id,d["SVN Branch"],d["Branch Version"],d["Branch Folder"])}),U(B)},[r,I,M,f]),he=s.useCallback(()=>{h(B=>!B),b(!1)},[h]);return s.useEffect(()=>{const B=g.filter(d=>String(d["Branch Info"]).toLowerCase().includes("behind"));v(B)},[g]),s.useEffect(()=>{const d=Date.now();if(r.length>0){d-N>3e5&&Z();const R=setInterval(()=>{Z()},3e5);return()=>clearInterval(R)}},[r,N,Z]),s.useEffect(()=>{const B=d=>{a&&console.debug("branch-success-single data received:",d),I(d.id,d.branch,d.version,d.folder)};return t==null||t.on("branch-success-single",B),()=>t==null?void 0:t.off("branch-success-single",B)},[a,t,I]),e.jsxs("div",{children:[e.jsxs(Le,{mb:4,justify:"space-between",children:[e.jsxs(T,{columnGap:2,children:[e.jsx(F,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(L,{onClick:J,leftIcon:e.jsx(ye,{}),colorScheme:"yellow",isDisabled:l.length<1,children:["Refresh ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(F,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(L,{onClick:V,leftIcon:e.jsx(X,{as:ms}),colorScheme:"yellow",isDisabled:l.length<1,children:["Update ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(F,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsx(L,{onClick:he,leftIcon:e.jsx(X,{as:_e}),colorScheme:"yellow",isDisabled:l.length<1,children:f?"Undo Commit":"Commit"})}),e.jsx(F,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsx(L,{onClick:Y,leftIcon:e.jsx(gs,{}),colorScheme:"yellow",isDisabled:l.length<1,children:"View Logs"})})]}),e.jsx(T,{columnGap:2,children:e.jsx(F,{label:"No outdated branches to update",isDisabled:A.length>0,hasArrow:!0,children:e.jsx(L,{onClick:W,leftIcon:e.jsx(xs,{}),colorScheme:"yellow",isDisabled:A.length<1,children:"Update Outdated"})})})]}),e.jsx(ot,{rowData:g,onRowValueChanged:D}),e.jsxs(T,{columnGap:2,mt:4,children:[e.jsx(F,{label:"Please select at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(L,{onClick:O,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:l.length<1,children:["Deselect ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(F,{label:"Please select at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(L,{onClick:$,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:l.length<1,children:["Delete ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(L,{onClick:k,leftIcon:e.jsx(bs,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(lt,{isAlertOpen:p,onCloseAlert:w,cancelRef:j,removeSelectedRows:Q})]})}function es(t){const{data:o,onDiffResult:a}=t,n=async()=>{try{const r=await window.electron.openTortoiseSVNDiff({fullPath:o["Full Path"],branchFolder:o["Branch Folder"],branchVersion:o["Branch Version"]});a(r)}catch(r){a({success:!1,error:r.message})}};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(ps,{}),onClick:n,colorScheme:"yellow"})}function ss(){const{config:t}=P(),{emitTrelloCardNamesSearch:o,emitTrelloCardUpdate:a}=de(),n=t==null?void 0:t.trelloIntegration,r=(n==null?void 0:n.key)||null,i=(n==null?void 0:n.token)||null,l=r&&i&&r.trim()!==""&&i.trim()!==""&&r.toUpperCase()!=="TRELLO_API_KEY"&&i.toUpperCase!=="TRELLO_TOKEN";return{key:r,token:i,isTrelloIntegrationEnabled:l,emitTrelloCardNamesSearch:o,emitTrelloCardUpdate:a}}function ct({isModalOpen:t,closeModal:o}){const{socket:a,setIsCommitMode:n,setSelectedBranchStatuses:r,setShowCommitView:i,socketPayload:l,postCommitData:c,setPostCommitData:f}=P(),{emitUpdateSingle:h,emitCommitPayload:u}=de(),{key:b,token:y,isTrelloIntegrationEnabled:I,emitTrelloCardUpdate:M}=ss(),{RaiseClientNotificaiton:p}=te(),[x,j]=s.useState([]),{onCopy:w,value:g,setValue:S,hasCopied:D}=Ee(""),{onCopy:N,value:U,setValue:A,hasCopied:v}=Ee(""),O=s.useCallback(d=>{d.success?p("TortoiseSVN diff opened successfully","success",3e3):p(`Error opening TortoiseSVN diff: ${JSON.stringify(d.error,null,4)}`,"error",0)},[p]),$=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:k,setActiveStep:V}=Cs({index:1,count:$.length}),W=s.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),Q=s.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:es,cellRendererParams:{onDiffResult:O},width:90}],[]),Y=s.useCallback((d,R=!0)=>{const q="â€‹".repeat(7),ue=d.includes("MarkupSupport")?`\r
${q}`:`\r
`,ne=x.sort((_,m)=>_["Branch Version"].localeCompare(m["Branch Version"])).map(_=>{const m=[];d.includes("BranchFolder")&&m.push(_["Branch Folder"]),d.includes("BranchVersion")&&m.push(_["Branch Version"]),d.includes("SVNBranch")&&m.push(_.branchPathFolder);let E=m.join(" ").trim();if(d.includes("IssueNumber")){const Ae=_["Branch Folder"]===l.sourceBranch["Branch Folder"]?l.issueNumber:"XXXXXX";E+=` Issue [${Ae}]`}const G=_.revision?_.revision:_.errorMessage||"Error";return E+=` Revision [${G}]`,E});return R?ne.join(ue):ne},[x,l]),J=s.useCallback(d=>{const R=Y(d);S(R)},[Y,S]),Z=s.useCallback(()=>{V(d=>d-1)},[V]),he=s.useCallback(()=>{if(c.type!=="trello"){p("Trello Autofill is not enabled for this commit","error");return}const d=c.data,R=Y(["BranchFolder","BranchVersion","IssueNumber"],!1);M(b,y,d,R),p("Updating Trello card with commit information","info"),f(null)},[c,p,Y]),B=s.useCallback(()=>{V(d=>d+1)},[V]);return s.useEffect(()=>{V(1),j([]),S(""),A("")},[t,j]),s.useEffect(()=>{!t||k!=0||(o(),V(1),j([]),S(""),A(""))},[k,t]),s.useEffect(()=>{!t||k!=2||u(l)},[k,t,u,l]),s.useEffect(()=>{!t||k!=3||(p("The commit process has been completed successfully","success",5e3),J(["BranchFolder","BranchVersion","SVNBranch"]),A(l.commitMessage||""))},[p,k,t,J]),s.useEffect(()=>{!t||k<=3||(w(),p("Updating selected branches! Please wait","info",1500),x.forEach(d=>{h(d.branchId,d["SVN Branch"],d["Branch Version"],d["Branch Folder"])}),n(!1),r([]),i(!1),o(),V(1))},[p,k,t,x,h]),s.useEffect(()=>{const d=R=>{j(q=>[...q,R])};return a==null||a.on("svn-commit-status-live",d),()=>a==null?void 0:a.off("svn-commit-status-live",d)},[a]),s.useEffect(()=>{if(k!=2)return;const d=setTimeout(()=>{x.length>0&&x[0].bulkCommitLength==x.length&&V(3)},3e3);return()=>clearTimeout(d)},[k,x]),s.useEffect(()=>{(D||v)&&p("Copied to Clipboard","success",1500)},[D,v,p]),!t||!l?e.jsx(e.Fragment,{}):e.jsxs(qe,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:k==1,children:[e.jsx(be,{}),e.jsxs(Ge,{maxH:"85%",maxW:"95%",children:[e.jsxs(pe,{display:"flex",justifyContent:"space-between",maxWidth:k==1?"94%":"100%",children:[e.jsx(K,{as:"h2",size:"lg",children:"Commit Selected Files"}),e.jsx(ws,{index:k-1,mb:0,size:"sm",colorScheme:"yellow",children:$.map((d,R)=>e.jsxs(js,{children:[e.jsx(Ss,{children:e.jsx(ys,{complete:e.jsx(Bs,{}),incomplete:e.jsx(Pe,{}),active:e.jsx(Pe,{})})}),e.jsx(C,{flexShrink:"0",children:e.jsx(ks,{children:d.title})}),e.jsx(Ds,{})]},R))})]}),k==1?e.jsx(Be,{size:"lg",py:6}):e.jsx(e.Fragment,{}),e.jsx(Ce,{children:e.jsxs(C,{children:[k!=1?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(z,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Re,{spacing:3,children:[e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Source Branch: ",e.jsx(ee,{children:ke(l.sourceBranch["Branch Folder"],l.sourceBranch["Branch Version"],l.sourceBranch["SVN Branch"])})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Issue Number: ",e.jsx(ee,{children:l.issueNumber})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Commit Message: ",e.jsx(ee,{children:l.commitMessage})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Example:"," ",e.jsxs(ee,{children:["Issue ",l.issueNumber," (",l.sourceBranch["Branch Folder"]," ",l.sourceBranch["Branch Version"],"): ",l.commitMessage]})]})]})]}),e.jsx(C,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(ce,{rowData:l.filesToProcess,defaultColDef:W,columnDefs:Q,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),k!=2?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(z,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(C,{children:e.jsx(Re,{spacing:3,children:x.map((d,R)=>e.jsxs(le,{children:[e.jsx(ae,{as:d.errorMessage?vs:oe,color:d.errorMessage?"red.500":"yellow.500"}),d.branchString,":Â ",e.jsx(ee,{children:d.errorMessage||d.revision})]},R))})})]}),k!=3?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsx(C,{mb:4,children:e.jsxs(z,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(T,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(K,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(C,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:g})})]}),e.jsx(C,{children:e.jsx(F,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:w,icon:e.jsx(Fe,{}),colorScheme:"yellow"})})})]}),e.jsxs(C,{my:4,children:[e.jsx(z,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Qe,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:J,children:e.jsxs(Le,{children:[e.jsx(se,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(se,{value:"BranchVersion",children:"Branch Version"}),e.jsx(se,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(se,{value:"IssueNumber",children:"Issue Number"}),e.jsx(se,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(T,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(z,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),l.sourceBranch&&l.sourceBranch["Branch Folder"]&&l.sourceBranch["Branch Version"]?e.jsx(ee,{children:`Issue ${l.issueNumber} (${l.sourceBranch["Branch Folder"]} ${l.sourceBranch["Branch Version"]}): ${U}`}):e.jsx(ee,{children:"Source information is undefined. Please check that you have entered the correct details otherwise contact the developer!"})]}),e.jsx(F,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:N,icon:e.jsx(Fe,{}),colorScheme:"yellow"})})]})]})]})}),e.jsx(Se,{children:e.jsxs(T,{flex:1,justifyContent:"space-between",children:[e.jsx(T,{columnGap:2,children:e.jsx(F,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:k<2,children:e.jsx(L,{onClick:Z,mr:3,isDisabled:k>=2,children:k==1?"Cancel":"Previous"})})}),e.jsxs(T,{columnGap:2,children:[e.jsx(F,{hasArrow:!0,label:"Requires Trello Autofill",isDisabled:(c==null?void 0:c.type)==="trello"&&I,children:e.jsx(L,{colorScheme:"yellow",leftIcon:e.jsx(X,{as:Fs}),onClick:he,isDisabled:k<3||(c==null?void 0:c.type)!="trello"||!I,children:"Update Card"})}),e.jsx(F,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:k!=2,children:e.jsx(L,{colorScheme:"yellow",onClick:B,isDisabled:k==2,children:k==$.length?"Complete":"Next"})})]})]})})]})]})}function dt({fileUpdates:t}){return e.jsx(C,{children:Object.keys(t).length>0?e.jsxs(C,{children:[e.jsx(z,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(C,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(Is,{children:[e.jsx(Rs,{children:e.jsxs(ze,{children:[e.jsx(we,{children:"Branch"}),e.jsx(we,{children:"Path"}),e.jsx(we,{children:e.jsx(F,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(we,{children:e.jsx(F,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(Ts,{children:Object.keys(t).map(o=>e.jsx(Ne.Fragment,{children:t[o].map((a,n)=>e.jsxs(ze,{children:[e.jsx(je,{children:o}),e.jsx(je,{children:a.pathDisplay}),e.jsx(je,{children:a.wcStatus}),e.jsx(je,{children:a.reposStatus})]},n))},o))})]})}),e.jsx(z,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(C,{children:e.jsx(z,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function ht({rowDataLocalChanges:t,setRowDataLocalChanges:o,defaultColDefsCommit:a}){const{localChangesGridRef:n,isDebug:r,selectedBranches:i,showCommitView:l,setSelectedLocalChanges:c,selectedLocalChanges:f}=P(),{emitFilesRevert:h}=de(),{RaiseClientNotificaiton:u}=te(),[b,y]=s.useState(""),I=s.useCallback(()=>{h(f)},[h,f]),M=s.useCallback(w=>{y(w.target.value)},[y]),p=s.useCallback(w=>{var D,N,U,A;if(console.debug("PanelLocalChanges.jsx: onFileViewSelectionChanged - event",w),String(w==null?void 0:w.source).toLowerCase().includes("api"))return;let g=(N=(D=n==null?void 0:n.current)==null?void 0:D.api)==null?void 0:N.getSelectedNodes().map(v=>v.data);r&&console.debug("PanelLocalChanges.jsx: onFileViewSelectionChanged - selectedBranches",g);const S=g.filter(v=>v["Local Status"].toLowerCase()==="added");(A=(U=n==null?void 0:n.current)==null?void 0:U.api)==null||A.forEachNode(v=>{S.some($=>$["File Path"].includes(v.data["File Path"])&&$["File Path"]!==v.data["File Path"])&&v.data["Local Status"].toLowerCase()==="added"&&!v.isSelected()&&(v.setSelected(!0),g.push(v.data),console.debug("PanelLocalChanges.jsx (onFileViewSelectionChanged): Adding ancestor node: ",v))}),c(g)},[n,r,c]),x=s.useCallback(w=>{w.success?u("TortoiseSVN diff opened successfully","success",3e3):u(`Error opening TortoiseSVN diff: ${JSON.stringify(w.error,null,4)}`,"error",0)},[u]),j=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:es,cellRendererParams:{onDiffResult:x},width:90}],[]);return s.useEffect(()=>{i.length<1||l||(y(""),o([]),c([]))},[i,l]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsxs(T,{mb:4,alignItems:"center",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(re,{placeholder:"Type to search...",onInput:M,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(ce,{ref:n,rowData:t,defaultColDef:a,columnDefs:j,onSelectionChanged:p,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(T,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(F,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:f.length>0,children:e.jsx(L,{onClick:I,colorScheme:"red",isDisabled:f.length<1,children:"Revert Selected"})})})]}):e.jsx(C,{children:e.jsx(z,{children:"Your selected branches do not contain any files to commit."})})})}function ut({rowDataUntrackedChanges:t,setRowDataUntrackedChanges:o,defaultColDefsCommit:a}){const{untrackedChangesGridRef:n,selectedUntrackedChanges:r,setSelectedUntrackedChanges:i,isDebug:l,selectedBranches:c,showCommitView:f}=P(),{emitFilesAddRemove:h,emitFilesRevert:u}=de(),[b,y]=s.useState(""),I=s.useCallback(w=>{y(w.target.value)},[y]),M=s.useCallback(()=>{var g,S;const w=(S=(g=n==null?void 0:n.current)==null?void 0:g.api)==null?void 0:S.getSelectedNodes().map(D=>D.data);l&&console.debug("PanelUntrackedChanges.jsx (onUnseenFilesSelectionChanged): selectedBranches",w),i(w)},[n,l]),p=s.useCallback(()=>{h(r)},[h,r]),x=s.useCallback(()=>{u(r)},[u,r]),j=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return s.useEffect(()=>{c.length<1||f||(y(""),o([]),i([]))},[c,f]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsx(z,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(T,{mb:4,alignItems:"center",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(re,{placeholder:"Type to search...",onInput:I,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(ce,{ref:n,rowData:t,defaultColDef:a,columnDefs:j,onSelectionChanged:M,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(T,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(F,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(L,{onClick:p,colorScheme:"green",isDisabled:r.length<1,children:["Add/Remove ",r.length," File",r.length>1?"s":""]})}),e.jsx(F,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(L,{onClick:x,colorScheme:"red",isDisabled:r.length<1,children:["Revert ",r.length," File",r.length>1?"s":""]})})]})]}):e.jsx(C,{children:e.jsx(z,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function ft(){const{issueNumber:t,setIssueNumber:o}=P(),a=n=>{const r=String(n.target.value);/^\d*$/.test(r)&&o(r.trim())};return e.jsx(re,{value:t,onChange:a,placeholder:"Enter number"})}function mt({openMessageAutoFillModal:t}){const{sourceBranch:o,setSourceBranch:a,branchOptions:n,setIssueNumber:r,commitMessage:i,setCommitMessage:l,isCommitMode:c}=P(),f=s.useCallback(u=>{a(u)},[a]),h=s.useCallback(u=>{l(String(u.target.value).replace(/["`]/g,"'"))},[l]);return s.useEffect(()=>{c&&(a(null),r(""),l(""))},[c]),e.jsxs(C,{children:[e.jsxs(T,{columnGap:2,mb:2,children:[e.jsx(C,{width:"50%",children:e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Source Branch"}),e.jsx(Ns,{value:o,onChange:f,options:n,placeholder:"Enter source branch",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsxs(T,{width:"50%",alignItems:"flex-end",columnGap:2,children:[e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Issue Number"}),e.jsx(ft,{})]}),e.jsx(F,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>t(),icon:e.jsx(Ye,{})})})]})]}),e.jsx(T,{children:e.jsxs(De,{width:"100%",isRequired:!0,children:[e.jsx(ve,{children:"Commit Message"}),e.jsx(Ls,{placeholder:"Enter Commit Message",resize:"vertical",onInput:h,value:i})]})})]})}function gt({openCommitModal:t}){const{setShowCommitView:o,selectedLocalChanges:a,sourceBranch:n,issueNumber:r,commitMessage:i,setSocketPayload:l,configurableRowData:c}=P(),{RaiseClientNotificaiton:f}=te(),h=s.useCallback(()=>{o(!1)},[o]),u=s.useCallback(()=>{if(!n||n.value===""){f("Please select the source branch to proceed!","error");return}if(!r||!i||r===""||i===""){f("Please provide the issue number and the commit message to proceed!","error");return}l({sourceBranch:c.find(b=>b.id==n.value),issueNumber:r,commitMessage:i,filesToProcess:a}),t()},[n,r,i,f,a,c]);return e.jsx(C,{children:e.jsxs(T,{columnGap:2,justifyContent:"center",children:[e.jsx(L,{onClick:h,leftIcon:e.jsx(ye,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(F,{label:"Select at least 1 file",hasArrow:!0,isDisabled:a.length>0,children:e.jsxs(L,{onClick:u,leftIcon:e.jsx(X,{as:_e}),colorScheme:"yellow",isDisabled:a.length<1,children:["Commit ",a.length>0?`${a.length} File`:"",a.length>1?"s":""]})})]})})}function xt(){const{selectedBranches:t,logData:o,setLogData:a}=P(),[n,r]=s.useState([]),[i,l]=s.useState(""),c=s.useCallback(u=>{l(u.target.value)},[l]),f=s.useCallback(()=>{a([])},[a]),h=o.length===t.length;return s.useEffect(()=>{if(o.length===0)return;const u=o.map(b=>b.logs).flat();r(b=>xe.isEqual(b,u)?b:u)},[o]),{rowDataLogs:n,quickFilterLogsText:i,setQuickFilterLogsText:l,onQuickFilterLogsInputChanged:c,refreshLogs:f,areLogsFetched:h}}function bt({rowDataLogs:t,quickFilterLogsText:o,setAutoFillSelection:a=null,isAutofill:n=!1}){const r=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=s.useMemo(()=>{const f=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return n?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...f]:f},[n]),l=s.useRef(null),c=s.useCallback(()=>{var f,h;if(a){const u=(h=(f=l==null?void 0:l.current)==null?void 0:f.api)==null?void 0:h.getSelectedNodes().map(b=>b.data);a(u[0]||null)}},[a]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:n?"90%":"85%",width:"100%"},children:e.jsx(ce,{ref:l,rowData:t,defaultColDef:r,columnDefs:i,onSelectionChanged:c,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!n,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function ts({setAutoFillSelection:t=!1,isAutofill:o=!1}){const{selectedBranches:a,logData:n}=P(),{rowDataLogs:r,quickFilterLogsText:i,onQuickFilterLogsInputChanged:l,refreshLogs:c,areLogsFetched:f}=xt();return f?e.jsxs(C,{h:"100%",children:[e.jsxs(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(re,{placeholder:"Type to search...",onInput:l,width:"100%"})]}),e.jsx(C,{children:e.jsx(F,{label:"Refresh",hasArrow:!0,children:e.jsx(H,{onClick:c,icon:e.jsx(ye,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(bt,{rowDataLogs:r,quickFilterLogsText:i,setAutoFillSelection:t,isAutofill:o})]}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(z,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Re,{spacing:3,children:a.map(h=>{const u=n.find(b=>b.id===h.id);return e.jsxs(le,{display:"flex",alignItems:"center",children:[e.jsx(ae,{w:30,h:30,as:u?oe:Ms,color:"yellow.500"}),ke(h["Branch Folder"],h["Branch Version"],h["SVN Branch"])]},h.branchId)})})]}),e.jsx(T,{justifyContent:"center",children:e.jsx(As,{value:n.length/a.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Vs,{children:[n.length," / ",a.length]})})})]})}function pt(t){const{data:o}=t,a=async()=>{window.open(o.url,"_blank")};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(Es,{}),onClick:a,colorScheme:"yellow"})}function Ct({rowDataTrello:t,quickFilterTrelloText:o,setAutoFillSelection:a}){const n=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=s.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:pt,width:120}],[]),i=s.useRef(null),l=s.useCallback(()=>{var f,h;const c=(h=(f=i==null?void 0:i.current)==null?void 0:f.api)==null?void 0:h.getSelectedNodes().map(u=>u.data);a(c[0]||null)},[a]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(ce,{ref:i,rowData:t,defaultColDef:n,columnDefs:r,onSelectionChanged:l,quickFilterText:o,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function wt({setAutoFillSelection:t}){const{socket:o}=P(),{key:a,token:n,isTrelloIntegrationEnabled:r,emitTrelloCardNamesSearch:i}=ss(),[l,c]=s.useState(""),[f,h]=s.useState(""),[u,b]=s.useState([]),y=s.useCallback(xe.debounce(x=>{x.trim()!==""&&i(a,n,x)},250),[a,n,i]),I=s.useCallback(x=>{c(String(x.target.value).trim())},[c]),M=s.useCallback(()=>{l.trim()!==""&&i(a,n,l)},[l,a,n,i]),p=s.useCallback(x=>{h(x.target.value)},[]);return s.useEffect(()=>(y(l),()=>y.cancel()),[l,y]),s.useEffect(()=>{const x=j=>{b(j&&j.length>0?j:[])};return o==null||o.on("trello-result-search-names-card",x),()=>o==null?void 0:o.off("trello-result-search-names-card",x)},[o]),r?e.jsxs(C,{h:"100%",children:[e.jsxs(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(re,{placeholder:"Type to search...",onInput:I,width:"100%"})]}),e.jsx(C,{children:e.jsx(F,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(H,{onClick:M,icon:e.jsx(ye,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(T,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(T,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(re,{placeholder:"Type to search...",onInput:p,width:"100%"})]})}),e.jsx(Ct,{rowDataTrello:u,quickFilterTrelloText:f,setAutoFillSelection:t})]}):e.jsx(C,{h:"100%",p:4,children:e.jsxs(z,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(We,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx(Ye,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function jt({isModalOpen:t,closeModal:o}){const{setSourceBranch:a,branchOptions:n,setIssueNumber:r,setCommitMessage:i,setPostCommitData:l}=P(),[c,f]=s.useState(0),[h,u]=s.useState([null,null]),[b,y]=s.useState(!0),I=s.useCallback(j=>{f(j),u(j===0?w=>[w[0],null]:w=>[null,w[1]])},[f]),M=s.useCallback(j=>{u(w=>[j,...w.slice(1)])},[u]),p=s.useCallback(j=>{u(w=>[w[0],j])},[u]),x=s.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",c),console.debug("Selected autofill selection:",JSON.stringify(h,null,4));let j=h[c];if(c===0){const w=j.message,g=j.branchId,S=w.match(/\s*(Issue)*\s*(\d+)\s*/),D=S?S[2]:null,N=w.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");g&&a(n.find(U=>U.value===g)),D&&r(D),N.trim()!==""&&i(N)}else{const w=j.name,g=w.match(/\s*(Issue)*\s*(\d+)\s*/),S=g?g[2]:null,D=w.replace(/\s*(Issue)*\s*(\d+)/,"");S&&r(S),D.trim()!==""&&i(D),l({type:"trello",data:j})}o()},[c,h,o]);return s.useEffect(()=>{y(!(h.length==2&&(h[0]||h[1])))},[h]),s.useEffect(()=>{u([null,null])},[t]),e.jsxs(qe,{isOpen:t,onClose:o,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(be,{}),e.jsxs(Ge,{maxH:"95%",maxW:"95%",children:[e.jsx(pe,{children:e.jsx(K,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(Be,{size:"lg"}),e.jsx(Ce,{children:e.jsx(C,{height:"70vh",children:e.jsxs(Xe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:j=>I(j),children:[e.jsxs(Ke,{children:[e.jsx(me,{children:"SVN Logs"}),e.jsx(me,{children:"Trello"})]}),e.jsxs(Je,{h:"90%",children:[e.jsx(ge,{px:0,pb:0,h:"100%",children:e.jsx(ts,{setAutoFillSelection:M,isAutofill:!0})}),e.jsx(ge,{px:0,pb:0,h:"100%",children:e.jsx(wt,{setAutoFillSelection:p})})]})]})})}),e.jsxs(Se,{children:[e.jsx(L,{mr:3,onClick:()=>o(),children:"Cancel"}),e.jsx(F,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!b,children:e.jsx(L,{colorScheme:"yellow",onClick:x,isDisabled:b,children:"Select"})})]})]})]})}function St(){const t=s.useCallback((o,a)=>{console.log(`Option Change for ${o}:`,a)},[]);return e.jsxs(C,{mb:4,children:[e.jsx(K,{as:"h6",size:"sm",children:"Commit Options"}),e.jsx(Qe,{colorScheme:"yellow",children:e.jsxs(Ps,{direction:"row",spacing:4,mt:2,children:[e.jsx(se,{defaultChecked:!1,onChange:o=>t("Use 1 Issue Per Folder",o.target.checked),children:"Use 1 Issue Per Folder?"}),e.jsx(se,{defaultChecked:!1,onChange:o=>t("Use 1 Issue Per File",o.target.checked),children:"Use 1 Issue Per File?"})]})})]})}function yt(){const{isDebug:t,setIsCommitMode:o,selectedBranchStatuses:a,showCommitView:n,setShowCommitView:r,selectedBranches:i,configurableRowData:l}=P(),[c,f]=s.useState({}),[h,u]=s.useState([]),[b,y]=s.useState([]),{isOpen:I,onOpen:M,onClose:p}=Te(),{isOpen:x,onOpen:j,onClose:w}=Te(),g=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);s.useEffect(()=>{if(i.length<1||n){i.length<1&&o(!1);return}f({})},[i,n]),s.useEffect(()=>{t&&(console.debug("Branch Status Rows:",a),console.debug("Selected Rows:",i))},[t,a,i]),s.useEffect(()=>{a.length===i.length&&(a.forEach(A=>{let v=A.id,O=A.status.filesToCommit,$=A.status.filesToUpdate;const k=l.find(V=>V.id===v);if($.length>0){const V=ke(k["Branch Folder"],k["Branch Version"],k["SVN Branch"]);f(W=>({...W,[V]:[...W[V]||[],...$]}))}if(O.length>0){const V=O.map(W=>({branchId:v,"Branch Folder":k["Branch Folder"],"Branch Version":k["Branch Version"],"SVN Branch":k["SVN Branch"],"Full Path":W.path,"File Path":`${Zs(A.status.branch)}\\${W.pathDisplay}`,"Local Status":W.wcStatus}));u(W=>[...W,...V.filter(Q=>!["unversioned","missing"].includes(Q["Local Status"]))]),y(W=>[...W,...V.filter(Q=>["unversioned","missing"].includes(Q["Local Status"]))])}}),r(!0))},[a,i,l]);const S=Object.keys(c).length>0,D=h.length>0,N=b.length>0,U=S||D||N;return e.jsxs(C,{children:[e.jsx(St,{}),e.jsx(C,{mb:6,children:e.jsx(mt,{openMessageAutoFillModal:j})}),e.jsx(zs,{isLoaded:n&&U,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(Xe,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:S?0:D?1:2,isLazy:!1,children:[e.jsxs(Ke,{children:[e.jsx(me,{isDisabled:!S,children:e.jsx(F,{label:"No files to update!",hasArrow:!0,isDisabled:S,children:"Files to Update"})}),e.jsx(me,{isDisabled:!D,children:e.jsx(F,{label:"No files to commit!",hasArrow:!0,isDisabled:D,children:"Local Changes"})}),e.jsx(me,{isDisabled:!N,children:e.jsx(F,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:N,children:"Untracked Changes"})})]}),e.jsxs(Je,{children:[e.jsx(ge,{px:0,children:e.jsx(dt,{fileUpdates:c})}),e.jsx(ge,{px:0,children:e.jsx(ht,{rowDataLocalChanges:h,setRowDataLocalChanges:u,defaultColDefsCommit:g})}),e.jsx(ge,{px:0,children:e.jsx(ut,{rowDataUntrackedChanges:b,setRowDataUntrackedChanges:y,defaultColDefsCommit:g})})]})]})}),n&&!U?e.jsxs(z,{mt:4,className:"animation-pulse",fontWeight:600,textAlign:"center",children:["No changes have been spotted!",e.jsx("br",{}),"Please use the refresh button ðŸ‘‡ if you have recently made a change"]}):e.jsx(e.Fragment,{}),e.jsx(C,{mt:6,children:e.jsx(gt,{openCommitModal:M})}),e.jsx(ct,{isModalOpen:I,closeModal:p}),e.jsx(jt,{isModalOpen:x,closeModal:w})]})}function Bt(){const{showSelectedBranchesLog:t,setShowSelectedBranchesLog:o}=P();return e.jsxs(Os,{isOpen:t,onClose:()=>o(!1),placement:"left",size:"full",children:[e.jsx(be,{}),e.jsxs(Us,{children:[e.jsx(Be,{size:"lg"}),e.jsx(pe,{children:"Selected Branches: SVN Log"}),e.jsx(Ce,{children:e.jsx(C,{height:"100%",children:e.jsx(ts,{})})})]})]})}function kt(){const{toast:t,RaiseClientNotificaiton:o}=te(),{isOpen:a,onOpen:n,onClose:r}=Te(),i=s.useRef(),[l,c]=s.useState(!1);s.useEffect(()=>{if(!window.electron){o("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{t.closeAll(),n()}),window.electron.on("update-error",u=>{o(`An error occurred while checking for updates: ${u}`,"error",5e3),c(!1)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[t,n]);const f=s.useCallback(()=>{r(),o("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[r,o]),h=s.useCallback(()=>{if(l){o("Update is already in progress. Please wait.","info",5e3);return}window.electron?(c(!0),window.electron.downloadUpdate().catch(u=>{c(!1),o(`An error occurred while downloading the update: ${u}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{o("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),r()}),window.electron.on("update-not-available",()=>{o("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),c(!1),r()})):o("Cannot update Titan in a non-desktop application environment","error",5e3)},[l,o,c,r]);return e.jsx(He,{isOpen:a,leastDestructiveRef:i,onClose:r,motionPreset:"slideInBottom",closeOnOverlayClick:!l,children:e.jsx(be,{children:e.jsxs($e,{children:[e.jsx(pe,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),l?e.jsx(e.Fragment,{}):e.jsx(Be,{}),e.jsx(Ce,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(Se,{children:[e.jsx(L,{colorScheme:"red",ref:i,onClick:f,isDisabled:l,children:"Cancel"}),e.jsx(L,{colorScheme:"yellow",onClick:h,ml:3,isDisabled:l,children:"Confirm"})]})]})})})}function Dt(){if(!window.electron)return e.jsx(e.Fragment,{});const t=s.useCallback(()=>{window.electron.minimizeWindow()},[]),o=s.useCallback(()=>{window.electron.maximizeWindow()},[]),a=s.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Ws.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(T,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(K,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(T,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(H,{"aria-label":"Minimize",size:"xs",icon:e.jsx(Hs,{}),onClick:t,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Maximize",size:"xs",icon:e.jsx($s,{}),onClick:o,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Close",size:"xs",icon:e.jsx(Ie,{}),onClick:a,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function vt(){const{isCommitMode:t,selectedBranches:o,configurableRowData:a}=P(),{RaiseClientNotificaiton:n}=te();return s.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{n("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(C,{className:"titanBody",children:[e.jsx(Dt,{}),e.jsxs(C,{p:10,children:[e.jsx(nt,{}),e.jsx(kt,{}),e.jsxs(T,{rowGap:4,flexDirection:"column",children:[e.jsx(C,{children:e.jsx(it,{})}),e.jsx(_s,{in:t,animateOpacity:!0,children:e.jsxs(C,{id:"sectionCommit",children:[e.jsxs(K,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",o.length==a.length?"All":`${o.length}/${a.length}`," Branch",o.length==1?"":"es"]}),e.jsx(yt,{})]})})]}),e.jsx(Bt,{})]})]})}const{definePartsStyle:ns,defineMultiStyleConfig:ls}=Xs(Ks.keys),Ft=ns({overlay:{bg:"blackAlpha.900"},dialog:{bg:"gray.900",color:"white",boxShadow:"rgba(255, 255, 255, 0.07) 0px -20px 20px 20px"},header:{bg:"gray.900",color:"white",borderRadius:"20px",p:4},body:{p:4,color:"white"},footer:{bg:"gray.900",p:4,color:"white",borderRadius:"20px"}}),It=ls({baseStyle:Ft}),Rt=ns({overlay:{bg:"blackAlpha.900"},dialog:{mt:st,bg:"gray.900",color:"white",boxShadow:"rgba(255, 255, 255, 0.07) 0px -20px 20px 20px"},header:{bg:"gray.900",color:"white",borderRadius:"20px",p:4},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),Tt=ls({baseStyle:Rt}),Nt={initialColorMode:"dark",useSystemColorMode:!1},Ue=qs({config:Nt,components:{Modal:It,Drawer:Tt}});Gs.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsxs(Qs,{theme:Ue,children:[e.jsx(Ys,{initialColorMode:Ue.config.initialColorMode}),e.jsx(tt,{children:e.jsx(vt,{})})]})}));
