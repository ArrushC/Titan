import{r as s,u as os,l as as,R as Ne,j as e,W as Me,d as Ve,L as We,I as rs,H as ee,T as v,e as W,f as X,M as is,g as cs,h as ds,i as hs,A as He,k as be,m as _e,n as pe,o as Ce,p as Se,B as T,D as us,C as Re,F,q as ye,s as fs,t as $e,v as ms,w as gs,x as Ie,S as xs,V as bs,y as Ee,z as ps,E as qe,G as Ge,J as Be,K as Cs,N as ws,O as js,P as Ss,Q as ys,U as Pe,X as C,Y as Bs,Z as ks,_ as Ds,$ as E,a0 as Fe,a1 as ne,a2 as le,a3 as oe,a4 as Z,a5 as vs,a6 as Rs,a7 as ue,a8 as Is,a9 as Fs,aa as Ts,ab as ze,ac as we,ad as Ns,ae as je,af as ae,ag as De,ah as ve,ai as Ms,aj as Qe,ak as As,al as Ls,am as Vs,an as Es,ao as Ps,ap as Ye,aq as Xe,ar as me,as as Ke,at as ge,au as Te,av as zs,aw as Os,ax as Us,ay as Ws,az as Hs,aA as _s,aB as $s,aC as qs,aD as Gs,aE as Qs,aF as Ys,aG as Xs,aH as Ks}from"./vendor.js";import{_ as xe}from"./lodash.js";import{A as ie}from"./ag-grid-react.js";import"./ag-grid-community.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const Js="/assets/Titan.png";function re(t=[]){return(Array.isArray(t)?t:[t]).map(o=>(delete o["Branch Info"],o))}function ke(t,a,o){return`${t==""?"Uncategorised":t} ${a==""?"Unversioned":a} ${String(o).split("\\").at(-1)}`}function Zs(t){return String(t).split("\\").at(-1)}const et="http://localhost:4000",st=40,tt="40px";function fe(t,a="info",o=3e3,l=!1){return{position:"top",variant:"solid",title:l?"Server Notification":"Client Notification",description:t,status:a,duration:o,isClosable:!0}}const Je=s.createContext({socket:null,toast:null,config:null,updateConfig:t=>{},isDebug:!1,setIsDebug:t=>{},configurableRowData:[],setConfigurableRowData:t=>{},branchInfos:{},setBranchInfos:t=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:t=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:t=>{},isCommitMode:!1,setIsCommitMode:t=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:t=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:t=>{},sourceBranch:null,setSourceBranch:t=>{},branchOptions:[],issueNumber:null,setIssueNumber:t=>{},commitMessage:"",setCommitMessage:t=>{},selectedLocalChanges:[],setSelectedLocalChanges:t=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:t=>{},socketPayload:null,setSocketPayload:t=>{},postCommitData:{},setPostCommitData:t=>{},logData:[],setLogData:t=>{}}),L=()=>s.useContext(Je),nt=({children:t})=>{const[a,o]=s.useState(null),[l,r]=s.useState(null),i=os(),[n,u]=s.useState(localStorage.getItem("isDebug")==="true");s.useEffect(()=>{const m=as(et);return r(m),m.on("connect",()=>{m.emit("titan-config-get","fetch"),m.once("titan-config-get",A=>{o(A),i(fe("Configurations Loaded","success",2e3))})}),m.on("notification",A=>{i(fe(A.description,A.status,A.duration,!0))}),m.on("disconnect",()=>{i(fe("Server Has Been Disconnected","warning",0,!0))}),m.on("reconnect",()=>{i(fe("Server Has Been Reconnected","success",2e3,!0))}),()=>{m.disconnect()}},[]),s.useEffect(()=>{localStorage.setItem("isDebug",String(n))},[n]);const f=s.useCallback(m=>{m!=null&&(console.log("Saving config:",m),l==null||l.emit("titan-config-set",m))},[l]),d=s.useCallback(m=>{o(A=>{const G=m(A);return f(G),G})},[o,f]),[h,b]=s.useState([]),[y,R]=s.useState({}),N=s.useRef(null),[p,x]=s.useState([]),[w,S]=s.useState(!1),[g,j]=s.useState(!1),[D,V]=s.useState([]),H=s.useRef(null),P=s.useRef(null),[z,O]=s.useState(!1),[$,k]=s.useState(null),M=s.useMemo(()=>h.filter(m=>m["Branch Folder"]&&m["Branch Version"]&&m["SVN Branch"]&&m["Branch Folder"]!==""&&m["Branch Version"]!==""&&m["SVN Branch"]!=="").map(m=>({value:m.id,label:ke(m["Branch Folder"],m["Branch Version"],m["SVN Branch"])})),[h]),[U,Q]=s.useState(null),[Y,K]=s.useState(""),[J,de]=s.useState([]),[B,c]=s.useState([]),[I,q]=s.useState(null),[he,Ae]=s.useState({}),[te,_]=Ne.useState([]);return s.useEffect(()=>{V([]),O(!1)},[h]),s.useEffect(()=>{if(!g||!z)return;const m=setTimeout(()=>{var A;(A=document.getElementById("sectionCommit"))==null||A.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(m)},[g,z]),s.useEffect(()=>{if(p.length<1||z){p.length<1&&j(!1);return}V([]),q(null),re(p).forEach(m=>{console.debug("Emitting svn-status-single for branch:",m),l==null||l.emit("svn-status-single",{selectedBranch:m})})},[l,p,z]),s.useEffect(()=>{const m=()=>{O(!1)};return l==null||l.on("branch-refresh-unseen",m),()=>l==null?void 0:l.off("branch-refresh-unseen",m)},[l]),s.useEffect(()=>{const m=A=>{n&&console.debug("Received branch status data:",A),V(G=>[...G,A])};return l==null||l.on("branch-status-single",m),()=>l==null?void 0:l.off("branch-status-single",m)},[l]),s.useEffect(()=>{_([])},[p]),s.useEffect(()=>{te.length===0&&l&&x(m=>(m.length>0&&l.emit("svn-log-selected",{selectedBranches:p}),m))},[te,l]),s.useEffect(()=>{const m=A=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),_(G=>G.some(ls=>ls.id===A.id)?G:[...G,A])};return l==null||l.on("svn-log-result",m),()=>l==null?void 0:l.off("svn-log-result",m)},[l]),e.jsx(Je.Provider,{value:{socket:l,toast:i,config:a,updateConfig:d,isDebug:n,setIsDebug:u,configurableRowData:h,setConfigurableRowData:b,branchInfos:y,setBranchInfos:R,branchTableGridRef:N,selectedBranches:p,setSelectedBranches:x,showSelectedBranchesLog:w,setShowSelectedBranchesLog:S,isCommitMode:g,setIsCommitMode:j,selectedBranchStatuses:D,setSelectedBranchStatuses:V,localChangesGridRef:H,untrackedChangesGridRef:P,showCommitView:z,setShowCommitView:O,sourceBranch:$,setSourceBranch:k,branchOptions:M,issueNumber:U,setIssueNumber:Q,commitMessage:Y,setCommitMessage:K,selectedLocalChanges:J,setSelectedLocalChanges:de,selectedUntrackedChanges:B,setSelectedUntrackedChanges:c,socketPayload:I,setSocketPayload:q,postCommitData:he,setPostCommitData:Ae,logData:te,setLogData:_},children:t})};function ce(){const{socket:t}=L(),a=s.useCallback(()=>{t==null||t.emit("titan-config-open",{})},[t]),o=s.useCallback((d,h,b,y)=>{t==null||t.emit("svn-update-single",{id:d,branch:h,version:b,folder:y})},[t]),l=s.useCallback((d,h,b,y)=>{t==null||t.emit("svn-info-single",{id:d,branch:h,version:b,folder:y})},[t]),r=s.useCallback(d=>{t==null||t.emit("svn-commit",d)},[t]),i=s.useCallback(d=>{t==null||t.emit("svn-files-revert",{filesToProcess:d})},[t]),n=s.useCallback(d=>{t==null||t.emit("svn-files-add-remove",{filesToProcess:d})},[t]),u=s.useCallback((d,h,b,y=null)=>{t==null||t.emit("trello-search-names-card",{key:d,token:h,query:b,limit:y})},[t]),f=s.useCallback((d,h,b,y)=>{t==null||t.emit("trello-update-card",{key:d,token:h,trelloData:b,commitResponses:y})},[t]);return{emitOpenConfig:a,emitUpdateSingle:o,emitInfoSingle:l,emitCommitPayload:r,emitFilesRevert:i,emitFilesAddRemove:n,emitTrelloCardNamesSearch:u,emitTrelloCardUpdate:f}}function se(){const{toast:t}=L(),a=s.useCallback((o="",l="info",r=3e3,i=null)=>{const n=fe(o,l,r);if(t)return t(n);if(i)return i(n)},[t]);return{toast:t,RaiseClientNotificaiton:a}}function lt(){const{config:t,isDebug:a,setIsDebug:o}=L(),{emitOpenConfig:l}=ce(),{RaiseClientNotificaiton:r}=se(),i=s.useCallback(()=>{window.electron.checkForUpdates().then(u=>{console.debug("Check for updates result: ",u)}),window.electron.on("update-not-available",()=>{r("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[r]),n=s.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(u=>{r(`Application Version: v${u}`,"info",2e3)})},[r]);return e.jsxs(Me,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Ve,{alignItems:"center",children:[e.jsx(We,{onClick:n,children:e.jsx(rs,{src:Js,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(ee,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(ee,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Ve,{alignItems:"center",columnGap:2,children:[e.jsx(v,{label:`Current Debug Mode: ${a?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(W,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:a?e.jsx(X,{as:cs}):e.jsx(X,{as:is}),onClick:()=>o(u=>!u)})}),e.jsx(v,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(W,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(X,{as:ds}),onClick:()=>l()})}),e.jsx(v,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(W,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(X,{as:hs}),onClick:i,isDisabled:!window.electron})})]})]})}function ot({isAlertOpen:t,onCloseAlert:a,cancelRef:o,removeSelectedRows:l}){return e.jsx(He,{isOpen:t,leastDestructiveRef:o,onClose:a,children:e.jsx(be,{children:e.jsxs(_e,{children:[e.jsx(pe,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(Ce,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(Se,{children:[e.jsx(T,{ref:o,onClick:a,children:"Cancel"}),e.jsx(T,{colorScheme:"red",onClick:l,ml:3,children:"Delete"})]})]})})})}function Oe(){const{innerWidth:t,innerHeight:a}=window;return{width:t,height:a}}function at(){const[t,a]=s.useState(Oe());return s.useEffect(()=>{function o(){a(Oe())}return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),t}function rt({rowData:t,onRowValueChanged:a}){const{config:o,branchTableGridRef:l,updateConfig:r,isDebug:i,selectedBranches:n,setSelectedBranches:u,setSelectedBranchStatuses:f,setShowCommitView:d}=L(),h=at(),[b,y]=s.useState(h.height>768),R=s.useCallback(g=>{const j={...g,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};r(D=>({...D,branches:re([...D.branches,j])}))},[r]),N=s.useCallback(g=>{var D,V,H,P;const j=(V=(D=l==null?void 0:l.current)==null?void 0:D.api)==null?void 0:V.getSelectedNodes().map(z=>z.data);if(i&&console.log("SectionBranches.jsx: onSelectionChanged - event",g),i&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",n),(g==null?void 0:g.source)=="rowDataChanged"){const z=n.map(O=>O.id);(P=(H=l==null?void 0:l.current)==null?void 0:H.api)==null||P.forEachNode(O=>{z.includes(O.data.id)&&O.setSelected(!0)});return}else["api"].includes(g==null?void 0:g.source)||(u(j),f([]),d(!1))},[i,l,n,u,d]),p=s.useCallback(g=>{const j=[];g.api.forEachNode(D=>j.push(D.data)),i&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",j),r(D=>({...D,branches:re(j)}))},[r,i]),x=s.useCallback(g=>{const j=o==null?void 0:o.branchFolderColours[g.data["Branch Folder"]];return{backgroundColor:j?`${j}20`:"transparent"}},[o==null?void 0:o.branchFolderColours]),w=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),S=s.useMemo(()=>{const g=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:j=>e.jsx(v,{label:"Copy Row",hasArrow:!0,children:e.jsx(W,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>R(j.data),icon:e.jsx(Re,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:j=>j.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return b?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:us,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...g]:g},[o,b,R]);return s.useEffect(()=>{y(h.height>768)},[h]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:b?"auto":"428px",width:"100%"},children:e.jsx(ie,{ref:l,rowData:t,defaultColDef:w,columnDefs:S,stopEditingWhenCellsLoseFocus:!0,getRowStyle:x,onRowDragEnd:p,domLayout:b?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:N,onRowValueChanged:a,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:g=>g.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!b,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function it(){const{updateConfig:t,isDebug:a,socket:o,configurableRowData:l,setConfigurableRowData:r,branchInfos:i,config:n,setBranchInfos:u,setSelectedBranches:f,setSelectedBranchStatuses:d,showCommitView:h,setShowCommitView:b}=L(),[y,R]=s.useState([]),N=s.useCallback(p=>{a&&console.log("AG Grid: onRowValueChanged - event",p),a&&console.log("AG Grid: onRowValueChanged - rowDataBranches",y),t(x=>({...x,branches:re(y)}))},[y,t,a]);return s.useEffect(()=>{const p=xe.debounce(()=>{const x=l.map(w=>({...w,"Branch Info":i[w.id]||"Hasn't been refreshed"}));R(w=>xe.isEqual(x,w)?w:x)},300);return p(),()=>p.cancel()},[l,i]),s.useEffect(()=>{r(p=>n&&n.branches&&!xe.isEqual(n.branches,p)?n.branches:p)},[n]),s.useEffect(()=>{const p=x=>{u(w=>{const S={...w,[x.id]:x.info};return console.debug("branch-info-single data received:",x),console.debug("branch-info-single newBranchInfos",S),f(g=>(g.find(D=>D.id===x.id)&&h&&(d([]),b(!1)),g)),S})};return o==null||o.on("branch-info-single",p),()=>o==null?void 0:o.off("branch-info-single")},[o,h]),{rowDataBranches:y,setRowDataBranches:R,onRowValueChanged:N}}function ct(){const{socket:t,updateConfig:a,isDebug:o,setShowSelectedBranchesLog:l,configurableRowData:r,branchTableGridRef:i,selectedBranches:n,setSelectedBranches:u,isCommitMode:f,setIsCommitMode:d,setSelectedBranchStatuses:h,setShowCommitView:b}=L(),{emitUpdateSingle:y,emitInfoSingle:R}=ce(),{RaiseClientNotificaiton:N}=se(),[p,x]=s.useState(!1),w=s.useRef(),S=()=>x(!1),{rowDataBranches:g,setRowDataBranches:j,onRowValueChanged:D}=it(),[V,H]=s.useState(0),[P,z]=s.useState([]),O=s.useCallback(()=>{var B,c;o&&console.log("SectionBranches.jsx: clearSelection: START"),(c=(B=i==null?void 0:i.current)==null?void 0:B.api)==null||c.deselectAll(),u([]),d(!1)},[o,i,u]),$=s.useCallback(()=>{var c,I;const B=(I=(c=i==null?void 0:i.current)==null?void 0:c.api)==null?void 0:I.getSelectedNodes().map(q=>q.data);u(B),x(!0)},[i,u]),k=s.useCallback(()=>{const B={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};a(c=>({...c,branches:re([...c.branches,B])}))},[a]),M=s.useCallback(()=>{n.forEach(B=>{y(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[n,y]),U=s.useCallback(()=>{P.forEach(B=>{y(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[P,y]),Q=s.useCallback(()=>{const B=n.map(I=>I.id),c=g.filter(I=>!B.includes(I.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",c),a(I=>({...I,branches:re(c)})),O(),S()},[n,g,a]),Y=s.useCallback(()=>{l(!0)},[]),K=s.useCallback(()=>{j(B=>{const c=[...B];return n.forEach(I=>{const q=c.findIndex(he=>he.id===I.id);c[q]["Branch Info"]="Refreshing..."}),c}),n.forEach(B=>{R(B.id,B["SVN Branch"],B["Branch Version"],B["Branch Folder"])})},[n,R]),J=s.useCallback(()=>{if(f){N("Unable to refresh branches while in commit mode","warning",0);return}N("Refreshing all branches. Please wait until this is done!","info",3e3);const B=Date.now();r.forEach(c=>{R(c.id,c["SVN Branch"],c["Branch Version"],c["Branch Folder"])}),H(B)},[r,R,N,f]),de=s.useCallback(()=>{d(B=>!B),b(!1)},[d]);return s.useEffect(()=>{const B=g.filter(c=>String(c["Branch Info"]).toLowerCase().includes("behind"));z(B)},[g]),s.useEffect(()=>{const c=Date.now();if(r.length>0){c-V>3e5&&J();const I=setInterval(()=>{J()},3e5);return()=>clearInterval(I)}},[r,V,J]),s.useEffect(()=>{const B=c=>{o&&console.debug("branch-success-single data received:",c),R(c.id,c.branch,c.version,c.folder)};return t==null||t.on("branch-success-single",B),()=>t==null?void 0:t.off("branch-success-single",B)},[o,t,R]),e.jsxs("div",{children:[e.jsxs(Me,{mb:4,justify:"space-between",children:[e.jsxs(F,{columnGap:2,children:[e.jsx(v,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(T,{onClick:K,leftIcon:e.jsx(ye,{}),colorScheme:"yellow",isDisabled:n.length<1,children:["Refresh ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(v,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(T,{onClick:M,leftIcon:e.jsx(X,{as:fs}),colorScheme:"yellow",isDisabled:n.length<1,children:["Update ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(v,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(T,{onClick:de,leftIcon:e.jsx(X,{as:$e}),colorScheme:"yellow",isDisabled:n.length<1,children:f?"Undo Commit":"Commit"})}),e.jsx(v,{label:"Requires at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsx(T,{onClick:Y,leftIcon:e.jsx(ms,{}),colorScheme:"yellow",isDisabled:n.length<1,children:"View Logs"})})]}),e.jsx(F,{columnGap:2,children:e.jsx(v,{label:"No outdated branches to update",isDisabled:P.length>0,hasArrow:!0,children:e.jsx(T,{onClick:U,leftIcon:e.jsx(gs,{}),colorScheme:"yellow",isDisabled:P.length<1,children:"Update Outdated"})})})]}),e.jsx(rt,{rowData:g,onRowValueChanged:D}),e.jsxs(F,{columnGap:2,mt:4,children:[e.jsx(v,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(T,{onClick:O,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:n.length<1,children:["Deselect ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(v,{label:"Please select at least 1 branch",isDisabled:n.length>0,hasArrow:!0,children:e.jsxs(T,{onClick:$,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:n.length<1,children:["Delete ",n.length>0?`${n.length} Branch`:"",n.length>1?"es":""]})}),e.jsx(T,{onClick:k,leftIcon:e.jsx(xs,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(ot,{isAlertOpen:p,onCloseAlert:S,cancelRef:w,removeSelectedRows:Q})]})}function Ze(t){const{data:a,onDiffResult:o}=t,l=async()=>{try{const r=await window.electron.openTortoiseSVNDiff({fullPath:a["Full Path"],branchFolder:a["Branch Folder"],branchVersion:a["Branch Version"]});o(r)}catch(r){o({success:!1,error:r.message})}};return e.jsx(W,{"aria-label":"Diff",size:"sm",icon:e.jsx(bs,{}),onClick:l,colorScheme:"yellow"})}function es(){const{config:t}=L(),{emitTrelloCardNamesSearch:a,emitTrelloCardUpdate:o}=ce(),l=t==null?void 0:t.trelloIntegration,r=(l==null?void 0:l.key)||null,i=(l==null?void 0:l.token)||null,n=r&&i&&r.trim()!==""&&i.trim()!==""&&r.toUpperCase()!=="TRELLO_API_KEY"&&i.toUpperCase!=="TRELLO_TOKEN";return{key:r,token:i,isTrelloIntegrationEnabled:n,emitTrelloCardNamesSearch:a,emitTrelloCardUpdate:o}}function dt({isModalOpen:t,closeModal:a}){const{socket:o,setIsCommitMode:l,setSelectedBranchStatuses:r,setShowCommitView:i,socketPayload:n,postCommitData:u,setPostCommitData:f}=L(),{emitUpdateSingle:d,emitCommitPayload:h}=ce(),{key:b,token:y,isTrelloIntegrationEnabled:R,emitTrelloCardUpdate:N}=es(),{RaiseClientNotificaiton:p}=se(),[x,w]=s.useState([]),{onCopy:S,value:g,setValue:j,hasCopied:D}=Ee(""),{onCopy:V,value:H,setValue:P,hasCopied:z}=Ee(""),O=s.useCallback(c=>{c.success?p("TortoiseSVN diff opened successfully","success",3e3):p(`Error opening TortoiseSVN diff: ${JSON.stringify(c.error,null,4)}`,"error",0)},[p]),$=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:k,setActiveStep:M}=ps({index:1,count:$.length}),U=s.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),Q=s.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:Ze,cellRendererParams:{onDiffResult:O},width:90}],[]),Y=s.useCallback((c,I=!0)=>{const q="â€‹".repeat(7),he=c.includes("MarkupSupport")?`\r
${q}`:`\r
`,te=x.sort((_,m)=>_["Branch Version"].localeCompare(m["Branch Version"])).map(_=>{const m=[];c.includes("BranchFolder")&&m.push(_["Branch Folder"]),c.includes("BranchVersion")&&m.push(_["Branch Version"]),c.includes("SVNBranch")&&m.push(_.branchPathFolder);let A=m.join(" ").trim();if(c.includes("IssueNumber")){const Le=_["Branch Folder"]===n.sourceBranch["Branch Folder"]?n.issueNumber:"XXXXXX";A+=` Issue [${Le}]`}const G=_.revision?_.revision:_.errorMessage||"Error";return A+=` Revision [${G}]`,A});return I?te.join(he):te},[x,n]),K=s.useCallback(c=>{const I=Y(c);j(I)},[Y,j]),J=s.useCallback(()=>{M(c=>c-1)},[M]),de=s.useCallback(()=>{if(u.type!=="trello"){p("Trello Autofill is not enabled for this commit","error");return}const c=u.data,I=Y(["BranchFolder","BranchVersion","IssueNumber"],!1);N(b,y,c,I),p("Updating Trello card with commit information","info"),f(null)},[u,p,Y]),B=s.useCallback(()=>{M(c=>c+1)},[M]);return s.useEffect(()=>{M(1),w([]),j(""),P("")},[t,w]),s.useEffect(()=>{!t||k!=0||(a(),M(1),w([]),j(""),P(""))},[k,t]),s.useEffect(()=>{!t||k!=2||h(n)},[k,t,h,n]),s.useEffect(()=>{!t||k!=3||(p("The commit process has been completed successfully","success",5e3),K(["BranchFolder","BranchVersion","SVNBranch"]),P(n.commitMessage||""))},[p,k,t,K]),s.useEffect(()=>{!t||k<=3||(S(),p("Updating selected branches! Please wait","info",1500),x.forEach(c=>{d(c.branchId,c["SVN Branch"],c["Branch Version"],c["Branch Folder"])}),l(!1),r([]),i(!1),a(),M(1))},[p,k,t,x,d]),s.useEffect(()=>{const c=I=>{w(q=>[...q,I])};return o==null||o.on("svn-commit-status-live",c),()=>o==null?void 0:o.off("svn-commit-status-live",c)},[o]),s.useEffect(()=>{if(k!=2)return;const c=setTimeout(()=>{x.length>0&&x[0].bulkCommitLength==x.length&&M(3)},3e3);return()=>clearTimeout(c)},[k,x]),s.useEffect(()=>{(D||z)&&p("Copied to Clipboard","success",1500)},[D,z,p]),!t||!n?e.jsx(e.Fragment,{}):e.jsxs(qe,{isOpen:t,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:k==1,children:[e.jsx(be,{}),e.jsxs(Ge,{maxH:"85%",maxW:"95%",children:[e.jsx(pe,{children:e.jsx(ee,{as:"h2",size:"lg",children:"Commit Selected Files"})}),k==1?e.jsx(Be,{size:"lg"}):e.jsx(e.Fragment,{}),e.jsxs(Ce,{children:[e.jsx(Cs,{index:k,mb:6,size:"lg",colorScheme:"yellow",children:$.map((c,I)=>e.jsxs(ws,{children:[e.jsx(js,{children:e.jsx(Ss,{complete:e.jsx(ys,{}),incomplete:e.jsx(Pe,{}),active:e.jsx(Pe,{})})}),e.jsxs(C,{flexShrink:"0",children:[e.jsx(Bs,{children:c.title}),e.jsx(ks,{children:c.description})]}),e.jsx(Ds,{})]},I))}),e.jsxs(C,{children:[k!=1?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(E,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Fe,{spacing:3,children:[e.jsxs(ne,{children:[e.jsx(le,{as:oe,color:"yellow.500"}),"Source Branch: ",e.jsx(Z,{children:ke(n.sourceBranch["Branch Folder"],n.sourceBranch["Branch Version"],n.sourceBranch["SVN Branch"])})]}),e.jsxs(ne,{children:[e.jsx(le,{as:oe,color:"yellow.500"}),"Issue Number: ",e.jsx(Z,{children:n.issueNumber})]}),e.jsxs(ne,{children:[e.jsx(le,{as:oe,color:"yellow.500"}),"Commit Message: ",e.jsx(Z,{children:n.commitMessage})]}),e.jsxs(ne,{children:[e.jsx(le,{as:oe,color:"yellow.500"}),"Example:"," ",e.jsxs(Z,{children:["Issue ",n.issueNumber," (",n.sourceBranch["Branch Folder"]," ",n.sourceBranch["Branch Version"],"): ",n.commitMessage]})]})]})]}),e.jsx(C,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(ie,{rowData:n.filesToProcess,defaultColDef:U,columnDefs:Q,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),k!=2?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsxs(E,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(C,{children:e.jsx(Fe,{spacing:3,children:x.map((c,I)=>e.jsxs(ne,{children:[e.jsx(le,{as:c.errorMessage?vs:oe,color:c.errorMessage?"red.500":"yellow.500"}),c.branchString,":Â ",e.jsx(Z,{children:c.errorMessage||c.revision})]},I))})})]}),k!=3?e.jsx(e.Fragment,{}):e.jsxs(C,{children:[e.jsx(C,{mb:4,children:e.jsxs(E,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(F,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(ee,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(C,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:g})})]}),e.jsx(C,{children:e.jsx(v,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(W,{"aria-label":"Copy To Clipboard",onClick:S,icon:e.jsx(Re,{}),colorScheme:"yellow"})})})]}),e.jsxs(C,{my:4,children:[e.jsx(E,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Rs,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:K,children:e.jsxs(Me,{children:[e.jsx(ue,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(ue,{value:"BranchVersion",children:"Branch Version"}),e.jsx(ue,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(ue,{value:"IssueNumber",children:"Issue Number"}),e.jsx(ue,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(F,{columnGap:10,alignItems:"center",children:[e.jsxs(C,{children:[e.jsx(E,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),n.sourceBranch&&n.sourceBranch["Branch Folder"]&&n.sourceBranch["Branch Version"]?e.jsx(Z,{children:`Issue ${n.issueNumber} (${n.sourceBranch["Branch Folder"]} ${n.sourceBranch["Branch Version"]}): ${H}`}):e.jsx(Z,{children:"Source information is undefined. Please check that you have entered the correct details otherwise contact the developer!"})]}),e.jsx(v,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(W,{"aria-label":"Copy To Clipboard",onClick:V,icon:e.jsx(Re,{}),colorScheme:"yellow"})})]})]})]})]}),e.jsx(Se,{children:e.jsxs(F,{flex:1,justifyContent:"space-between",children:[e.jsx(F,{columnGap:2,children:e.jsx(v,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:k<2,children:e.jsx(T,{onClick:J,mr:3,isDisabled:k>=2,children:k==1?"Cancel":"Previous"})})}),e.jsxs(F,{columnGap:2,children:[e.jsx(v,{hasArrow:!0,label:"Requires Trello Autofill",isDisabled:(u==null?void 0:u.type)==="trello"&&R,children:e.jsx(T,{colorScheme:"yellow",leftIcon:e.jsx(X,{as:Is}),onClick:de,isDisabled:k<3||(u==null?void 0:u.type)!="trello"||!R,children:"Update Card"})}),e.jsx(v,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:k!=2,children:e.jsx(T,{colorScheme:"yellow",onClick:B,isDisabled:k==2,children:k==$.length?"Complete":"Next"})})]})]})})]})]})}function ht({fileUpdates:t}){return e.jsx(C,{children:Object.keys(t).length>0?e.jsxs(C,{children:[e.jsx(E,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(C,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(Fs,{children:[e.jsx(Ts,{children:e.jsxs(ze,{children:[e.jsx(we,{children:"Branch"}),e.jsx(we,{children:"Path"}),e.jsx(we,{children:e.jsx(v,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(we,{children:e.jsx(v,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(Ns,{children:Object.keys(t).map(a=>e.jsx(Ne.Fragment,{children:t[a].map((o,l)=>e.jsxs(ze,{children:[e.jsx(je,{children:a}),e.jsx(je,{children:o.pathDisplay}),e.jsx(je,{children:o.wcStatus}),e.jsx(je,{children:o.reposStatus})]},l))},a))})]})}),e.jsx(E,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(C,{children:e.jsx(E,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function ut({rowDataLocalChanges:t,setRowDataLocalChanges:a,defaultColDefsCommit:o}){const{localChangesGridRef:l,isDebug:r,selectedBranches:i,showCommitView:n,setSelectedLocalChanges:u,selectedLocalChanges:f}=L(),{emitFilesRevert:d}=ce(),{RaiseClientNotificaiton:h}=se(),[b,y]=s.useState(""),R=s.useCallback(()=>{d(f)},[d,f]),N=s.useCallback(S=>{y(S.target.value)},[y]),p=s.useCallback(()=>{var g,j;const S=(j=(g=l==null?void 0:l.current)==null?void 0:g.api)==null?void 0:j.getSelectedNodes().map(D=>D.data);r&&console.log("CommitRegion.jsx: onFileViewSelectionChanged - selectedBranches",S),u(S)},[l,r]),x=s.useCallback(S=>{S.success?h("TortoiseSVN diff opened successfully","success",3e3):h(`Error opening TortoiseSVN diff: ${JSON.stringify(S.error,null,4)}`,"error",0)},[h]),w=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:Ze,cellRendererParams:{onDiffResult:x},width:90}],[]);return s.useEffect(()=>{i.length<1||n||(y(""),a([]),u([]))},[i,n]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsxs(F,{mb:4,alignItems:"center",children:[e.jsx(E,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ae,{placeholder:"Type to search...",onInput:N,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(ie,{ref:l,rowData:t,defaultColDef:o,columnDefs:w,onSelectionChanged:p,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(F,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(v,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:f.length>0,children:e.jsx(T,{onClick:R,colorScheme:"red",isDisabled:f.length<1,children:"Revert Selected"})})})]}):e.jsx(C,{children:e.jsx(E,{children:"Your selected branches do not contain any files to commit."})})})}function ft({rowDataUntrackedChanges:t,setRowDataUntrackedChanges:a,defaultColDefsCommit:o}){const{untrackedChangesGridRef:l,selectedUntrackedChanges:r,setSelectedUntrackedChanges:i,isDebug:n,selectedBranches:u,showCommitView:f}=L(),{emitFilesAddRemove:d,emitFilesRevert:h}=ce(),[b,y]=s.useState(""),R=s.useCallback(S=>{y(S.target.value)},[y]),N=s.useCallback(()=>{var g,j;const S=(j=(g=l==null?void 0:l.current)==null?void 0:g.api)==null?void 0:j.getSelectedNodes().map(D=>D.data);n&&console.log("CommitRegion.jsx: onUnseenFilesSelectionChanged - selectedBranches",S),i(S)},[l,n]),p=s.useCallback(()=>{d(r)},[d,r]),x=s.useCallback(()=>{h(r)},[h,r]),w=s.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return s.useEffect(()=>{u.length<1||f||(y(""),a([]),i([]))},[u,f]),e.jsx(C,{children:t.length>0?e.jsxs(C,{children:[e.jsx(E,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(F,{mb:4,alignItems:"center",children:[e.jsx(E,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ae,{placeholder:"Type to search...",onInput:R,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(ie,{ref:l,rowData:t,defaultColDef:o,columnDefs:w,onSelectionChanged:N,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(F,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(v,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(T,{onClick:p,colorScheme:"green",isDisabled:r.length<1,children:["Add/Remove ",r.length," File",r.length>1?"s":""]})}),e.jsx(v,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:r.length>0,children:e.jsxs(T,{onClick:x,colorScheme:"red",isDisabled:r.length<1,children:["Revert ",r.length," File",r.length>1?"s":""]})})]})]}):e.jsx(C,{children:e.jsx(E,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function mt(){const{issueNumber:t,setIssueNumber:a}=L(),o=l=>{const r=String(l.target.value);/^\d*$/.test(r)&&a(r.trim())};return e.jsx(ae,{value:t,onChange:o,placeholder:"Enter number"})}function gt({openMessageAutoFillModal:t}){const{sourceBranch:a,setSourceBranch:o,branchOptions:l,setIssueNumber:r,commitMessage:i,setCommitMessage:n,isCommitMode:u}=L(),f=s.useCallback(h=>{o(h)},[o]),d=s.useCallback(h=>{n(String(h.target.value).replace(/["`]/g,"'"))},[n]);return s.useEffect(()=>{u&&(o(null),r(""),n(""))},[u]),e.jsxs(C,{children:[e.jsxs(F,{columnGap:2,mb:2,children:[e.jsx(C,{width:"50%",children:e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Source Branch"}),e.jsx(Ms,{value:a,onChange:f,options:l,placeholder:"Select branch you would like to commit from",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsxs(F,{width:"50%",alignItems:"flex-end",columnGap:2,children:[e.jsxs(De,{isRequired:!0,children:[e.jsx(ve,{children:"Issue Number"}),e.jsx(mt,{})]}),e.jsx(v,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(W,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>t(),icon:e.jsx(Qe,{})})})]})]}),e.jsx(F,{children:e.jsxs(De,{width:"100%",isRequired:!0,children:[e.jsx(ve,{children:"Commit Message"}),e.jsx(As,{placeholder:"Enter Commit Message",resize:"vertical",onInput:d,value:i})]})})]})}function xt({openCommitModal:t}){const{setShowCommitView:a,selectedLocalChanges:o,sourceBranch:l,issueNumber:r,commitMessage:i,setSocketPayload:n,configurableRowData:u}=L(),{RaiseClientNotificaiton:f}=se(),d=s.useCallback(()=>{a(!1)},[a]),h=s.useCallback(()=>{if(!l||l.value===""){f("Please select the source branch to proceed!","error");return}if(!r||!i||r===""||i===""){f("Please provide the issue number and the commit message to proceed!","error");return}n({sourceBranch:u.find(b=>b.id==l.value),issueNumber:r,commitMessage:i,filesToProcess:o}),t()},[l,r,i,f,o,u]);return e.jsx(C,{children:e.jsxs(F,{columnGap:2,justifyContent:"center",children:[e.jsx(T,{onClick:d,leftIcon:e.jsx(ye,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(v,{label:"Select at least 1 file",hasArrow:!0,isDisabled:o.length>0,children:e.jsxs(T,{onClick:h,leftIcon:e.jsx(X,{as:$e}),colorScheme:"yellow",isDisabled:o.length<1,children:["Commit ",o.length>0?`${o.length} File`:"",o.length>1?"s":""]})})]})})}function bt(){const{selectedBranches:t,logData:a,setLogData:o}=L(),[l,r]=s.useState([]),[i,n]=s.useState(""),u=s.useCallback(h=>{n(h.target.value)},[n]),f=s.useCallback(()=>{o([])},[o]),d=a.length===t.length;return s.useEffect(()=>{if(a.length===0)return;const h=a.map(b=>b.logs).flat();r(b=>xe.isEqual(b,h)?b:h)},[a]),{rowDataLogs:l,quickFilterLogsText:i,setQuickFilterLogsText:n,onQuickFilterLogsInputChanged:u,refreshLogs:f,areLogsFetched:d}}function pt({rowDataLogs:t,quickFilterLogsText:a,setAutoFillSelection:o=null,isAutofill:l=!1}){const r=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=s.useMemo(()=>{const f=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return l?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...f]:f},[l]),n=s.useRef(null),u=s.useCallback(()=>{var f,d;if(o){const h=(d=(f=n==null?void 0:n.current)==null?void 0:f.api)==null?void 0:d.getSelectedNodes().map(b=>b.data);o(h[0]||null)}},[o]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:l?"90%":"85%",width:"100%"},children:e.jsx(ie,{ref:n,rowData:t,defaultColDef:r,columnDefs:i,onSelectionChanged:u,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!l,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function ss({setAutoFillSelection:t=!1,isAutofill:a=!1}){const{selectedBranches:o,logData:l}=L(),{rowDataLogs:r,quickFilterLogsText:i,onQuickFilterLogsInputChanged:n,refreshLogs:u,areLogsFetched:f}=bt();return f?e.jsxs(C,{h:"100%",children:[e.jsxs(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(E,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ae,{placeholder:"Type to search...",onInput:n,width:"100%"})]}),e.jsx(C,{children:e.jsx(v,{label:"Refresh",hasArrow:!0,children:e.jsx(W,{onClick:u,icon:e.jsx(ye,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(pt,{rowDataLogs:r,quickFilterLogsText:i,setAutoFillSelection:t,isAutofill:a})]}):e.jsxs(C,{children:[e.jsxs(C,{mb:4,children:[e.jsx(E,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Fe,{spacing:3,children:o.map(d=>{const h=l.find(b=>b.id===d.id);return e.jsxs(ne,{display:"flex",alignItems:"center",children:[e.jsx(le,{w:30,h:30,as:h?oe:Ls,color:"yellow.500"}),ke(d["Branch Folder"],d["Branch Version"],d["SVN Branch"])]},d.branchId)})})]}),e.jsx(F,{justifyContent:"center",children:e.jsx(Vs,{value:l.length/o.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Es,{children:[l.length," / ",o.length]})})})]})}function Ct(t){const{data:a}=t,o=async()=>{window.open(a.url,"_blank")};return e.jsx(W,{"aria-label":"Diff",size:"sm",icon:e.jsx(Ps,{}),onClick:o,colorScheme:"yellow"})}function wt({rowDataTrello:t,quickFilterTrelloText:a,setAutoFillSelection:o}){const l=s.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=s.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:Ct,width:120}],[]),i=s.useRef(null),n=s.useCallback(()=>{var f,d;const u=(d=(f=i==null?void 0:i.current)==null?void 0:f.api)==null?void 0:d.getSelectedNodes().map(h=>h.data);o(u[0]||null)},[o]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(ie,{ref:i,rowData:t,defaultColDef:l,columnDefs:r,onSelectionChanged:n,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function jt({setAutoFillSelection:t}){const{socket:a}=L(),{key:o,token:l,isTrelloIntegrationEnabled:r,emitTrelloCardNamesSearch:i}=es(),[n,u]=s.useState(""),[f,d]=s.useState(""),[h,b]=s.useState([]),y=s.useCallback(xe.debounce(x=>{x.trim()!==""&&i(o,l,x)},250),[o,l,i]),R=s.useCallback(x=>{u(String(x.target.value).trim())},[u]),N=s.useCallback(()=>{n.trim()!==""&&i(o,l,n)},[n,o,l,i]),p=s.useCallback(x=>{d(x.target.value)},[]);return s.useEffect(()=>(y(n),()=>y.cancel()),[n,y]),s.useEffect(()=>{const x=w=>{b(w&&w.length>0?w:[])};return a==null||a.on("trello-result-search-names-card",x),()=>a==null?void 0:a.off("trello-result-search-names-card",x)},[a]),r?e.jsxs(C,{h:"100%",children:[e.jsxs(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(E,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(ae,{placeholder:"Type to search...",onInput:R,width:"100%"})]}),e.jsx(C,{children:e.jsx(v,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(W,{onClick:N,icon:e.jsx(ye,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(F,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(F,{alignItems:"center",width:"100%",children:[e.jsx(E,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ae,{placeholder:"Type to search...",onInput:p,width:"100%"})]})}),e.jsx(wt,{rowDataTrello:h,quickFilterTrelloText:f,setAutoFillSelection:t})]}):e.jsx(C,{h:"100%",p:4,children:e.jsxs(E,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(We,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx(Qe,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function St({isModalOpen:t,closeModal:a}){const{setSourceBranch:o,branchOptions:l,setIssueNumber:r,setCommitMessage:i,setPostCommitData:n}=L(),[u,f]=s.useState(0),[d,h]=s.useState([null,null]),[b,y]=s.useState(!0),R=s.useCallback(w=>{f(w),h(w===0?S=>[S[0],null]:S=>[null,S[1]])},[f]),N=s.useCallback(w=>{h(S=>[w,...S.slice(1)])},[h]),p=s.useCallback(w=>{h(S=>[S[0],w])},[h]),x=s.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",u),console.debug("Selected autofill selection:",JSON.stringify(d,null,4));let w=d[u];if(u===0){const S=w.message,g=w.branchId,j=S.match(/\s*(Issue)*\s*(\d+)\s*/),D=j?j[2]:null,V=S.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");g&&o(l.find(H=>H.value===g)),D&&r(D),V.trim()!==""&&i(V)}else{const S=w.name,g=S.match(/\s*(Issue)*\s*(\d+)\s*/),j=g?g[2]:null,D=S.replace(/\s*(Issue)*\s*(\d+)/,"");j&&r(j),D.trim()!==""&&i(D),n({type:"trello",data:w})}a()},[u,d,a]);return s.useEffect(()=>{y(!(d.length==2&&(d[0]||d[1])))},[d]),s.useEffect(()=>{h([null,null])},[t]),e.jsxs(qe,{isOpen:t,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(be,{}),e.jsxs(Ge,{maxH:"95%",maxW:"95%",children:[e.jsx(pe,{children:e.jsx(ee,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(Be,{size:"lg"}),e.jsx(Ce,{children:e.jsx(C,{height:"70vh",children:e.jsxs(Ye,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:w=>R(w),children:[e.jsxs(Xe,{children:[e.jsx(me,{children:"SVN Logs"}),e.jsx(me,{children:"Trello"})]}),e.jsxs(Ke,{h:"90%",children:[e.jsx(ge,{px:0,pb:0,h:"100%",children:e.jsx(ss,{setAutoFillSelection:N,isAutofill:!0})}),e.jsx(ge,{px:0,pb:0,h:"100%",children:e.jsx(jt,{setAutoFillSelection:p})})]})]})})}),e.jsxs(Se,{children:[e.jsx(T,{mr:3,onClick:()=>a(),children:"Cancel"}),e.jsx(v,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!b,children:e.jsx(T,{colorScheme:"yellow",onClick:x,isDisabled:b,children:"Select"})})]})]})]})}function yt(){const{isDebug:t,setIsCommitMode:a,selectedBranchStatuses:o,showCommitView:l,setShowCommitView:r,selectedBranches:i,configurableRowData:n}=L(),[u,f]=s.useState({}),[d,h]=s.useState([]),[b,y]=s.useState([]),{isOpen:R,onOpen:N,onClose:p}=Te(),{isOpen:x,onOpen:w,onClose:S}=Te(),g=s.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);s.useEffect(()=>{if(i.length<1||l){i.length<1&&a(!1);return}f({})},[i,l]),s.useEffect(()=>{t&&(console.debug("Branch Status Rows:",o),console.debug("Selected Rows:",i))},[t,o,i]),s.useEffect(()=>{o.length===i.length&&(o.forEach(P=>{let z=P.id,O=P.status.filesToCommit,$=P.status.filesToUpdate;const k=n.find(M=>M.id===z);if($.length>0){const M=ke(k["Branch Folder"],k["Branch Version"],k["SVN Branch"]);f(U=>({...U,[M]:[...U[M]||[],...$]}))}if(O.length>0){const M=O.map(U=>({branchId:z,"Branch Folder":k["Branch Folder"],"Branch Version":k["Branch Version"],"SVN Branch":k["SVN Branch"],"Full Path":U.path,"File Path":`${Zs(P.status.branch)}\\${U.pathDisplay}`,"Local Status":U.wcStatus}));h(U=>[...U,...M.filter(Q=>!["unversioned","missing"].includes(Q["Local Status"]))]),y(U=>[...U,...M.filter(Q=>["unversioned","missing"].includes(Q["Local Status"]))])}}),r(!0))},[o,i,n]);const j=Object.keys(u).length>0,D=d.length>0,V=b.length>0,H=j||D||V;return e.jsxs(C,{children:[e.jsx(C,{mb:6,children:e.jsx(gt,{openMessageAutoFillModal:w})}),e.jsx(zs,{isLoaded:l&&H,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(Ye,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:j?0:D?1:2,isLazy:!1,children:[e.jsxs(Xe,{children:[e.jsx(me,{isDisabled:!j,children:e.jsx(v,{label:"No files to update!",hasArrow:!0,isDisabled:j,children:"Files to Update"})}),e.jsx(me,{isDisabled:!D,children:e.jsx(v,{label:"No files to commit!",hasArrow:!0,isDisabled:D,children:"Local Changes"})}),e.jsx(me,{isDisabled:!V,children:e.jsx(v,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:V,children:"Untracked Changes"})})]}),e.jsxs(Ke,{children:[e.jsx(ge,{px:0,children:e.jsx(ht,{fileUpdates:u})}),e.jsx(ge,{px:0,children:e.jsx(ut,{rowDataLocalChanges:d,setRowDataLocalChanges:h,defaultColDefsCommit:g})}),e.jsx(ge,{px:0,children:e.jsx(ft,{rowDataUntrackedChanges:b,setRowDataUntrackedChanges:y,defaultColDefsCommit:g})})]})]})}),l&&!H?e.jsx(E,{mt:4,className:"animation-pulse",fontWeight:600,children:"No changes have been spotted! Please use the refresh button ðŸ‘‡ if you have recently made a change"}):e.jsx(e.Fragment,{}),e.jsx(C,{mt:6,children:e.jsx(xt,{openCommitModal:N})}),e.jsx(dt,{isModalOpen:R,closeModal:p}),e.jsx(St,{isModalOpen:x,closeModal:S})]})}function Bt(){const{showSelectedBranchesLog:t,setShowSelectedBranchesLog:a}=L();return e.jsxs(Os,{isOpen:t,onClose:()=>a(!1),placement:"left",size:"full",children:[e.jsx(be,{}),e.jsxs(Us,{children:[e.jsx(Be,{size:"lg"}),e.jsx(pe,{children:"Selected Branches: SVN Log"}),e.jsx(Ce,{children:e.jsx(C,{height:"100%",children:e.jsx(ss,{})})})]})]})}function kt(){const{toast:t,RaiseClientNotificaiton:a}=se(),{isOpen:o,onOpen:l,onClose:r}=Te(),i=s.useRef(),[n,u]=s.useState(!1);s.useEffect(()=>{if(!window.electron){a("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{t.closeAll(),l()}),window.electron.on("update-error",h=>{a(`An error occurred while checking for updates: ${h}`,"error",5e3)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[t,l]);const f=s.useCallback(()=>{r(),a("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[r,a]),d=s.useCallback(()=>{if(n){a("Update is already in progress. Please wait.","info",5e3);return}window.electron?(u(!0),window.electron.downloadUpdate().catch(h=>{u(!1),a(`An error occurred while downloading the update: ${h}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{a("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),r()}),window.electron.on("update-not-available",()=>{a("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),r()})):a("Cannot update Titan in a non-desktop application environment","error",5e3)},[n,a,r]);return e.jsx(He,{isOpen:o,leastDestructiveRef:i,onClose:r,motionPreset:"slideInBottom",closeOnOverlayClick:!n,children:e.jsx(be,{children:e.jsxs(_e,{children:[e.jsx(pe,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),n?e.jsx(e.Fragment,{}):e.jsx(Be,{}),e.jsx(Ce,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(Se,{children:[e.jsx(T,{colorScheme:"red",ref:i,onClick:f,children:"Cancel"}),e.jsx(T,{colorScheme:"yellow",onClick:d,ml:3,isDisabled:n,children:"Confirm"})]})]})})})}function Dt(){if(!window.electron)return e.jsx(e.Fragment,{});const t=s.useCallback(()=>{window.electron.minimizeWindow()},[]),a=s.useCallback(()=>{window.electron.maximizeWindow()},[]),o=s.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Ws.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(F,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(ee,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(F,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(W,{"aria-label":"Minimize",size:"xs",icon:e.jsx(Hs,{}),onClick:t,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(W,{"aria-label":"Maximize",size:"xs",icon:e.jsx(_s,{}),onClick:a,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(W,{"aria-label":"Close",size:"xs",icon:e.jsx(Ie,{}),onClick:o,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function vt(){const{isCommitMode:t,selectedBranches:a,configurableRowData:o}=L(),{RaiseClientNotificaiton:l}=se();return s.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{l("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(C,{className:"titanBody",children:[e.jsx(Dt,{}),e.jsxs(C,{p:10,children:[e.jsx(lt,{}),e.jsx(kt,{}),e.jsxs(F,{rowGap:4,flexDirection:"column",children:[e.jsx(C,{children:e.jsx(ct,{})}),e.jsx($s,{in:t,animateOpacity:!0,children:e.jsxs(C,{id:"sectionCommit",children:[e.jsxs(ee,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",a.length==o.length?"All":`${a.length}/${o.length}`," Branch",a.length==1?"":"es"]}),e.jsx(yt,{})]})})]}),e.jsx(Bt,{})]})]})}const{definePartsStyle:ts,defineMultiStyleConfig:ns}=Xs(Ks.keys),Rt=ts({dialog:{mt:`${st+20}px`,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),It=ns({baseStyle:Rt}),Ft=ts({dialog:{mt:tt,bg:"gray.900",color:"white",boxShadow:"-1px 8px 17px 7px rgba(255, 255, 255, 0.07)"},header:{bg:"gray.900",color:"white",borderRadius:"20px"},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),Tt=ns({baseStyle:Ft}),Nt={initialColorMode:"dark",useSystemColorMode:!1},Ue=qs({config:Nt,components:{Modal:It,Drawer:Tt}});Gs.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsxs(Qs,{theme:Ue,children:[e.jsx(Ys,{initialColorMode:Ue.config.initialColorMode}),e.jsx(nt,{children:e.jsx(vt,{})})]})}));
