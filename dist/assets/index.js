import{r as t,u as rs,l as is,R as Te,j as e,W as Ve,d as Me,L as He,I as cs,H as J,T as I,e as H,f as K,M as ds,g as hs,h as us,i as fs,A as $e,k as pe,m as qe,n as Ce,o as we,p as ke,B as A,D as ms,C as Fe,F as R,q as De,s as gs,t as _e,v as xs,w as bs,x as Ie,S as ps,V as Cs,y as Ee,z as ws,E as Ge,G as Qe,J as js,K as Ss,N as Bs,O as ys,P as ks,Q as Pe,U as x,X as Ds,Y as vs,Z as ve,_ as z,$ as Re,a0 as le,a1 as ae,a2 as oe,a3 as se,a4 as Fs,a5 as Ye,a6 as re,a7 as Is,a8 as Rs,a9 as Ns,aa as ze,ab as je,ac as Ts,ad as Se,ae as ie,af as Be,ag as ye,ah as Vs,ai as Ls,aj as Xe,ak as As,al as Ms,am as Es,an as Ps,ao as Ke,ap as Je,aq as ge,ar as Ze,as as xe,at as zs,au as Ne,av as Os,aw as Us,ax as Ws,ay as Hs,az as $s,aA as qs,aB as _s,aC as Gs,aD as Qs,aE as Ys,aF as Xs,aG as Ks,aH as Js}from"./vendor.js";import{_ as Y}from"./lodash.js";import{A as de}from"./ag-grid-react.js";import"./ag-grid-community.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const Zs="/assets/Titan.png";function ce(s=[]){return(Array.isArray(s)?s:[s]).map(o=>(delete o["Branch Info"],o))}function be(s,a,o){return`${s==""?"Uncategorised":s} ${a==""?"Unversioned":a} ${String(o).split("\\").at(-1)}`}function et(s){return String(s).split("\\").at(-1)}const st="http://localhost:4000",tt="40px";function me(s,a="info",o=3e3,n=!1){return{position:"top",variant:"solid",title:n?"Server Notification":"Client Notification",description:s,status:a,duration:o,isClosable:!0}}const es=t.createContext({socket:null,toast:null,config:null,updateConfig:s=>{},isDebug:!1,setIsDebug:s=>{},configurableRowData:[],setConfigurableRowData:s=>{},branchInfos:{},setBranchInfos:s=>{},branchTableGridRef:null,selectedBranches:[],setSelectedBranches:s=>{},showSelectedBranchesLog:!1,setShowSelectedBranchesLog:s=>{},isCommitMode:!1,setIsCommitMode:s=>{},selectedBranchStatuses:[],setSelectedBranchStatuses:s=>{},localChangesGridRef:null,untrackedChangesGridRef:null,showCommitView:!1,setShowCommitView:s=>{},sourceBranch:null,setSourceBranch:s=>{},branchOptions:[],issueNumber:null,setIssueNumber:s=>{},commitMessage:"",setCommitMessage:s=>{},selectedLocalChanges:[],setSelectedLocalChanges:s=>{},selectedUntrackedChanges:[],setSelectedUntrackedChanges:s=>{},socketPayload:null,setSocketPayload:s=>{},postCommitData:{},setPostCommitData:s=>{},logData:[],setLogData:s=>{}}),T=()=>t.useContext(es),nt=({children:s})=>{const[a,o]=t.useState(null),[n,i]=t.useState(null),r=rs(),[l,d]=t.useState(localStorage.getItem("isDebug")==="true");t.useEffect(()=>{const f=is(st);return i(f),f.on("connect",()=>{f.emit("titan-config-get","fetch"),f.once("titan-config-get",L=>{o(L),r(me("Configurations Loaded","success",2e3))})}),f.on("notification",L=>{r(me(L.description,L.status,L.duration,!0))}),f.on("disconnect",()=>{r(me("Server Has Been Disconnected","warning",0,!0))}),f.on("reconnect",()=>{r(me("Server Has Been Reconnected","success",2e3,!0))}),()=>{f.disconnect()}},[]),t.useEffect(()=>{localStorage.setItem("isDebug",String(l))},[l]);const m=t.useCallback(f=>{f!=null&&(console.log("Saving config:",f),n==null||n.emit("titan-config-set",f))},[n]),c=t.useCallback(f=>{o(L=>{const _=f(L);return Y.isEqual(L,_)?L:(m(_),_)})},[o,m]),[u,b]=t.useState([]),[j,k]=t.useState({}),M=t.useRef(null),[p,C]=t.useState([]),[S,w]=t.useState(!1),[g,B]=t.useState(!1),[v,V]=t.useState([]),U=t.useRef(null),E=t.useRef(null),[F,O]=t.useState(!1),[$,D]=t.useState(null),P=t.useMemo(()=>a&&a.commitOptions&&a.commitOptions.useIssuePerFolder?p.filter(f=>f["Branch Folder"]&&f["Branch Version"]&&f["SVN Branch"]&&f["Branch Folder"]!==""&&f["Branch Version"]!==""&&f["SVN Branch"]!=="").map(f=>({value:f.id,label:be(f["Branch Folder"],f["Branch Version"],f["SVN Branch"])})):u.filter(f=>f["Branch Folder"]&&f["Branch Version"]&&f["SVN Branch"]&&f["Branch Folder"]!==""&&f["Branch Version"]!==""&&f["SVN Branch"]!=="").map(f=>({value:f.id,label:be(f["Branch Folder"],f["Branch Version"],f["SVN Branch"])})),[a,p,u]),[W,Q]=t.useState(null),[X,Z]=t.useState(""),[ee,ue]=t.useState([]),[y,h]=t.useState([]),[N,G]=t.useState(null),[fe,Le]=t.useState({}),[ne,q]=Te.useState([]);return t.useEffect(()=>{V([]),O(!1)},[u]),t.useEffect(()=>{if(!g||!F)return;const f=setTimeout(()=>{var L;(L=document.getElementById("sectionCommit"))==null||L.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);return()=>clearTimeout(f)},[g,F]),t.useEffect(()=>{if(p.length<1||F){p.length<1&&B(!1);return}V([]),G(null),ce(p).forEach(f=>{console.debug("Emitting svn-status-single for branch:",f),n==null||n.emit("svn-status-single",{selectedBranch:f})})},[n,p,F]),t.useEffect(()=>{const f=()=>{O(!1)};return n==null||n.on("branch-refresh-unseen",f),()=>n==null?void 0:n.off("branch-refresh-unseen",f)},[n]),t.useEffect(()=>{const f=L=>{l&&console.debug("Received branch status data:",L),V(_=>[..._,L])};return n==null||n.on("branch-status-single",f),()=>n==null?void 0:n.off("branch-status-single",f)},[n]),t.useEffect(()=>{q([])},[p]),t.useEffect(()=>{ne.length===0&&n&&C(f=>(f.length>0&&n.emit("svn-log-selected",{selectedBranches:p}),f))},[ne,n]),t.useEffect(()=>{const f=L=>{console.debug("Received svn-log-result from socket in SectionBranchLog component in background"),q(_=>_.some(os=>os.id===L.id)?_:[..._,L])};return n==null||n.on("svn-log-result",f),()=>n==null?void 0:n.off("svn-log-result",f)},[n]),e.jsx(es.Provider,{value:{socket:n,toast:r,config:a,updateConfig:c,isDebug:l,setIsDebug:d,configurableRowData:u,setConfigurableRowData:b,branchInfos:j,setBranchInfos:k,branchTableGridRef:M,selectedBranches:p,setSelectedBranches:C,showSelectedBranchesLog:S,setShowSelectedBranchesLog:w,isCommitMode:g,setIsCommitMode:B,selectedBranchStatuses:v,setSelectedBranchStatuses:V,localChangesGridRef:U,untrackedChangesGridRef:E,showCommitView:F,setShowCommitView:O,sourceBranch:$,setSourceBranch:D,branchOptions:P,issueNumber:W,setIssueNumber:Q,commitMessage:X,setCommitMessage:Z,selectedLocalChanges:ee,setSelectedLocalChanges:ue,selectedUntrackedChanges:y,setSelectedUntrackedChanges:h,socketPayload:N,setSocketPayload:G,postCommitData:fe,setPostCommitData:Le,logData:ne,setLogData:q},children:s})};function he(){const{socket:s}=T(),a=t.useCallback(()=>{s==null||s.emit("titan-config-open",{})},[s]),o=t.useCallback((c,u,b,j)=>{s==null||s.emit("svn-update-single",{id:c,branch:u,version:b,folder:j})},[s]),n=t.useCallback((c,u,b,j)=>{s==null||s.emit("svn-info-single",{id:c,branch:u,version:b,folder:j})},[s]),i=t.useCallback(c=>{s==null||s.emit("svn-commit",c)},[s]),r=t.useCallback(c=>{s==null||s.emit("svn-files-revert",{filesToProcess:c})},[s]),l=t.useCallback(c=>{s==null||s.emit("svn-files-add-remove",{filesToProcess:c})},[s]),d=t.useCallback((c,u,b,j=null)=>{s==null||s.emit("trello-search-names-card",{key:c,token:u,query:b,limit:j})},[s]),m=t.useCallback((c,u,b,j)=>{s==null||s.emit("trello-update-card",{key:c,token:u,trelloData:b,commitResponses:j})},[s]);return{emitOpenConfig:a,emitUpdateSingle:o,emitInfoSingle:n,emitCommitPayload:i,emitFilesRevert:r,emitFilesAddRemove:l,emitTrelloCardNamesSearch:d,emitTrelloCardUpdate:m}}function te(){const{toast:s}=T(),a=t.useCallback((o="",n="info",i=3e3,r=null)=>{const l=me(o,n,i);if(s)return s(l);if(r)return r(l)},[s]);return{toast:s,RaiseClientNotificaiton:a}}function lt(){const{config:s,isDebug:a,setIsDebug:o}=T(),{emitOpenConfig:n}=he(),{RaiseClientNotificaiton:i}=te(),r=t.useCallback(()=>{window.electron.checkForUpdates().then(d=>{console.debug("Check for updates result: ",d)}),window.electron.on("update-not-available",()=>{i("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available")})},[i]),l=t.useCallback(()=>{window.electron&&window.electron.getAppVersion().then(d=>{i(`Application Version: v${d}`,"info",2e3)})},[i]);return e.jsxs(Ve,{my:5,spacingY:5,justify:"space-between",children:[e.jsxs(Me,{alignItems:"center",children:[e.jsx(He,{onClick:l,children:e.jsx(cs,{src:Zs,alt:"Titan Logo",boxSize:"100px",mr:5,borderRadius:"full"})}),e.jsx(J,{as:"h2",size:"2xl",noOfLines:1,className:"animation-fadein-forward",children:"Welcome back"}),e.jsx(J,{as:"h2",size:"2xl",noOfLines:1,p:2,className:"animation-handwave",children:"ðŸ‘‹"})]}),e.jsxs(Me,{alignItems:"center",columnGap:2,children:[e.jsx(I,{label:`Current Debug Mode: ${a?"on":"off"}`,hasArrow:!0,placement:"left",children:e.jsx(H,{"aria-label":"Toggle Debug Mode",colorScheme:"yellow",icon:a?e.jsx(K,{as:hs}):e.jsx(K,{as:ds}),onClick:()=>o(d=>!d)})}),e.jsx(I,{label:"Open configuration file",hasArrow:!0,placement:"bottom-start",children:e.jsx(H,{"aria-label":"Open configuration file",colorScheme:"yellow",icon:e.jsx(K,{as:us}),onClick:()=>n()})}),e.jsx(I,{label:"Check for updates",hasArrow:!0,placement:"bottom-start",isDisabled:!window.electron,children:e.jsx(H,{"aria-label":"Check for updates",colorScheme:"yellow",icon:e.jsx(K,{as:fs}),onClick:r,isDisabled:!window.electron})})]})]})}function at({isAlertOpen:s,onCloseAlert:a,cancelRef:o,removeSelectedRows:n}){return e.jsx($e,{isOpen:s,leastDestructiveRef:o,onClose:a,children:e.jsx(pe,{children:e.jsxs(qe,{children:[e.jsx(Ce,{fontSize:"lg",fontWeight:"bold",children:"Delete Selected Rows"}),e.jsx(we,{children:"Are you sure you want to delete the selected rows? This action cannot be undone."}),e.jsxs(ke,{children:[e.jsx(A,{ref:o,onClick:a,children:"Cancel"}),e.jsx(A,{colorScheme:"red",onClick:n,ml:3,children:"Delete"})]})]})})})}function Oe(){const{innerWidth:s,innerHeight:a}=window;return{width:s,height:a}}function ot(){const[s,a]=t.useState(Oe());return t.useEffect(()=>{function o(){a(Oe())}return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),s}function rt({rowData:s,onRowValueChanged:a}){const{config:o,branchTableGridRef:n,updateConfig:i,isDebug:r,selectedBranches:l,setSelectedBranches:d,setSelectedBranchStatuses:m,setShowCommitView:c}=T(),u=ot(),[b,j]=t.useState(u.height>768),k=t.useCallback(g=>{const B={...g,id:String(Date.now()),"Branch Info":"Hasn't been refreshed"};i(v=>({...v,branches:ce([...v.branches,B])}))},[i]),M=t.useCallback(g=>{var v,V,U,E;const B=(V=(v=n==null?void 0:n.current)==null?void 0:v.api)==null?void 0:V.getSelectedNodes().map(F=>F.data);if(r&&console.log("SectionBranches.jsx: onSelectionChanged - event",g),r&&console.log("SectionBranches.jsx: onSelectionChanged - selectedBranches",l),(g==null?void 0:g.source)=="rowDataChanged"){const F=l.map(O=>O.id);(E=(U=n==null?void 0:n.current)==null?void 0:U.api)==null||E.forEachNode(O=>{F.includes(O.data.id)&&O.setSelected(!0)});return}else["api"].includes(g==null?void 0:g.source)||(d(B),m([]),c(!1))},[r,n,l,d,c]),p=t.useCallback(g=>{const B=[];g.api.forEachNode(v=>B.push(v.data)),r&&console.debug("SectionBranches.jsx: onRowDragEnd - movedRowData",B),i(v=>({...v,branches:ce(B)}))},[i,r]),C=t.useCallback(g=>{const B=o==null?void 0:o.branchFolderColours[g.data["Branch Folder"]];return{backgroundColor:B?`${B}20`:"transparent"}},[o==null?void 0:o.branchFolderColours]),S=t.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!0,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),w=t.useMemo(()=>{const g=[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{headerName:"",width:60,resizable:!1,sortable:!1,filter:!1,editable:!1,cellRenderer:B=>e.jsx(I,{label:"Copy Row",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Copy Row",size:"sm",onClick:()=>k(B.data),icon:e.jsx(Fe,{})})})},{field:"Branch Folder",resizable:!1,width:130,valueFormatter:B=>B.value.toUpperCase()},{field:"Branch Version",resizable:!1,width:130},{field:"SVN Branch",flex:1},{field:"Branch Info",editable:!1,resizable:!1,width:200}];return b?[{field:"",rowDrag:!0,resizable:!1,filter:!1,suppressMovable:!1,editable:!1,width:20,cellRenderer:ms,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...g]:g},[o,b,k]);return t.useEffect(()=>{j(u.height>768)},[u]),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:b?"auto":"428px",width:"100%"},children:e.jsx(de,{ref:n,rowData:s,defaultColDef:S,columnDefs:w,stopEditingWhenCellsLoseFocus:!0,getRowStyle:C,onRowDragEnd:p,domLayout:b?"autoHeight":"normal",suppressRowClickSelection:!0,rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,rowDragManaged:!0,onSelectionChanged:M,onRowValueChanged:a,columnMenu:"new",editType:"fullRow",deltaRowDataMode:!0,getRowNodeId:g=>g.id,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!b,paginationAutoPageSize:!1,paginationPageSizeSelector:!1,paginationPageSize:10})})}function it(){const{updateConfig:s,isDebug:a,socket:o,configurableRowData:n,setConfigurableRowData:i,branchInfos:r,config:l,setBranchInfos:d,setSelectedBranches:m,setSelectedBranchStatuses:c,showCommitView:u,setShowCommitView:b}=T(),[j,k]=t.useState([]),M=t.useCallback(p=>{a&&console.log("AG Grid: onRowValueChanged - event",p),a&&console.log("AG Grid: onRowValueChanged - rowDataBranches",j),s(C=>({...C,branches:ce(j)}))},[j,s,a]);return t.useEffect(()=>{const p=Y.debounce(()=>{const C=n.map(S=>({...S,"Branch Info":r[S.id]||"Hasn't been refreshed"}));k(S=>Y.isEqual(C,S)?S:C)},300);return p(),()=>p.cancel()},[n,r]),t.useEffect(()=>{i(p=>l&&l.branches&&!Y.isEqual(l.branches,p)?l.branches:p)},[l]),t.useEffect(()=>{const p=C=>{d(S=>{const w={...S,[C.id]:C.info};return console.debug("branch-info-single data received:",C),console.debug("branch-info-single newBranchInfos",w),m(g=>(g.find(v=>v.id===C.id)&&u&&(c([]),b(!1)),g)),w})};return o==null||o.on("branch-info-single",p),()=>o==null?void 0:o.off("branch-info-single")},[o,u]),{rowDataBranches:j,setRowDataBranches:k,onRowValueChanged:M}}function ct(){const{socket:s,updateConfig:a,isDebug:o,setShowSelectedBranchesLog:n,configurableRowData:i,branchTableGridRef:r,selectedBranches:l,setSelectedBranches:d,isCommitMode:m,setIsCommitMode:c,setSelectedBranchStatuses:u,setShowCommitView:b}=T(),{emitUpdateSingle:j,emitInfoSingle:k}=he(),{RaiseClientNotificaiton:M}=te(),[p,C]=t.useState(!1),S=t.useRef(),w=()=>C(!1),{rowDataBranches:g,setRowDataBranches:B,onRowValueChanged:v}=it(),[V,U]=t.useState(0),[E,F]=t.useState([]),O=t.useCallback(()=>{var y,h;o&&console.log("SectionBranches.jsx: clearSelection: START"),(h=(y=r==null?void 0:r.current)==null?void 0:y.api)==null||h.deselectAll(),d([]),c(!1)},[o,r,d]),$=t.useCallback(()=>{var h,N;const y=(N=(h=r==null?void 0:r.current)==null?void 0:h.api)==null?void 0:N.getSelectedNodes().map(G=>G.data);d(y),C(!0)},[r,d]),D=t.useCallback(()=>{const y={id:String(Date.now()),"Branch Folder":"","Branch Version":"","SVN Branch":"","Branch Info":""};a(h=>({...h,branches:ce([...h.branches,y])}))},[a]),P=t.useCallback(()=>{l.forEach(y=>{j(y.id,y["SVN Branch"],y["Branch Version"],y["Branch Folder"])})},[l,j]),W=t.useCallback(()=>{E.forEach(y=>{j(y.id,y["SVN Branch"],y["Branch Version"],y["Branch Folder"])})},[E,j]),Q=t.useCallback(()=>{const y=l.map(N=>N.id),h=g.filter(N=>!y.includes(N.id));console.log("SectionBranches.jsx: removeSelectedRows - updatedData",h),a(N=>({...N,branches:ce(h)})),O(),w()},[l,g,a]),X=t.useCallback(()=>{n(!0)},[]),Z=t.useCallback(()=>{B(y=>{const h=[...y];return l.forEach(N=>{const G=h.findIndex(fe=>fe.id===N.id);h[G]["Branch Info"]="Refreshing..."}),h}),l.forEach(y=>{k(y.id,y["SVN Branch"],y["Branch Version"],y["Branch Folder"])})},[l,k]),ee=t.useCallback(()=>{if(m){M("Unable to refresh branches while in commit mode","warning",0);return}M("Refreshing all branches. Please wait until this is done!","info",3e3);const y=Date.now();i.forEach(h=>{k(h.id,h["SVN Branch"],h["Branch Version"],h["Branch Folder"])}),U(y)},[i,k,M,m]),ue=t.useCallback(()=>{c(y=>!y),b(!1)},[c]);return t.useEffect(()=>{const y=g.filter(h=>String(h["Branch Info"]).toLowerCase().includes("behind"));F(y)},[g]),t.useEffect(()=>{const h=Date.now();if(i.length>0){h-V>3e5&&ee();const N=setInterval(()=>{ee()},3e5);return()=>clearInterval(N)}},[i,V,ee]),t.useEffect(()=>{const y=h=>{o&&console.debug("branch-success-single data received:",h),k(h.id,h.branch,h.version,h.folder)};return s==null||s.on("branch-success-single",y),()=>s==null?void 0:s.off("branch-success-single",y)},[o,s,k]),e.jsxs("div",{children:[e.jsxs(Ve,{mb:4,justify:"space-between",children:[e.jsxs(R,{columnGap:2,children:[e.jsx(I,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(A,{onClick:Z,leftIcon:e.jsx(De,{}),colorScheme:"yellow",isDisabled:l.length<1,children:["Refresh ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(I,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(A,{onClick:P,leftIcon:e.jsx(K,{as:gs}),colorScheme:"yellow",isDisabled:l.length<1,children:["Update ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(I,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsx(A,{onClick:ue,leftIcon:e.jsx(K,{as:_e}),colorScheme:"yellow",isDisabled:l.length<1,children:m?"Undo Commit":"Commit"})}),e.jsx(I,{label:"Requires at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsx(A,{onClick:X,leftIcon:e.jsx(xs,{}),colorScheme:"yellow",isDisabled:l.length<1,children:"View Logs"})})]}),e.jsx(R,{columnGap:2,children:e.jsx(I,{label:"No outdated branches to update",isDisabled:E.length>0,hasArrow:!0,children:e.jsx(A,{onClick:W,leftIcon:e.jsx(bs,{}),colorScheme:"yellow",isDisabled:E.length<1,children:"Update Outdated"})})})]}),e.jsx(rt,{rowData:g,onRowValueChanged:v}),e.jsxs(R,{columnGap:2,mt:4,children:[e.jsx(I,{label:"Please select at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(A,{onClick:O,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:l.length<1,children:["Deselect ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(I,{label:"Please select at least 1 branch",isDisabled:l.length>0,hasArrow:!0,children:e.jsxs(A,{onClick:$,leftIcon:e.jsx(Ie,{}),colorScheme:"red",isDisabled:l.length<1,children:["Delete ",l.length>0?`${l.length} Branch`:"",l.length>1?"es":""]})}),e.jsx(A,{onClick:D,leftIcon:e.jsx(ps,{boxSize:8}),colorScheme:"green",children:"New Row"})]}),e.jsx(at,{isAlertOpen:p,onCloseAlert:w,cancelRef:S,removeSelectedRows:Q})]})}function ss(s){const{data:a,onDiffResult:o}=s,n=async()=>{try{const i=await window.electron.openTortoiseSVNDiff({fullPath:a["Full Path"],branchFolder:a["Branch Folder"],branchVersion:a["Branch Version"]});o(i)}catch(i){o({success:!1,error:i.message})}};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(Cs,{}),onClick:n,colorScheme:"yellow"})}function ts(){const{config:s}=T(),{emitTrelloCardNamesSearch:a,emitTrelloCardUpdate:o}=he(),n=s==null?void 0:s.trelloIntegration,i=(n==null?void 0:n.key)||null,r=(n==null?void 0:n.token)||null,l=i&&r&&i.trim()!==""&&r.trim()!==""&&i.toUpperCase()!=="TRELLO_API_KEY"&&r.toUpperCase!=="TRELLO_TOKEN";return{key:i,token:r,isTrelloIntegrationEnabled:l,emitTrelloCardNamesSearch:a,emitTrelloCardUpdate:o}}function dt({isModalOpen:s,closeModal:a}){const{socket:o,setIsCommitMode:n,setSelectedBranchStatuses:i,setShowCommitView:r,socketPayload:l,postCommitData:d,setPostCommitData:m}=T(),{emitUpdateSingle:c,emitCommitPayload:u}=he(),{key:b,token:j,isTrelloIntegrationEnabled:k,emitTrelloCardUpdate:M}=ts(),{RaiseClientNotificaiton:p}=te(),[C,S]=t.useState([]),{onCopy:w,value:g,setValue:B,hasCopied:v}=Ee(""),{onCopy:V,value:U,setValue:E,hasCopied:F}=Ee(""),O=t.useCallback(h=>{h.success?p("TortoiseSVN diff opened successfully","success",3e3):p(`Error opening TortoiseSVN diff: ${JSON.stringify(h.error,null,4)}`,"error",0)},[p]),$=[{title:"Review",description:"Confirm SVN changes"},{title:"Commit",description:"Commit changes"},{title:"Complete",description:"Process Completed"}],{activeStep:D,setActiveStep:P}=ws({index:1,count:$.length}),W=t.useMemo(()=>({resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),Q=t.useMemo(()=>[{field:"Branch Folder"},{field:"Branch Version",sort:"asc"},{field:"File Path",flex:1},{field:"Local Status",headerTooltip:"Working Copy"},{headerName:"Diff",filter:!1,sortable:!1,cellRenderer:ss,cellRendererParams:{onDiffResult:O},width:90}],[]),X=t.useCallback((h,N=!0)=>{const G="â€‹".repeat(7),fe=h.includes("MarkupSupport")?`\r
${G}`:`\r
`,ne=C.sort((q,f)=>q["Branch Version"].localeCompare(f["Branch Version"])).map(q=>{const f=[];h.includes("BranchFolder")&&f.push(q["Branch Folder"]),h.includes("BranchVersion")&&f.push(q["Branch Version"]),h.includes("SVNBranch")&&f.push(q.branchPathFolder);let L=f.join(" ").trim();if(h.includes("IssueNumber")){const Ae=q["Branch Folder"]===l.sourceBranch["Branch Folder"]?l.issueNumber:"XXXXXX";L+=` Issue [${Ae}]`}const _=q.revision?q.revision:q.errorMessage||"Error";return L+=` Revision [${_}]`,L});return N?ne.join(fe):ne},[C,l]),Z=t.useCallback(h=>{const N=X(h);B(N)},[X,B]),ee=t.useCallback(()=>{P(h=>h-1)},[P]),ue=t.useCallback(()=>{if(d.type!=="trello"){p("Trello Autofill is not enabled for this commit","error");return}const h=d.data,N=X(["BranchFolder","BranchVersion","IssueNumber"],!1);M(b,j,h,N),p("Updating Trello card with commit information","info"),m(null)},[d,p,X]),y=t.useCallback(()=>{P(h=>h+1)},[P]);return t.useEffect(()=>{P(1),S([]),B(""),E("")},[s,S]),t.useEffect(()=>{!s||D!=0||(a(),P(1),S([]),B(""),E(""))},[D,s]),t.useEffect(()=>{!s||D!=2||u(l)},[D,s,u,l]),t.useEffect(()=>{!s||D!=3||(p("The commit process has been completed successfully","success",5e3),Z(["BranchFolder","BranchVersion","SVNBranch"]),E(l.commitMessage||""))},[p,D,s,Z]),t.useEffect(()=>{!s||D<=3||(w(),p("Updating selected branches! Please wait","info",1500),C.forEach(h=>{c(h.branchId,h["SVN Branch"],h["Branch Version"],h["Branch Folder"])}),n(!1),i([]),r(!1),a(),P(1))},[p,D,s,C,c]),t.useEffect(()=>{const h=N=>{S(G=>[...G,N])};return o==null||o.on("svn-commit-status-live",h),()=>o==null?void 0:o.off("svn-commit-status-live",h)},[o]),t.useEffect(()=>{if(D!=2)return;const h=setTimeout(()=>{C.length>0&&C[0].bulkCommitLength==C.length&&P(3)},3e3);return()=>clearTimeout(h)},[D,C]),t.useEffect(()=>{(v||F)&&p("Copied to Clipboard","success",1500)},[v,F,p]),!s||!l?e.jsx(e.Fragment,{}):e.jsxs(Ge,{isOpen:s,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:D==1,children:[e.jsx(pe,{}),e.jsxs(Qe,{maxH:"85%",maxW:"95%",children:[e.jsxs(Ce,{display:"flex",justifyContent:"space-between",maxWidth:D==1?"94%":"100%",children:[e.jsx(J,{as:"h2",size:"lg",children:"Commit Selected Files"}),e.jsx(js,{index:D-1,mb:0,size:"sm",colorScheme:"yellow",children:$.map((h,N)=>e.jsxs(Ss,{children:[e.jsx(Bs,{children:e.jsx(ys,{complete:e.jsx(ks,{}),incomplete:e.jsx(Pe,{}),active:e.jsx(Pe,{})})}),e.jsx(x,{flexShrink:"0",children:e.jsx(Ds,{children:h.title})}),e.jsx(vs,{})]},N))})]}),D==1?e.jsx(ve,{size:"lg",py:6}):e.jsx(e.Fragment,{}),e.jsx(we,{children:e.jsxs(x,{children:[D!=1?e.jsx(e.Fragment,{}):e.jsxs(x,{children:[e.jsxs(x,{mb:4,children:[e.jsx(z,{fontWeight:600,children:"Please confirm that the following information is correct before proceeding to commit your files:"}),e.jsxs(Re,{spacing:3,children:[e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Source Branch: ",e.jsx(se,{children:be(l.sourceBranch["Branch Folder"],l.sourceBranch["Branch Version"],l.sourceBranch["SVN Branch"])})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Issue Number: ",e.jsx(se,{children:l.issueNumber})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Commit Message: ",e.jsx(se,{children:l.commitMessage})]}),e.jsxs(le,{children:[e.jsx(ae,{as:oe,color:"yellow.500"}),"Example:"," ",e.jsxs(se,{children:["Issue ",l.issueNumber," (",l.sourceBranch["Branch Folder"]," ",l.sourceBranch["Branch Version"],"): ",l.commitMessage]})]})]})]}),e.jsx(x,{children:e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"350px",width:"100%"},children:e.jsx(de,{rowData:l.filesToProcess,defaultColDef:W,columnDefs:Q,domLayout:"normal",columnMenu:"new",pagination:!0,paginationAutoPageSize:!0})})})]}),D!=2?e.jsx(e.Fragment,{}):e.jsxs(x,{children:[e.jsxs(z,{fontWeight:600,children:["Please wait while the files are being committed to the SVN repository.",e.jsx("br",{}),"Current live status of the commit process:"]}),e.jsx(x,{children:e.jsx(Re,{spacing:3,children:C.map((h,N)=>e.jsxs(le,{children:[e.jsx(ae,{as:h.errorMessage?Fs:oe,color:h.errorMessage?"red.500":"yellow.500"}),h.branchString,":Â ",e.jsx(se,{children:h.errorMessage||h.revision})]},N))})})]}),D!=3?e.jsx(e.Fragment,{}):e.jsxs(x,{children:[e.jsx(x,{mb:4,children:e.jsxs(z,{fontWeight:600,children:["The commit process has been completed successfully.",e.jsx("br",{}),"Please find your revisions here for view and copy:"]})}),e.jsxs(R,{columnGap:10,alignItems:"center",children:[e.jsxs(x,{children:[e.jsx(J,{as:"h3",size:"md",children:"SVN Revisions"}),e.jsx(x,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:g})})]}),e.jsx(x,{children:e.jsx(I,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:w,icon:e.jsx(Fe,{}),colorScheme:"yellow"})})})]}),e.jsxs(x,{my:4,children:[e.jsx(z,{fontWeight:600,children:"Modify the clipboard text to include..."}),e.jsx(Ye,{colorScheme:"yellow",defaultValue:["BranchFolder","BranchVersion"],onChange:Z,children:e.jsxs(Ve,{children:[e.jsx(re,{value:"BranchFolder",children:"Branch Folder"}),e.jsx(re,{value:"BranchVersion",children:"Branch Version"}),e.jsx(re,{value:"SVNBranch",children:"SVN Branch"}),e.jsx(re,{value:"IssueNumber",children:"Issue Number"}),e.jsx(re,{value:"MarkupSupport",children:"Markup Support"})]})})]}),e.jsxs(R,{columnGap:10,alignItems:"center",children:[e.jsxs(x,{children:[e.jsx(z,{fontWeight:600,children:"Here is your SVN commit message for the source branch:"}),l.sourceBranch&&l.sourceBranch["Branch Folder"]&&l.sourceBranch["Branch Version"]?e.jsx(se,{children:`Issue ${l.issueNumber} (${l.sourceBranch["Branch Folder"]} ${l.sourceBranch["Branch Version"]}): ${U}`}):e.jsx(se,{children:"Source information is undefined. Please check that you have entered the correct details otherwise contact the developer!"})]}),e.jsx(I,{hasArrow:!0,label:"Copy to clipboard",children:e.jsx(H,{"aria-label":"Copy To Clipboard",onClick:V,icon:e.jsx(Fe,{}),colorScheme:"yellow"})})]})]})]})}),e.jsx(ke,{children:e.jsxs(R,{flex:1,justifyContent:"space-between",children:[e.jsx(R,{columnGap:2,children:e.jsx(I,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:D<2,children:e.jsx(A,{onClick:ee,mr:3,isDisabled:D>=2,children:D==1?"Cancel":"Previous"})})}),e.jsxs(R,{columnGap:2,children:[e.jsx(I,{hasArrow:!0,label:"Requires Trello Autofill",isDisabled:(d==null?void 0:d.type)==="trello"&&k,children:e.jsx(A,{colorScheme:"yellow",leftIcon:e.jsx(K,{as:Is}),onClick:ue,isDisabled:D<3||(d==null?void 0:d.type)!="trello"||!k,children:"Update Card"})}),e.jsx(I,{hasArrow:!0,label:"Cannot undo the commit currently",isDisabled:D!=2,children:e.jsx(A,{colorScheme:"yellow",onClick:y,isDisabled:D==2,children:D==$.length?"Complete":"Next"})})]})]})})]})]})}function ht({fileUpdates:s}){return e.jsx(x,{children:Object.keys(s).length>0?e.jsxs(x,{children:[e.jsx(z,{mb:4,children:"Below are the list of files which have been changed on your machine but there exists a newer version of them in the repository:"}),e.jsx(x,{maxHeight:"200px",overflowY:"auto",children:e.jsxs(Rs,{children:[e.jsx(Ns,{children:e.jsxs(ze,{children:[e.jsx(je,{children:"Branch"}),e.jsx(je,{children:"Path"}),e.jsx(je,{children:e.jsx(I,{label:"Working Copy",hasArrow:!0,children:"Local Status"})}),e.jsx(je,{children:e.jsx(I,{label:"Repository",hasArrow:!0,children:"Remote Status"})})]})}),e.jsx(Ts,{children:Object.keys(s).map(a=>e.jsx(Te.Fragment,{children:s[a].map((o,n)=>e.jsxs(ze,{children:[e.jsx(Se,{children:a}),e.jsx(Se,{children:o.pathDisplay}),e.jsx(Se,{children:o.wcStatus}),e.jsx(Se,{children:o.reposStatus})]},n))},a))})]})}),e.jsx(z,{mt:4,children:"If you wish to commit these files, please update the associated branches!"})]}):e.jsx(x,{children:e.jsx(z,{children:"Your selected branches do not contain any changed files for which a newer version exists in the repository."})})})}function ut({rowDataLocalChanges:s,setRowDataLocalChanges:a,defaultColDefsCommit:o}){const{localChangesGridRef:n,isDebug:i,selectedBranches:r,showCommitView:l,setSelectedLocalChanges:d,selectedLocalChanges:m}=T(),{emitFilesRevert:c}=he(),{RaiseClientNotificaiton:u}=te(),[b,j]=t.useState(""),k=t.useCallback(()=>{c(m)},[c,m]),M=t.useCallback(w=>{j(w.target.value)},[j]),p=t.useCallback(w=>{var v,V,U,E;if(console.debug("PanelLocalChanges.jsx: onFileViewSelectionChanged - event",w),String(w==null?void 0:w.source).toLowerCase().includes("api"))return;let g=(V=(v=n==null?void 0:n.current)==null?void 0:v.api)==null?void 0:V.getSelectedNodes().map(F=>F.data);i&&console.debug("PanelLocalChanges.jsx: onFileViewSelectionChanged - selectedBranches",g);const B=g.filter(F=>F["Local Status"].toLowerCase()==="added");(E=(U=n==null?void 0:n.current)==null?void 0:U.api)==null||E.forEachNode(F=>{B.some($=>$["File Path"].includes(F.data["File Path"])&&$["File Path"]!==F.data["File Path"])&&F.data["Local Status"].toLowerCase()==="added"&&!F.isSelected()&&(F.setSelected(!0),g.push(F.data),console.debug("PanelLocalChanges.jsx (onFileViewSelectionChanged): Adding ancestor node: ",F))}),d(g)},[n,i,d]),C=t.useCallback(w=>{w.success?u("TortoiseSVN diff opened successfully","success",3e3):u(`Error opening TortoiseSVN diff: ${JSON.stringify(w.error,null,4)}`,"error",0)},[u]),S=t.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:2},{field:"Local Status",headerTooltip:"Working Copy",sort:"asc",sortIndex:1},{headerName:"Diff",filter:!1,sortable:!1,resizable:!1,cellRenderer:ss,cellRendererParams:{onDiffResult:C},width:90}],[]);return t.useEffect(()=>{r.length<1||l||(j(""),a([]),d([]))},[r,l]),e.jsx(x,{children:s.length>0?e.jsxs(x,{children:[e.jsxs(R,{mb:4,alignItems:"center",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ie,{placeholder:"Type to search...",onInput:M,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"480px",width:"100%"},children:e.jsx(de,{ref:n,rowData:s,defaultColDef:o,columnDefs:S,onSelectionChanged:p,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsx(R,{mt:4,columnGap:2,justifyContent:"flex-end",children:e.jsx(I,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:m.length>0,children:e.jsx(A,{onClick:k,colorScheme:"red",isDisabled:m.length<1,children:"Revert Selected"})})})]}):e.jsx(x,{children:e.jsx(z,{children:"Your selected branches do not contain any files to commit."})})})}function ft({rowDataUntrackedChanges:s,setRowDataUntrackedChanges:a,defaultColDefsCommit:o}){const{untrackedChangesGridRef:n,selectedUntrackedChanges:i,setSelectedUntrackedChanges:r,isDebug:l,selectedBranches:d,showCommitView:m}=T(),{emitFilesAddRemove:c,emitFilesRevert:u}=he(),[b,j]=t.useState(""),k=t.useCallback(w=>{j(w.target.value)},[j]),M=t.useCallback(()=>{var g,B;const w=(B=(g=n==null?void 0:n.current)==null?void 0:g.api)==null?void 0:B.getSelectedNodes().map(v=>v.data);l&&console.debug("PanelUntrackedChanges.jsx (onUnseenFilesSelectionChanged): selectedBranches",w),r(w)},[n,l]),p=t.useCallback(()=>{c(i)},[c,i]),C=t.useCallback(()=>{u(i)},[u,i]),S=t.useMemo(()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"Branch Folder"},{field:"Branch Version",sort:"asc",sortIndex:0},{field:"File Path",flex:1,sort:"asc",sortIndex:1},{field:"Local Status",headerTooltip:"Working Copy"}],[]);return t.useEffect(()=>{d.length<1||m||(j(""),a([]),r([]))},[d,m]),e.jsx(x,{children:s.length>0?e.jsxs(x,{children:[e.jsx(z,{mb:4,children:"Below are the list of files which are either unversioned or missing in the repository:"}),e.jsxs(R,{mb:4,alignItems:"center",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ie,{placeholder:"Type to search...",onInput:k,width:"100%"})]}),e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"390px",width:"100%"},children:e.jsx(de,{ref:n,rowData:s,defaultColDef:o,columnDefs:S,onSelectionChanged:M,quickFilterText:b,domLayout:"normal",rowSelection:"multiple",rowMultiSelectWithClick:!0,animateRows:!0,columnMenu:"new",enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})}),e.jsxs(R,{mt:4,columnGap:2,justifyContent:"flex-end",children:[e.jsx(I,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:i.length>0,children:e.jsxs(A,{onClick:p,colorScheme:"green",isDisabled:i.length<1,children:["Add/Remove ",i.length," File",i.length>1?"s":""]})}),e.jsx(I,{label:"Requires you to select at least 1 file",hasArrow:!0,isDisabled:i.length>0,children:e.jsxs(A,{onClick:C,colorScheme:"red",isDisabled:i.length<1,children:["Revert ",i.length," File",i.length>1?"s":""]})})]})]}):e.jsx(x,{children:e.jsx(z,{children:"Your selected branches do not contain any unversioned or missing files."})})})}function Ue({targetBranchFolder:s=""}){const{issueNumber:a,setIssueNumber:o}=T(),n=i=>{const r=String(i.target.value);/^\d*$/.test(r)&&o(r.trim())};return e.jsx(ie,{value:a,onChange:n,placeholder:"Enter number"})}function mt(){const{config:s}=T();return s&&s.commitOptions?s.commitOptions:null}function gt(){const{configurableRowData:s}=T(),a=t.useCallback(i=>s&&s.length>0?s.find(r=>r.id==i)["Branch Folder"]:"",[s]),o=t.useCallback(i=>s&&s.length>0?s.find(r=>r.id==i)["Branch Version"]:"",[s]),n=t.useCallback(i=>s&&s.length>0?s.find(r=>r.id==i)["SVN Branch"]:"",[s]);return{getBranchFolderById:a,getBranchVersionById:o,getSvnBranchById:n}}function xt({openMessageAutoFillModal:s}){const{sourceBranch:a,setSourceBranch:o,branchOptions:n,setIssueNumber:i,commitMessage:r,setCommitMessage:l,isCommitMode:d,selectedBranches:m}=T(),c=mt(),{getBranchFolderById:u}=gt(),b=t.useCallback(k=>{o(k)},[o]),j=t.useCallback(k=>{l(String(k.target.value).replace(/["`]/g,"'"))},[l]);return t.useEffect(()=>{d&&(o(null),i(""),l(""))},[d]),e.jsx(x,{children:e.jsxs(R,{columnGap:3,children:[e.jsxs(x,{flexGrow:1,children:[e.jsxs(R,{columnGap:2,mb:2,children:[e.jsx(x,{width:"50%",children:e.jsxs(Be,{isRequired:!0,children:[e.jsx(ye,{children:"Source Branch"}),e.jsx(Vs,{value:a,onChange:b,options:n,placeholder:"Enter source branch",selectedOptionStyle:"check",selectedOptionColorScheme:"yellow",isClearable:!0})]})}),e.jsx(R,{width:"50%",alignItems:"flex-end",columnGap:2,children:e.jsxs(Be,{isRequired:!0,children:[e.jsx(ye,{children:a&&a.value?`Issue Number For ${u(a.value)}`:"Issue Number"}),e.jsx(Ue,{})]})})]}),e.jsxs(R,{columnGap:2,children:[e.jsxs(Be,{width:c!=null&&c.useIssuePerFolder?"50%":"100%",isRequired:!0,children:[e.jsx(ye,{children:"Commit Message"}),e.jsx(Ls,{placeholder:"Enter Commit Message",resize:"vertical",onInput:j,value:r})]}),c!=null&&c.useIssuePerFolder&&a&&a.value?e.jsx(x,{width:"50%",children:m.length>1?m.filter(k=>k.id!=a.value).map(k=>e.jsxs(Be,{isRequired:!0,children:[e.jsx(ye,{children:`Issue Number For ${u(k.id)}`}),e.jsx(Ue,{})]},k.id)):null}):c!=null&&c.useIssuePerFolder&&(!a||!a.value)?e.jsx(x,{width:"50%",textAlign:"center",m:"auto",children:e.jsx(z,{fontSize:"lg",fontWeight:"600",color:"yellow.500",children:"Please select source branch first!"})}):null]})]}),e.jsx(x,{pt:8,children:e.jsx(I,{label:"Auto Fill Message",hasArrow:!0,children:e.jsx(H,{colorScheme:"yellow","aria-label":"Auto Fill Message",size:"md",onClick:()=>s(),icon:e.jsx(Xe,{})})})})]})})}function bt({openCommitModal:s}){const{setShowCommitView:a,selectedLocalChanges:o,sourceBranch:n,issueNumber:i,commitMessage:r,setSocketPayload:l,configurableRowData:d}=T(),{RaiseClientNotificaiton:m}=te(),c=t.useCallback(()=>{a(!1)},[a]),u=t.useCallback(()=>{if(!n||n.value===""){m("Please select the source branch to proceed!","error");return}if(!i||!r||i===""||r===""){m("Please provide the issue number and the commit message to proceed!","error");return}l({sourceBranch:d.find(b=>b.id==n.value),issueNumber:i,commitMessage:r,filesToProcess:o}),s()},[n,i,r,m,o,d]);return e.jsx(x,{children:e.jsxs(R,{columnGap:2,justifyContent:"center",children:[e.jsx(A,{onClick:c,leftIcon:e.jsx(De,{}),colorScheme:"yellow",children:"Refresh Process"}),e.jsx(I,{label:"Select at least 1 file",hasArrow:!0,isDisabled:o.length>0,children:e.jsxs(A,{onClick:u,leftIcon:e.jsx(K,{as:_e}),colorScheme:"yellow",isDisabled:o.length<1,children:["Commit ",o.length>0?`${o.length} File`:"",o.length>1?"s":""]})})]})})}function pt(){const{selectedBranches:s,logData:a,setLogData:o}=T(),[n,i]=t.useState([]),[r,l]=t.useState(""),d=t.useCallback(u=>{l(u.target.value)},[l]),m=t.useCallback(()=>{o([])},[o]),c=a.length===s.length;return t.useEffect(()=>{if(a.length===0)return;const u=a.map(b=>b.logs).flat();i(b=>Y.isEqual(b,u)?b:u)},[a]),{rowDataLogs:n,quickFilterLogsText:r,setQuickFilterLogsText:l,onQuickFilterLogsInputChanged:d,refreshLogs:m,areLogsFetched:c}}function Ct({rowDataLogs:s,quickFilterLogsText:a,setAutoFillSelection:o=null,isAutofill:n=!1}){const i=t.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),r=t.useMemo(()=>{const m=[{field:"revision",headerName:"Revision",sort:"desc",width:130},{field:"date",headerName:"Date",sortable:!1},{field:"branchFolder",headerName:"Branch Folder",width:135},{field:"branchVersion",headerName:"Branch Version",width:125},{field:"author",headerName:"Author"},{field:"message",headerName:"Message",flex:1}];return n?[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},...m]:m},[n]),l=t.useRef(null),d=t.useCallback(()=>{var m,c;if(o){const u=(c=(m=l==null?void 0:l.current)==null?void 0:m.api)==null?void 0:c.getSelectedNodes().map(b=>b.data);o(u[0]||null)}},[o]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:n?"90%":"85%",width:"100%"},children:e.jsx(de,{ref:l,rowData:s,defaultColDef:i,columnDefs:r,onSelectionChanged:d,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!n,animateRows:!1,immutableData:!0,suppressFlash:!0,enableCellTextSelection:!0,ensureDomOrder:!0,pagination:!0,paginationAutoPageSize:!0})})}function ns({setAutoFillSelection:s=!1,isAutofill:a=!1}){const{selectedBranches:o,logData:n}=T(),{rowDataLogs:i,quickFilterLogsText:r,onQuickFilterLogsInputChanged:l,refreshLogs:d,areLogsFetched:m}=pt();return m?e.jsxs(x,{h:"100%",children:[e.jsxs(R,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(R,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ie,{placeholder:"Type to search...",onInput:l,width:"100%"})]}),e.jsx(x,{children:e.jsx(I,{label:"Refresh",hasArrow:!0,children:e.jsx(H,{onClick:d,icon:e.jsx(De,{}),colorScheme:"yellow","aria-label":"Refresh"})})})]}),e.jsx(Ct,{rowDataLogs:i,quickFilterLogsText:r,setAutoFillSelection:s,isAutofill:a})]}):e.jsxs(x,{children:[e.jsxs(x,{mb:4,children:[e.jsx(z,{fontWeight:600,children:"Showing SVN Log for the following branches:"}),e.jsx(Re,{spacing:3,children:o.map(c=>{const u=n.find(b=>b.id===c.id);return e.jsxs(le,{display:"flex",alignItems:"center",children:[e.jsx(ae,{w:30,h:30,as:u?oe:As,color:"yellow.500"}),be(c["Branch Folder"],c["Branch Version"],c["SVN Branch"])]},c.branchId)})})]}),e.jsx(R,{justifyContent:"center",children:e.jsx(Ms,{value:n.length/o.length*360,color:"yellow.300",size:"100px",children:e.jsxs(Es,{children:[n.length," / ",o.length]})})})]})}function wt(s){const{data:a}=s,o=async()=>{window.open(a.url,"_blank")};return e.jsx(H,{"aria-label":"Diff",size:"sm",icon:e.jsx(Ps,{}),onClick:o,colorScheme:"yellow"})}function jt({rowDataTrello:s,quickFilterTrelloText:a,setAutoFillSelection:o}){const n=t.useMemo(()=>({sortable:!0,resizable:!1,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]),i=t.useMemo(()=>[{checkboxSelection:!0,width:20,resizable:!1,suppressMovable:!1,filter:!1,editable:!1,headerClass:"branch-table-header-cell",cellClass:"branch-table-body-cell"},{field:"name",headerName:"Name",flex:1},{field:"lastActivityDate",headerName:"Last Activity Date"},{field:"url",headerName:"Goto Trello",filter:!1,sortable:!1,resizable:!1,cellRenderer:wt,width:120}],[]),r=t.useRef(null),l=t.useCallback(()=>{var m,c;const d=(c=(m=r==null?void 0:r.current)==null?void 0:m.api)==null?void 0:c.getSelectedNodes().map(u=>u.data);o(d[0]||null)},[o]);return e.jsx("div",{className:"ag-theme-balham-dark compact",style:{height:"80%",width:"100%"},children:e.jsx(de,{ref:r,rowData:s,defaultColDef:n,columnDefs:i,onSelectionChanged:l,quickFilterText:a,domLayout:"normal",columnMenu:"new",rowSelection:"single",suppressRowClickSelection:!1,animateRows:!1,enableCellTextSelection:!0,pagination:!0,paginationAutoPageSize:!0})})}function St({setAutoFillSelection:s}){const{socket:a}=T(),{key:o,token:n,isTrelloIntegrationEnabled:i,emitTrelloCardNamesSearch:r}=ts(),[l,d]=t.useState(""),[m,c]=t.useState(""),[u,b]=t.useState([]),j=t.useCallback(Y.debounce(C=>{C.trim()!==""&&r(o,n,C)},250),[o,n,r]),k=t.useCallback(C=>{d(String(C.target.value).trim())},[d]),M=t.useCallback(()=>{l.trim()!==""&&r(o,n,l)},[l,o,n,r]),p=t.useCallback(C=>{c(C.target.value)},[]);return t.useEffect(()=>(j(l),()=>j.cancel()),[l,j]),t.useEffect(()=>{const C=S=>{b(S&&S.length>0?S:[])};return a==null||a.on("trello-result-search-names-card",C),()=>a==null?void 0:a.off("trello-result-search-names-card",C)},[a]),i?e.jsxs(x,{h:"100%",children:[e.jsxs(R,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:[e.jsxs(R,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Trello Query:"}),e.jsx(ie,{placeholder:"Type to search...",onInput:k,width:"100%"})]}),e.jsx(x,{children:e.jsx(I,{label:"Resubmit Query",hasArrow:!0,children:e.jsx(H,{onClick:M,icon:e.jsx(De,{}),colorScheme:"yellow","aria-label":"Resubmit"})})})]}),e.jsx(R,{mb:4,width:"100%",alignItems:"center",columnGap:4,children:e.jsxs(R,{alignItems:"center",width:"100%",children:[e.jsx(z,{mr:2,fontWeight:"600",whiteSpace:"nowrap",children:"Quick Filter:"}),e.jsx(ie,{placeholder:"Type to search...",onInput:p,width:"100%"})]})}),e.jsx(jt,{rowDataTrello:u,quickFilterTrelloText:m,setAutoFillSelection:s})]}):e.jsx(x,{h:"100%",p:4,children:e.jsxs(z,{fontSize:"lg",fontWeight:"600",color:"red.500",children:["You need to"," ",e.jsxs(He,{href:"https://help.merge.dev/en/articles/8757597-trello-how-do-i-link-my-account",isExternal:!0,color:"yellow.500",children:["set up Trello Integration ",e.jsx(Xe,{mx:"2px"})]})," ","in the configuration file to use this feature."]})})}function Bt({isModalOpen:s,closeModal:a}){const{setSourceBranch:o,branchOptions:n,setIssueNumber:i,setCommitMessage:r,setPostCommitData:l}=T(),[d,m]=t.useState(0),[c,u]=t.useState([null,null]),[b,j]=t.useState(!0),k=t.useCallback(S=>{m(S),u(S===0?w=>[w[0],null]:w=>[null,w[1]])},[m]),M=t.useCallback(S=>{u(w=>[S,...w.slice(1)])},[u]),p=t.useCallback(S=>{u(w=>[w[0],S])},[u]),C=t.useCallback(()=>{console.warn("Nothing has been developed for this button yet."),console.debug("Selected tab index:",d),console.debug("Selected autofill selection:",JSON.stringify(c,null,4));let S=c[d];if(d===0){const w=S.message,g=S.branchId,B=w.match(/\s*(Issue)*\s*(\d+)\s*/),v=B?B[2]:null,V=w.replace(/\s*(Issue)*\s*(\d+)?\s*(\([^\)]+\))*\s?:?\s*/,"");g&&o(n.find(U=>U.value===g)),v&&i(v),V.trim()!==""&&r(V)}else{const w=S.name,g=w.match(/\s*(Issue)*\s*(\d+)\s*/),B=g?g[2]:null,v=w.replace(/\s*(Issue)*\s*(\d+)/,"");B&&i(B),v.trim()!==""&&r(v),l({type:"trello",data:S})}a()},[d,c,a]);return t.useEffect(()=>{j(!(c.length==2&&(c[0]||c[1])))},[c]),t.useEffect(()=>{u([null,null])},[s]),e.jsxs(Ge,{isOpen:s,onClose:a,isCentered:!0,motionPreset:"slideInBottom",scrollBehavior:"inside",size:"xl",closeOnOverlayClick:!0,children:[e.jsx(pe,{}),e.jsxs(Qe,{maxH:"95%",maxW:"95%",children:[e.jsx(Ce,{children:e.jsx(J,{as:"h2",size:"lg",children:"Autofill Commit Message"})}),e.jsx(ve,{size:"lg"}),e.jsx(we,{children:e.jsx(x,{height:"70vh",children:e.jsxs(Ke,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:0,isLazy:!0,h:"100%",onChange:S=>k(S),children:[e.jsxs(Je,{children:[e.jsx(ge,{children:"SVN Logs"}),e.jsx(ge,{children:"Trello"})]}),e.jsxs(Ze,{h:"90%",children:[e.jsx(xe,{px:0,pb:0,h:"100%",children:e.jsx(ns,{setAutoFillSelection:M,isAutofill:!0})}),e.jsx(xe,{px:0,pb:0,h:"100%",children:e.jsx(St,{setAutoFillSelection:p})})]})]})})}),e.jsxs(ke,{children:[e.jsx(A,{mr:3,onClick:()=>a(),children:"Cancel"}),e.jsx(I,{hasArrow:!0,label:"Please select exactly one row!",placement:"top-start",isDisabled:!b,children:e.jsx(A,{colorScheme:"yellow",onClick:C,isDisabled:b,children:"Select"})})]})]})]})}function yt(){const{config:s,updateConfig:a}=T(),[o,n]=t.useState({}),i=t.useCallback((r,l)=>{n(d=>({...d,[r]:l}))},[n]);return t.useEffect(()=>{!s||Y.isEmpty(s)||(s.commitOptions?n(s.commitOptions):a(r=>({...r,commitOptions:{useIssuePerFolder:!1}})))},[s]),t.useEffect(()=>{Y.isEmpty(o)||a(r=>Y.isEqual(r.commitOptions,o)?r:{...r,commitOptions:o})},[o]),e.jsxs(x,{mb:4,children:[e.jsx(J,{as:"h6",size:"sm",children:"Commit Options"}),e.jsx(Ye,{colorScheme:"yellow",children:e.jsx(zs,{direction:"row",spacing:4,mt:2,children:e.jsx(re,{isChecked:o.useIssuePerFolder,onChange:r=>i("useIssuePerFolder",r.target.checked),children:"Use 1 Issue Per Folder?"})})})]})}function kt(){const{isDebug:s,setIsCommitMode:a,selectedBranchStatuses:o,showCommitView:n,setShowCommitView:i,selectedBranches:r,configurableRowData:l}=T(),[d,m]=t.useState({}),[c,u]=t.useState([]),[b,j]=t.useState([]),{isOpen:k,onOpen:M,onClose:p}=Ne(),{isOpen:C,onOpen:S,onClose:w}=Ne(),g=t.useMemo(()=>({resizable:!0,wrapText:!0,autoHeight:!0,filter:!0,suppressMovable:!0,editable:!1,wrapHeaderText:!0,autoHeaderHeight:!0}),[]);t.useEffect(()=>{if(r.length<1||n){r.length<1&&a(!1);return}m({})},[r,n]),t.useEffect(()=>{s&&(console.debug("Branch Status Rows:",o),console.debug("Selected Rows:",r))},[s,o,r]),t.useEffect(()=>{o.length===r.length&&(o.forEach(E=>{let F=E.id,O=E.status.filesToCommit,$=E.status.filesToUpdate;const D=l.find(P=>P.id===F);if($.length>0){const P=be(D["Branch Folder"],D["Branch Version"],D["SVN Branch"]);m(W=>({...W,[P]:[...W[P]||[],...$]}))}if(O.length>0){const P=O.map(W=>({branchId:F,"Branch Folder":D["Branch Folder"],"Branch Version":D["Branch Version"],"SVN Branch":D["SVN Branch"],"Full Path":W.path,"File Path":`${et(E.status.branch)}\\${W.pathDisplay}`,"Local Status":W.wcStatus}));u(W=>[...W,...P.filter(Q=>!["unversioned","missing"].includes(Q["Local Status"]))]),j(W=>[...W,...P.filter(Q=>["unversioned","missing"].includes(Q["Local Status"]))])}}),i(!0))},[o,r,l]);const B=Object.keys(d).length>0,v=c.length>0,V=b.length>0,U=B||v||V;return e.jsxs(x,{children:[e.jsx(yt,{}),e.jsx(x,{mb:6,children:e.jsx(xt,{openMessageAutoFillModal:S})}),e.jsx(Os,{isLoaded:n&&U,startColor:"yelow.500",endColor:"yellow.500",children:e.jsxs(Ke,{variant:"solid-rounded",colorScheme:"yellow",defaultIndex:B?0:v?1:2,isLazy:!1,children:[e.jsxs(Je,{children:[e.jsx(ge,{isDisabled:!B,children:e.jsx(I,{label:"No files to update!",hasArrow:!0,isDisabled:B,children:"Files to Update"})}),e.jsx(ge,{isDisabled:!v,children:e.jsx(I,{label:"No files to commit!",hasArrow:!0,isDisabled:v,children:"Local Changes"})}),e.jsx(ge,{isDisabled:!V,children:e.jsx(I,{label:"No unversioned/missing files!",hasArrow:!0,isDisabled:V,children:"Untracked Changes"})})]}),e.jsxs(Ze,{children:[e.jsx(xe,{px:0,children:e.jsx(ht,{fileUpdates:d})}),e.jsx(xe,{px:0,children:e.jsx(ut,{rowDataLocalChanges:c,setRowDataLocalChanges:u,defaultColDefsCommit:g})}),e.jsx(xe,{px:0,children:e.jsx(ft,{rowDataUntrackedChanges:b,setRowDataUntrackedChanges:j,defaultColDefsCommit:g})})]})]})}),n&&!U?e.jsxs(z,{mt:4,className:"animation-pulse",fontWeight:600,textAlign:"center",children:["No changes have been spotted!",e.jsx("br",{}),"Please use the refresh button ðŸ‘‡ if you have recently made a change"]}):e.jsx(e.Fragment,{}),e.jsx(x,{mt:6,children:e.jsx(bt,{openCommitModal:M})}),e.jsx(dt,{isModalOpen:k,closeModal:p}),e.jsx(Bt,{isModalOpen:C,closeModal:w})]})}function Dt(){const{showSelectedBranchesLog:s,setShowSelectedBranchesLog:a}=T();return e.jsxs(Us,{isOpen:s,onClose:()=>a(!1),placement:"left",size:"full",children:[e.jsx(pe,{}),e.jsxs(Ws,{children:[e.jsx(ve,{size:"lg"}),e.jsx(Ce,{children:"Selected Branches: SVN Log"}),e.jsx(we,{children:e.jsx(x,{height:"100%",children:e.jsx(ns,{})})})]})]})}function vt(){const{toast:s,RaiseClientNotificaiton:a}=te(),{isOpen:o,onOpen:n,onClose:i}=Ne(),r=t.useRef(),[l,d]=t.useState(!1);t.useEffect(()=>{if(!window.electron){a("Electron context is not available. Updates cannot be checked.","warning",5e3);return}return window.electron.on("update-available",()=>{s.closeAll(),n()}),window.electron.on("update-error",u=>{a(`An error occurred while checking for updates: ${u}`,"error",5e3),d(!1)}),()=>{window.electron.removeAllListeners("update-available"),window.electron.removeAllListeners("update-error")}},[s,n]);const m=t.useCallback(()=>{i(),a("You may update the application later by manually triggering an update check or wait until Titan does this","info",5e3)},[i,a]),c=t.useCallback(()=>{if(l){a("Update is already in progress. Please wait.","info",5e3);return}window.electron?(d(!0),window.electron.downloadUpdate().catch(u=>{d(!1),a(`An error occurred while downloading the update: ${u}`,"error",5e3)}),window.electron.on("update-downloaded",()=>{a("Update has been downloaded successfully. Titan will now restart to apply the update.","info",5e3),window.electron.removeAllListeners("update-downloaded"),i()}),window.electron.on("update-not-available",()=>{a("Titan is up to date","info",3e3),window.electron.removeAllListeners("update-not-available"),d(!1),i()})):a("Cannot update Titan in a non-desktop application environment","error",5e3)},[l,a,d,i]);return e.jsx($e,{isOpen:o,leastDestructiveRef:r,onClose:i,motionPreset:"slideInBottom",closeOnOverlayClick:!l,children:e.jsx(pe,{children:e.jsxs(qe,{children:[e.jsx(Ce,{fontSize:"lg",fontWeight:"bold",children:"Update Available"}),l?e.jsx(e.Fragment,{}):e.jsx(ve,{}),e.jsx(we,{children:"A new version of Titan is available. Would you like to download and install the update?"}),e.jsxs(ke,{children:[e.jsx(A,{colorScheme:"red",ref:r,onClick:m,isDisabled:l,children:"Cancel"}),e.jsx(A,{colorScheme:"yellow",onClick:c,ml:3,isDisabled:l,children:"Confirm"})]})]})})})}function Ft(){if(!window.electron)return e.jsx(e.Fragment,{});const s=t.useCallback(()=>{window.electron.minimizeWindow()},[]),a=t.useCallback(()=>{window.electron.maximizeWindow()},[]),o=t.useCallback(()=>{window.electron.closeWindow()},[]);return e.jsx(Hs.header,{w:"100%",position:"fixed",bgColor:"#121212",className:"titanHead",zIndex:9999999,top:0,children:e.jsxs(R,{justifyContent:"space-between",alignItems:"center",p:2,position:"static",children:[e.jsx(J,{as:"h6",size:"sm",noOfLines:1,className:"animation-fadein-left-forward",children:"Titan"}),e.jsxs(R,{alignItems:"center",columnGap:2,flexWrap:"nowrap",wrap:"nowrap",children:[e.jsx(H,{"aria-label":"Minimize",size:"xs",icon:e.jsx($s,{}),onClick:s,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Maximize",size:"xs",icon:e.jsx(qs,{}),onClick:a,colorScheme:"gray",_hover:{bg:"#FAF089",color:"#1A202C"}}),e.jsx(H,{"aria-label":"Close",size:"xs",icon:e.jsx(Ie,{}),onClick:o,colorScheme:"gray",_hover:{bg:"#FEB2B2",color:"#1A202C"}})]})]})})}function It(){const{isCommitMode:s,selectedBranches:a,configurableRowData:o}=T(),{RaiseClientNotificaiton:n}=te();return t.useEffect(()=>{if(window.electron)return window.electron.onAppClosing(()=>{n("App is closing, performing cleanup...","info",0),window.electron.closeWindow()}),()=>{window.electron.removeAppClosingListener()};console.warn("Electron specific logic is not available in browser mode.")},[]),e.jsxs(x,{className:"titanBody",children:[e.jsx(Ft,{}),e.jsxs(x,{p:10,children:[e.jsx(lt,{}),e.jsx(vt,{}),e.jsxs(R,{rowGap:4,flexDirection:"column",children:[e.jsx(x,{children:e.jsx(ct,{})}),e.jsx(_s,{in:s,animateOpacity:!0,children:e.jsxs(x,{id:"sectionCommit",children:[e.jsxs(J,{as:"h2",size:"lg",noOfLines:1,mb:4,className:"animation-pulse",children:["Committing ",a.length==o.length?"All":`${a.length}/${o.length}`," Branch",a.length==1?"":"es"]}),e.jsx(kt,{})]})})]}),e.jsx(Dt,{})]})]})}const{definePartsStyle:ls,defineMultiStyleConfig:as}=Ks(Js.keys),Rt=ls({overlay:{bg:"blackAlpha.900"},dialog:{bg:"gray.900",color:"white",boxShadow:"rgba(255, 255, 255, 0.07) 0px -20px 20px 20px"},header:{bg:"gray.900",color:"white",borderRadius:"20px",p:4},body:{p:4,color:"white"},footer:{bg:"gray.900",p:4,color:"white",borderRadius:"20px"}}),Nt=as({baseStyle:Rt}),Tt=ls({overlay:{bg:"blackAlpha.900"},dialog:{mt:tt,bg:"gray.900",color:"white",boxShadow:"rgba(255, 255, 255, 0.07) 0px -20px 20px 20px"},header:{bg:"gray.900",color:"white",borderRadius:"20px",p:4},body:{p:4,color:"white"},footer:{bg:"gray.900",p:2,color:"white",borderRadius:"20px"}}),Vt=as({baseStyle:Tt}),Lt={initialColorMode:"dark",useSystemColorMode:!1},We=Gs({config:Lt,components:{Modal:Nt,Drawer:Vt}});Qs.createRoot(document.getElementById("root")).render(e.jsx(Te.StrictMode,{children:e.jsxs(Ys,{theme:We,children:[e.jsx(Xs,{initialColorMode:We.config.initialColorMode}),e.jsx(nt,{children:e.jsx(It,{})})]})}));
